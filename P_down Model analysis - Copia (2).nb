(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    288709,       7250]
NotebookOptionsPosition[    279335,       7085]
NotebookOutlinePosition[    279753,       7103]
CellTagsIndexPosition[    279710,       7100]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{3.8668191310610237`*^9},
 CellLabel->"In[1]:=",ExpressionUUID->"817a7010-d6e3-42b8-9c22-19738806bb4c"],

Cell["\<\
We simulate here  experiments based on Hannah\[CloseCurlyQuote]s, considering \
the number of repetitions on each dataset, the expected value of the \
parameters, and the known relative phases. We focus on the joint fit of the \
simulated data and on the confidence intervals for those estimates. \
\>", "Abstract",
 CellChangeTimes->{{3.8668189077623444`*^9, 3.866819127555088*^9}, {
  3.8668192051934605`*^9, 
  3.8668192896978493`*^9}},ExpressionUUID->"ec0402e7-b03c-4d77-a648-\
ec440f75b585"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8931479876429234`*^9, 
  3.893147987924925*^9}},ExpressionUUID->"7618d532-54fb-4bdc-9532-\
0015a6132e16"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"ClearAll", ";"}]}]], "Input",
 CellChangeTimes->{{3.878104865480715*^9, 3.878104873254469*^9}, {
  3.8781051586884365`*^9, 3.878105166123176*^9}, {3.8781052216768017`*^9, 
  3.8781052228488007`*^9}, {3.878105355841529*^9, 3.878105399896902*^9}, {
  3.878105529707357*^9, 3.878105532191063*^9}, {3.878105577158818*^9, 
  3.8781056245756154`*^9}, {3.8781091217501698`*^9, 3.8781091250891695`*^9}, {
  3.8975511091254654`*^9, 3.897551110722189*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"e1cabba1-9226-4912-8649-b18088a1e3f6"],

Cell[CellGroupData[{

Cell["All Functions Needed", "Section",
 CellChangeTimes->{{3.897560609415147*^9, 
  3.897560625186064*^9}},ExpressionUUID->"5d792f03-cf4f-4398-a941-\
84667481b685"],

Cell[CellGroupData[{

Cell["Other functions", "Subsection",
 CellChangeTimes->{{3.8975543451941566`*^9, 
  3.897554350818277*^9}},ExpressionUUID->"de8dcfcf-8bd2-4657-ab35-\
28d7c392f0f5"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "SaveToCell", "]"}], "\n", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"SaveToCell", ",", " ", "HoldFirst"}], "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SaveToCell", "[", 
    RowBox[{"var_", ",", " ", 
     RowBox[{"name", " ", ":", " ", 
      RowBox[{"Except", "[", 
       RowBox[{"_", "?", "OptionQ"}], "]"}], " ", ":", " ", "\"\<data\>\""}], 
     ",", " ", 
     RowBox[{"opt", " ", ":", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", "\n", 
   "    ", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data", " ", "=", " ", 
        RowBox[{"Compress", "[", "var", "]"}]}], ",", "\n", "      ", 
       RowBox[{"panel", " ", "=", " ", 
        RowBox[{"ToBoxes", "@", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"Panel", "[", 
            RowBox[{"name", ",", " ", 
             RowBox[{"FrameMargins", " ", "->", " ", "Small"}]}], "]"}], ",", 
           " ", 
           RowBox[{"DateString", "[", "]"}]}], "]"}]}]}]}], "}"}], ",", "\n", 
     "      ", 
     RowBox[{"CellPrint", "@", 
      RowBox[{"Cell", "[", "\n", "        ", 
       RowBox[{
        RowBox[{"BoxData", "@", 
         RowBox[{"RowBox", "[", 
          RowBox[{"{", "\n", "          ", 
           RowBox[{
            RowBox[{"MakeBoxes", "[", "var", "]"}], ",", "\n", "          ", 
            "\"\<=\>\"", ",", "\n", "          ", 
            RowBox[{"InterpretationBox", "[", 
             RowBox[{"panel", ",", " ", 
              RowBox[{"Uncompress", "[", "data", "]"}]}], "]"}], ",", "\n", 
            "          ", "\"\<;\>\""}], "\n", "        ", "}"}], "]"}]}], 
        ",", "\n", "        ", "\"\<Input\>\"", ",", "\n", "        ", 
        RowBox[{"GeneratedCell", " ", "->", " ", "False"}], ",", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"prevent", " ", "deletion", " ", "by", " ", "Cell"}], " ", 
          ">", " ", 
          RowBox[{"Delete", " ", "All", " ", 
           RowBox[{"Output", ":"}]}]}], " ", "*)"}], "\n", "        ", 
        RowBox[{"CellLabel", " ", "->", " ", "\"\<(saved)\>\""}], ",", "\n", 
        "        ", "opt", ",", "\n", "        ", 
        RowBox[{"CellLabelAutoDelete", " ", "->", " ", "False"}]}], "\n", 
       "      ", "]"}]}]}], "\n", "    ", "]"}]}], ";"}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[373]:=",ExpressionUUID->"46031581-5382-49eb-b0f0-61f0961ac04a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"fplotphases", "[", 
    RowBox[{"PHASELIST_", ",", "PHASE_", ",", "SETS_", ",", "NM_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"phaselist", "=", "PHASELIST"}], ",", 
       RowBox[{"phase", "=", "PHASE"}], ",", 
       RowBox[{"sets", "=", "SETS"}], ",", "plot1", ",", "plot2"}], "}"}], 
     ",", "\n", 
     RowBox[{
      RowBox[{"plot1", "=", 
       RowBox[{"ListPlot", "[", 
        RowBox[{"phaselist", ",", 
         RowBox[{"PlotTheme", "->", "\"\<Scientific\>\""}], ",", 
         RowBox[{"PlotRange", "->", "Full"}], ",", 
         RowBox[{"PlotLegends", "->", 
          RowBox[{"Placed", "[", 
           RowBox[{
            RowBox[{"Grid", "[", 
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"\"\<Measurements = \>\"", ",", "NM"}], "}"}], "}"}], 
             "]"}], ",", "Below"}], "]"}]}]}], "]"}]}], ";", "\n", 
      RowBox[{"plot2", "=", " ", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "phase"}], ",", 
           RowBox[{"Mean", "[", "phaselist", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"t", ",", "1", ",", "sets"}], "}"}], ",", 
         RowBox[{"PlotLegends", "->", 
          RowBox[{"Placed", "[", 
           RowBox[{
            RowBox[{"LineLegend", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<True Phase\>\"", ",", "\"\<Mean\>\""}], "}"}], 
              ",", 
              RowBox[{"LegendLayout", "->", 
               RowBox[{"{", 
                RowBox[{"\"\<Row\>\"", ",", "1"}], "}"}]}]}], "]"}], ",", 
            "Above"}], "]"}]}], ",", " ", 
         RowBox[{"PlotStyle", "->", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thickness", "[", "0.0001", "]"}], ",", "Orange"}], 
             "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thickness", "[", "0.0001", "]"}], ",", "Blue"}], 
             "}"}]}], "}"}]}], ",", 
         RowBox[{"PlotTheme", "->", "\"\<Scientific\>\""}], ",", 
         RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";", "\n", 
      RowBox[{"Show", "[", 
       RowBox[{"plot1", ",", "plot2"}], "]"}]}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"c48b1bc3-ddfb-4f0e-9354-2fcfec5260a6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pnPlotM", "[", 
    RowBox[{"LIST_", ",", "MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], 
    "]"}], ":=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{"LIST", ",", 
     RowBox[{"PlotRange", "->", "Full"}], ",", 
     RowBox[{"PlotTheme", "->", "\"\<Detailed\>\""}], ",", 
     RowBox[{"PlotLabel", "->", 
      RowBox[{"{", 
       RowBox[{
       "\"\<|\[Alpha]|, nbar, r, \[Phi] = \>\"", ",", "MALPHA", ",", "NB", 
        ",", "SQ", ",", "PSI"}], "}"}]}], ",", 
     RowBox[{"Joined", "->", "True"}], ",", 
     RowBox[{"Mesh", "->", "All"}], ",", 
     RowBox[{"PlotStyle", "->", 
      RowBox[{"{", 
       RowBox[{"Dashed", ",", 
        RowBox[{"Thickness", "[", "0.002", "]"}]}], "}"}]}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"8515b0e2-b605-4a97-826d-16cf048f30e8"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"q", "-=", 
    RowBox[{"[", 
     RowBox[{
     "ALPHA_", ",", "Q0_", ",", "P0_", ",", "SQ_", ",", "NB_", ",", "PHI_"}], 
     "]"}]}], ":=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"l1", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"pnDGaussianO", "[", 
           RowBox[{
            RowBox[{"i", "-", "1"}], ",", 
            RowBox[{"\[Sigma]pp", "[", 
             RowBox[{"SQ", ",", "NB"}], "]"}], ",", 
            RowBox[{"\[Sigma]qq", "[", 
             RowBox[{"SQ", ",", "NB"}], "]"}], ",", "Q0", ",", "P0"}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nf"}], "}"}]}], "]"}]}], ",", 
       RowBox[{"l2", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"pnDGaussianD", "[", 
           RowBox[{
            RowBox[{"i", "-", "1"}], ",", 
            RowBox[{"\[Sigma]pp", "[", 
             RowBox[{"SQ", ",", "NB"}], "]"}], ",", 
            RowBox[{"\[Sigma]qq", "[", 
             RowBox[{"SQ", ",", "NB"}], "]"}], ",", "0", ",", "Q0", ",", 
            "P0"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nf"}], "}"}]}], "]"}]}], ",", "\n", 
       RowBox[{"l3", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Re", "[", 
           RowBox[{"pnDGaussianM3DS", "[", 
            RowBox[{
             RowBox[{"i", "-", "1"}], ",", "ALPHA", ",", "SQ", ",", "NB", ",",
              "PHI"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nf"}], "}"}]}], "]"}]}], ",", 
       RowBox[{"l4", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"pnCoherent", "[", 
           RowBox[{
            RowBox[{"i", "-", "1"}], ",", "Q0", ",", "P0"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nf"}], "}"}]}], "]"}]}]}], "}"}], ",", 
     RowBox[{"PlotLegends", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"StringJoin", "[", 
           RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"legendList", ",", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ToString", "[", "#", "]"}], "&"}], ",", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Apply", "[", 
                 RowBox[{"Plus", ",", "#"}], "]"}], "&"}], ",", 
               RowBox[{"{", 
                RowBox[{"l1", ",", "l2", ",", "l3", ",", "l4"}], "}"}]}], 
              "]"}]}], "]"}]}], "}"}]}], "]"}], "}"}]}], ",", 
     RowBox[{"FrameTicksStyle", "\[Rule]", "14"}], ",", 
     RowBox[{"IntervalMarkersStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Black", ",", "Bold"}], "]"}]}], ",", 
     RowBox[{"FrameTicksStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Black", ",", "Bold"}], "]"}]}], ",", 
     RowBox[{"GridLines", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"None", ",", "None"}], "}"}]}], ",", 
     RowBox[{"GridLinesStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Gray", ",", " ", "Dashed"}], "]"}]}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
     RowBox[{"LabelStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Black", ",", "16"}], "]"}]}], ",", 
     RowBox[{"PlotMarkers", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<\[FilledSquare]\>\"", ",", "9"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<\[FilledUpTriangle]\>\"", ",", "9"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<\[FilledCircle]\>\"", ",", "7"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<*\>\"", ",", "12"}], "}"}]}], "}"}]}], ",", 
     RowBox[{"FrameTicks", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Automatic", ",", "Automatic"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Automatic", ",", "Automatic"}], "}"}]}], "}"}]}], ",", 
     RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}]}], "]"}]}], 
  "*)"}]], "Input",ExpressionUUID->"44166aed-01c8-4395-8854-043077827739"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"[", 
    RowBox[{"LISTS_", ",", "LISTINFO_"}], "]"}], ":=", "\n", "\n", 
   RowBox[{"ListPlot", "[", 
    RowBox[{"LISTS", ",", 
     RowBox[{"PlotLegends", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"StringJoin", "[", 
           RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
         RowBox[{"{", 
          RowBox[{"LISTINFO", ",", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ToString", "[", "#", "]"}], "&"}], ",", 
             RowBox[{"Map", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Apply", "[", 
                 RowBox[{"Plus", ",", "#"}], "]"}], "&"}], ",", "LISTS"}], 
              "]"}]}], "]"}]}], "}"}]}], "]"}], "}"}]}], ",", 
     RowBox[{"FrameTicksStyle", "\[Rule]", "14"}], ",", 
     RowBox[{"IntervalMarkersStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Black", ",", "Bold"}], "]"}]}], ",", 
     RowBox[{"FrameTicksStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Black", ",", "Bold"}], "]"}]}], ",", 
     RowBox[{"GridLines", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"None", ",", "None"}], "}"}]}], ",", 
     RowBox[{"GridLinesStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Gray", ",", " ", "Dashed"}], "]"}]}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
     RowBox[{"LabelStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Black", ",", "16"}], "]"}]}], ",", 
     RowBox[{"PlotMarkers", "\[Rule]", "Automatic"}], ",", 
     RowBox[{"FrameTicks", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Automatic", ",", "Automatic"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Automatic", ",", "Automatic"}], "}"}]}], "}"}]}], ",", 
     RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
     RowBox[{"Joined", "\[Rule]", "True"}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], "*)"}]], "Input",Expr\
essionUUID->"992e5cc7-5f56-4331-bd1e-b5b92767fdb7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"tableEstMeanError", "[", "FITS_", "]"}], ":=", 
   RowBox[{"TableForm", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Mean", "[", "#", "]"}], ",", 
            RowBox[{"StandardDeviation", "[", "#", "]"}]}], "}"}], "&"}], ",",
          "FITS"}], "]"}], ",", "1"}], "]"}], ",", 
     RowBox[{"TableHeadings", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<Estimates\>\"", ",", "\"\<Error\>\""}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<|alpha|\>\"", ",", "\"\<nbar\>\"", ",", "\"\<r\>\"", ",", 
          "\"\<phase\>\""}], "}"}]}], "}"}]}]}], "]"}]}], ";"}]], "Input",Expr\
essionUUID->"e4a93dac-b460-4e50-b95f-1c59c38e2988"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "errBayes", "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"errBayes", "[", 
    RowBox[{"FreqList_", ",", "Nmeasure_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"freqlist", "=", "FreqList"}], ",", " ", 
       RowBox[{"nm", " ", "=", " ", "Nmeasure"}], ",", " ", "variances", ",", 
       " ", "counts", ",", "temp", ",", "w", ",", "nFockNumber"}], "}"}], ",",
      "\n", 
     RowBox[{
      RowBox[{"counts", "=", 
       RowBox[{"freqlist", "*", "nm"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Variances", " ", "from", " ", "Bayesian", " ", "Statistics", " ", 
         "form", " ", "Binomial", " ", "Distribution"}], ",", " ", 
        RowBox[{"after", " ", "1", " ", 
         RowBox[{"update", ":"}]}]}], " ", "*)"}], "\n", 
      RowBox[{"(*", 
       RowBox[{
       "It", " ", "depends", " ", "on", " ", "initial", " ", "Shape", " ", 
        "Parameters", " ", "alfa", " ", "and", " ", 
        RowBox[{"Beta", ":", " ", 
         RowBox[{
         "Its", " ", "is", " ", "condidered", " ", "both", " ", "equal", " ", 
          "to", " ", "1", " ", 
          RowBox[{"here", "."}]}]}]}], " ", "*)"}], "\n", 
      RowBox[{
       RowBox[{"VarBayes", "[", 
        RowBox[{"CountList_", ",", "Nmeasurements_", ",", "nFockNumber_"}], 
        "]"}], ":=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"CountList", "[", 
           RowBox[{"[", 
            RowBox[{"nFockNumber", "+", "1"}], "]"}], "]"}], "+", "1"}], 
         ")"}], 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Nmeasurements", "-", 
           RowBox[{"CountList", "[", 
            RowBox[{"[", 
             RowBox[{"nFockNumber", "+", "1"}], "]"}], "]"}], "+", "1"}], 
          ")"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "+", "1", "+", "Nmeasurements"}], ")"}], "^", 
             "2"}], " ", ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"1", "+", "1", "+", "Nmeasurements", "+", "1"}], ")"}]}], 
          ")"}]}]}]}], ";", "\n", 
      RowBox[{"variances", " ", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"VarBayes", "[", 
          RowBox[{"counts", ",", "nm", ",", "i"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Dimensions", "[", "freqlist", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}]}], 
      ";", "\n", 
      RowBox[{"Sqrt", "[", "variances", "]"}]}]}], "\n", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"201c3dfa-2dde-4481-8fcb-86343aacb787"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "weightsBayes", "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"weightsBayes", "[", 
    RowBox[{"FreqList_", ",", "Nmeasure_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"freqlist", "=", "FreqList"}], ",", " ", 
       RowBox[{"nm", " ", "=", " ", "Nmeasure"}], ",", " ", "variances", ",", 
       " ", "counts", ",", "temp", ",", "w"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"counts", "=", 
       RowBox[{"freqlist", "*", "nm"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Variances", " ", "from", " ", "Bayesian", " ", "Statistics", " ", 
         "form", " ", "Binomial", " ", "Distribution"}], ",", " ", 
        RowBox[{"after", " ", "1", " ", 
         RowBox[{"update", ":"}]}]}], " ", "*)"}], "\n", 
      RowBox[{"(*", 
       RowBox[{
       "It", " ", "depends", " ", "on", " ", "initial", " ", "Shape", " ", 
        "Parameters", " ", "alfa", " ", "and", " ", 
        RowBox[{"Beta", ":", " ", 
         RowBox[{
         "Its", " ", "is", " ", "condidered", " ", "both", " ", "equal", " ", 
          "to", " ", "1", " ", 
          RowBox[{"here", "."}]}]}]}], " ", "*)"}], "\n", 
      RowBox[{
       RowBox[{"VarBayes", "[", 
        RowBox[{"CountList_", ",", "Nmeasurements_", ",", "nFockNumber_"}], 
        "]"}], ":=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"CountList", "[", 
           RowBox[{"[", 
            RowBox[{"nFockNumber", "+", "1"}], "]"}], "]"}], "+", "1"}], 
         ")"}], 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Nmeasurements", "-", 
           RowBox[{"CountList", "[", 
            RowBox[{"[", 
             RowBox[{"nFockNumber", "+", "1"}], "]"}], "]"}], "+", "1"}], 
          ")"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "+", "1", "+", "Nmeasurements"}], ")"}], "^", 
             "2"}], " ", ")"}], "*", 
           RowBox[{"(", 
            RowBox[{"1", "+", "1", "+", "Nmeasurements", "+", "1"}], ")"}]}], 
          ")"}]}]}]}], ";", "\n", 
      RowBox[{"variances", " ", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"VarBayes", "[", 
          RowBox[{"counts", ",", "nm", ",", "i"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Dimensions", "[", "freqlist", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}]}], 
      ";", "\n", " ", 
      RowBox[{"1", "/", "variances"}]}]}], "\n", "]"}]}], 
  ";"}], "\n"}], "Input",
 InitializationCell->
  True,ExpressionUUID->"7cf576e3-1071-4900-9352-2ab47714c63f"]
}, Closed]],

Cell[CellGroupData[{

Cell["Pn for Displaced Gaussian State State - Marian's paper", "Subsection",ExpressionUUID->"580dfb0d-0bce-4ec8-a204-1db862768151"],

Cell[BoxData[
 RowBox[{"Clear", "[", 
  RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}]], "Input",
 CellLabel->
  "In[258]:=",ExpressionUUID->"c2b6171a-450d-4800-83bd-3c835a2f4993"],

Cell[CellGroupData[{

Cell["Equations 2.9 - 2.11, 4.5 - 4.11", "Subsubsection",ExpressionUUID->"8c301199-d6ee-4926-9d66-fa00398308b3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"lA", "[", 
    RowBox[{"NB_", ",", "SQ_"}], "]"}], "=", 
   RowBox[{"NB", "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"2", "NB"}], "+", "1"}], ")"}], "*", 
     RowBox[{
      RowBox[{"Sinh", "[", "SQ", "]"}], "^", "2"}]}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"lB", "[", 
    RowBox[{"NB_", ",", "SQ_", ",", "PHI_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"-", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"2", "NB"}], "+", "1"}], ")"}]}], "*", 
    RowBox[{"Sinh", "[", "SQ", "]"}], 
    RowBox[{"Cosh", "[", "SQ", "]"}], "*", 
    RowBox[{"Exp", "[", 
     RowBox[{"I", "*", "PHI"}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"lC", "[", "ALPHA_", "]"}], "=", "ALPHA"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"lC2", "[", 
    RowBox[{"ALPHA_", ",", "SQ_", ",", "PHI_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"ALPHA", "*", 
     RowBox[{"Cosh", "[", "SQ", "]"}]}], "+", 
    RowBox[{
     RowBox[{"Conjugate", "[", "ALPHA", "]"}], "*", 
     RowBox[{"Exp", "[", 
      RowBox[{"I", "*", "PHI"}], "]"}], "*", 
     RowBox[{"Sinh", "[", "SQ", "]"}]}]}]}], ";"}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[259]:=",ExpressionUUID->"8aceed9a-dd0f-44c0-b74f-e30d92ff7816"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"tildeA", "[", 
    RowBox[{"NB_", ",", "SQ_"}], "]"}], "=", 
   RowBox[{"Divide", "[", 
    RowBox[{
     RowBox[{"NB", "*", 
      RowBox[{"(", 
       RowBox[{"NB", "+", "1"}], ")"}]}], ",", 
     RowBox[{
      RowBox[{"NB", "^", "2"}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"NB", "+", 
         RowBox[{"1", "/", "2"}]}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"Cosh", "[", 
          RowBox[{"2", "SQ"}], "]"}]}], ")"}]}]}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"tildeB", "[", 
    RowBox[{"NB_", ",", "SQ_", ",", "PHI_"}], "]"}], "=", 
   RowBox[{"-", 
    RowBox[{"Divide", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Exp", "[", 
        RowBox[{"I", "*", "PHI"}], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{"NB", "+", 
         RowBox[{"1", "/", "2"}]}], ")"}], "*", 
       RowBox[{"Sinh", "[", 
        RowBox[{"2", "SQ"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{"NB", "^", "2"}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"NB", "+", 
          RowBox[{"1", "/", "2"}]}], ")"}], "*", 
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{"Cosh", "[", 
           RowBox[{"2", "SQ"}], "]"}]}], ")"}]}]}]}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"normtildeB", "[", 
    RowBox[{"NB_", ",", "SQ_"}], "]"}], "=", 
   RowBox[{"Divide", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"NB", "+", 
        RowBox[{"1", "/", "2"}]}], ")"}], "*", 
      RowBox[{"Sinh", "[", 
       RowBox[{"2", "SQ"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{"NB", "^", "2"}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"NB", "+", 
         RowBox[{"1", "/", "2"}]}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"Cosh", "[", 
          RowBox[{"2", "SQ"}], "]"}]}], ")"}]}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tildeC", "[", 
    RowBox[{"ALPHA_", ",", "NB_", ",", "SQ_", ",", "PHI_"}], "]"}], "=", 
   RowBox[{"Divide", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"lC", "[", "ALPHA", "]"}], "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"1", "/", "2"}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"NB", "+", 
            RowBox[{"1", "/", "2"}]}], ")"}], "*", 
          RowBox[{"Cosh", "[", 
           RowBox[{"2", "SQ"}], "]"}]}]}], ")"}]}], "-", 
      RowBox[{
       RowBox[{"Conjugate", "[", 
        RowBox[{"lC", "[", "ALPHA", "]"}], "]"}], "*", 
       RowBox[{"Exp", "[", 
        RowBox[{"I", "*", "PHI"}], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{"NB", "+", 
         RowBox[{"1", "/", "2"}]}], ")"}], "*", 
       RowBox[{"Sinh", "[", 
        RowBox[{"2", "SQ"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"NB", "^", "2"}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"NB", "+", 
         RowBox[{"1", "/", "2"}]}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"Cosh", "[", 
          RowBox[{"2", "SQ"}], "]"}]}], ")"}]}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"hermtildeCDS", "[", 
    RowBox[{"MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], "]"}], "=", 
   RowBox[{"Divide", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"MALPHA", "*", 
       RowBox[{"Exp", "[", 
        RowBox[{"I", "*", 
         RowBox[{"PSI", "/", "2"}]}], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"1", "/", "2"}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"NB", "+", 
            RowBox[{"1", "/", "2"}]}], ")"}], "*", 
          RowBox[{"Cosh", "[", 
           RowBox[{"2", "SQ"}], "]"}]}]}], ")"}]}], "-", 
      RowBox[{"MALPHA", "*", 
       RowBox[{"Exp", "[", 
        RowBox[{
         RowBox[{"-", "I"}], "*", 
         RowBox[{"PSI", "/", "2"}]}], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{"NB", "+", 
         RowBox[{"1", "/", "2"}]}], ")"}], "*", 
       RowBox[{"Sinh", "[", 
        RowBox[{"2", "SQ"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"NB", "^", "2"}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"NB", "+", 
         RowBox[{"1", "/", "2"}]}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"Cosh", "[", 
          RowBox[{"2", "SQ"}], "]"}]}], ")"}]}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tildeC2", "[", 
    RowBox[{"ALPHA_", ",", "NB_", ",", "SQ_", ",", "PHI_"}], "]"}], "=", 
   RowBox[{"Divide", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"lC2", "[", 
        RowBox[{"ALPHA", ",", "SQ", ",", "PHI"}], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"1", "/", "2"}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"NB", "+", 
            RowBox[{"1", "/", "2"}]}], ")"}], "*", 
          RowBox[{"Cosh", "[", 
           RowBox[{"2", "SQ"}], "]"}]}]}], ")"}]}], "-", 
      RowBox[{
       RowBox[{"Conjugate", "[", 
        RowBox[{"lC2", "[", 
         RowBox[{"ALPHA", ",", "SQ", ",", "PHI"}], "]"}], "]"}], "*", 
       RowBox[{"Exp", "[", 
        RowBox[{"I", "*", "PHI"}], "]"}], "*", 
       RowBox[{"(", 
        RowBox[{"NB", "+", 
         RowBox[{"1", "/", "2"}]}], ")"}], "*", 
       RowBox[{"Sinh", "[", 
        RowBox[{"2", "SQ"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"NB", "^", "2"}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"NB", "+", 
         RowBox[{"1", "/", "2"}]}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"Cosh", "[", 
          RowBox[{"2", "SQ"}], "]"}]}], ")"}]}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"hermtildeCSD", "[", 
    RowBox[{"MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], "]"}], "=", 
   RowBox[{"Divide", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"MALPHA", "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", 
           RowBox[{"I", "*", 
            RowBox[{"PSI", "/", "2"}]}], "]"}], "*", 
          RowBox[{"Cosh", "[", "SQ", "]"}]}], "+", 
         RowBox[{
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "I"}], "*", 
            RowBox[{"PSI", "/", "2"}]}], "]"}], "*", 
          RowBox[{"Sinh", "[", "SQ", "]"}]}]}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"1", "/", "2"}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"NB", "+", 
            RowBox[{"1", "/", "2"}]}], ")"}], "*", 
          RowBox[{"Cosh", "[", 
           RowBox[{"2", "SQ"}], "]"}]}]}], ")"}]}], "-", 
      RowBox[{"MALPHA", "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "I"}], "*", 
            RowBox[{"PSI", "/", "2"}]}], "]"}], "*", 
          RowBox[{"Cosh", "[", "SQ", "]"}]}], "+", 
         RowBox[{
          RowBox[{"Exp", "[", 
           RowBox[{"I", "*", 
            RowBox[{"PSI", "/", "2"}]}], "]"}], "*", 
          RowBox[{"Sinh", "[", "SQ", "]"}]}]}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{"NB", "+", 
         RowBox[{"1", "/", "2"}]}], ")"}], "*", 
       RowBox[{"Sinh", "[", 
        RowBox[{"2", "SQ"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"NB", "^", "2"}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"NB", "+", 
         RowBox[{"1", "/", "2"}]}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"Cosh", "[", 
          RowBox[{"2", "SQ"}], "]"}]}], ")"}]}]}]}], "]"}]}], 
  ";"}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[263]:=",ExpressionUUID->"01c8233b-1c51-47cb-9d65-7e8f98890206"]
}, Closed]],

Cell[CellGroupData[{

Cell["Functions for P0", "Subsubsection",ExpressionUUID->"3a3f7185-577e-4735-8e24-1e6b239909e9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"normB", "[", 
     RowBox[{"NB_", ",", "SQ_"}], "]"}], "=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"2", "*", "NB"}], "+", "1"}], ")"}], "*", 
     RowBox[{"Sinh", "[", "SQ", "]"}], "*", 
     RowBox[{"Cosh", "[", "SQ", "]"}]}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"For", " ", "DSTS"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"normC2DS", "[", "MALPHA_", "]"}], "=", 
   RowBox[{"MALPHA", "^", "2"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"bcC2DS", "[", 
    RowBox[{"MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"-", 
     RowBox[{"normB", "[", 
      RowBox[{"NB", ",", "SQ"}], "]"}]}], "*", 
    RowBox[{"MALPHA", "^", "2"}], "*", 
    RowBox[{"Exp", "[", 
     RowBox[{
      RowBox[{"-", "I"}], "*", "PSI"}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"cBC2DS", "[", 
     RowBox[{"MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], "]"}], "=", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"normB", "[", 
       RowBox[{"NB", ",", "SQ"}], "]"}]}], "*", 
     RowBox[{"MALPHA", "^", "2"}], "*", 
     RowBox[{"Exp", "[", 
      RowBox[{"I", "*", "PSI"}], "]"}]}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"For", " ", "SDTS"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"normC2SD", "[", 
    RowBox[{"MALPHA_", ",", "SQ_", ",", "PSI_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"MALPHA", "^", "2"}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Sinh", "[", "SQ", "]"}], "^", "2"}], "+", 
      RowBox[{
       RowBox[{"Cosh", "[", "SQ", "]"}], "^", "2"}], "+", 
      RowBox[{
       RowBox[{"Sinh", "[", 
        RowBox[{"2", "SQ"}], "]"}], 
       RowBox[{"Cos", "[", "PSI", "]"}]}]}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"bcC2SD", "[", 
    RowBox[{"MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"-", 
     RowBox[{"normB", "[", 
      RowBox[{"NB", ",", "SQ"}], "]"}]}], "*", 
    RowBox[{"MALPHA", "^", "2"}], "*", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Cosh", "[", "SQ", "]"}], "^", "2"}], "*", 
       RowBox[{"Exp", "[", 
        RowBox[{
         RowBox[{"-", "I"}], "*", "PSI"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{
        RowBox[{"Sinh", "[", "SQ", "]"}], "^", "2"}], "*", 
       RowBox[{"Exp", "[", 
        RowBox[{"I", "*", "PSI"}], "]"}]}], "+", 
      RowBox[{"2", "*", 
       RowBox[{"Sinh", "[", "SQ", "]"}], "*", 
       RowBox[{"Cosh", "[", "SQ", "]"}]}]}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"cBC2SD", "[", 
     RowBox[{"MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], "]"}], "=", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"normB", "[", 
       RowBox[{"NB", ",", "SQ"}], "]"}]}], "*", 
     RowBox[{"MALPHA", "^", "2"}], "*", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Cosh", "[", "SQ", "]"}], "^", "2"}], "*", 
        RowBox[{"Exp", "[", 
         RowBox[{"I", "*", "PSI"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{
         RowBox[{"Sinh", "[", "SQ", "]"}], "^", "2"}], "*", 
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "I"}], "*", "PSI"}], "]"}]}], "+", 
       RowBox[{"2", "*", 
        RowBox[{"Sinh", "[", "SQ", "]"}], "*", 
        RowBox[{"Cosh", "[", "SQ", "]"}]}]}], ")"}]}]}], ";"}], "\n", 
  RowBox[{"(*", "*****)"}]}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[269]:=",ExpressionUUID->"fcf15c4f-7911-4ed9-9da0-d4d1016df06f"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{"lQ03DS", ",", "lQ03SD"}], "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"lQ03DS", "[", 
     RowBox[{"MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], "]"}], "=", 
    RowBox[{
     RowBox[{"Divide", "[", 
      RowBox[{"1", ",", "Pi"}], "]"}], "*", 
     RowBox[{"Sqrt", "[", 
      RowBox[{"Divide", "[", 
       RowBox[{"1", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"lA", "[", 
             RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "2"}], " ", "-", 
         " ", 
         RowBox[{
          RowBox[{"normB", "[", 
           RowBox[{"NB", ",", "SQ"}], "]"}], "^", "2"}]}]}], "]"}], "]"}], 
     "*", 
     RowBox[{"Exp", "[", 
      RowBox[{"-", 
       RowBox[{"Divide", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", 
             RowBox[{"lA", "[", 
              RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "*", 
           RowBox[{"normC2DS", "[", "MALPHA", "]"}]}], " ", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "/", "2"}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"bcC2DS", "[", 
              RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], 
             "+", 
             RowBox[{"cBC2DS", "[", 
              RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}]}], 
            ")"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", 
             RowBox[{"lA", "[", 
              RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "2"}], " ", "-",
           " ", 
          RowBox[{
           RowBox[{"normB", "[", 
            RowBox[{"NB", ",", "SQ"}], "]"}], "^", "2"}]}]}], "]"}]}], 
      "]"}]}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"lQ03SD", "[", 
    RowBox[{"MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], "]"}], "=", 
   RowBox[{
    RowBox[{"Divide", "[", 
     RowBox[{"1", ",", "Pi"}], "]"}], "*", 
    RowBox[{"Sqrt", "[", 
     RowBox[{"Divide", "[", 
      RowBox[{"1", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", 
           RowBox[{"lA", "[", 
            RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "2"}], " ", "-", 
        " ", 
        RowBox[{
         RowBox[{"normB", "[", 
          RowBox[{"NB", ",", "SQ"}], "]"}], "^", "2"}]}]}], "]"}], "]"}], "*", 
    RowBox[{"Exp", "[", 
     RowBox[{"-", 
      RowBox[{"Divide", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"lA", "[", 
             RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "*", 
          RowBox[{"normC2SD", "[", 
           RowBox[{"MALPHA", ",", "SQ", ",", "PSI"}], "]"}]}], " ", "+", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "/", "2"}], ")"}], "*", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"bcC2SD", "[", 
             RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], "+", 
            RowBox[{"cBC2SD", "[", 
             RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}]}], 
           ")"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"lA", "[", 
             RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "2"}], " ", "-", 
         " ", 
         RowBox[{
          RowBox[{"normB", "[", 
           RowBox[{"NB", ",", "SQ"}], "]"}], "^", "2"}]}]}], "]"}]}], 
     "]"}]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[276]:=",ExpressionUUID->"8f46c0f2-2db6-4988-a098-b7742f2dcab0"],

Cell[BoxData[{
 RowBox[{"Clear", "[", 
  RowBox[{"lQ02DS", ",", "lQ02SD"}], "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"lQ02DS", "[", 
    RowBox[{"NB_", ",", "SQ_", ",", "PHI_", ",", "ALPHA_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Divide", "[", 
     RowBox[{"1", ",", "Pi"}], "]"}], "*", 
    RowBox[{"Sqrt", "[", 
     RowBox[{"Divide", "[", 
      RowBox[{"1", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", 
           RowBox[{"lA", "[", 
            RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "2"}], " ", "-", 
        " ", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"lB", "[", 
           RowBox[{"NB", ",", "SQ", ",", "PHI"}], "]"}], "]"}], "^", 
         "2"}]}]}], "]"}], "]"}], "*", 
    RowBox[{"Exp", "[", 
     RowBox[{"-", 
      RowBox[{"Divide", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"lA", "[", 
             RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "*", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"lC", "[", "ALPHA", "]"}], "]"}], "^", "2"}]}], " ", "+", 
         " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "/", "2"}], ")"}], "*", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"lB", "[", 
              RowBox[{"NB", ",", "SQ", ",", "PHI"}], "]"}], "*", 
             RowBox[{
              RowBox[{"Conjugate", "[", 
               RowBox[{"lC", "[", "ALPHA", "]"}], "]"}], "^", "2"}]}], " ", 
            "+", " ", 
            RowBox[{
             RowBox[{"Conjugate", "[", 
              RowBox[{"lB", "[", 
               RowBox[{"NB", ",", "SQ", ",", "PHI"}], "]"}], "]"}], "*", 
             RowBox[{
              RowBox[{"lC", "[", "ALPHA", "]"}], "^", "2"}]}]}], ")"}]}]}], 
        ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"lA", "[", 
             RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "2"}], " ", "-", 
         " ", 
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{"lB", "[", 
            RowBox[{"NB", ",", "SQ", ",", "PHI"}], "]"}], "]"}], "^", 
          "2"}]}]}], "]"}]}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"lQ02SD", "[", 
    RowBox[{"NB_", ",", "SQ_", ",", "PHI_", ",", "ALPHA_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Divide", "[", 
     RowBox[{"1", ",", "Pi"}], "]"}], "*", 
    RowBox[{"Sqrt", "[", 
     RowBox[{"Divide", "[", 
      RowBox[{"1", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", 
           RowBox[{"lA", "[", 
            RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "2"}], " ", "-", 
        " ", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"lB", "[", 
           RowBox[{"NB", ",", "SQ", ",", "PHI"}], "]"}], "]"}], "^", 
         "2"}]}]}], "]"}], "]"}], "*", 
    RowBox[{"Exp", "[", 
     RowBox[{"-", 
      RowBox[{"Divide", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"lA", "[", 
             RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "*", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"lC2", "[", 
             RowBox[{"ALPHA", ",", "SQ", ",", "PHI"}], "]"}], "]"}], "^", 
           "2"}]}], " ", "+", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "/", "2"}], ")"}], "*", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"lB", "[", 
              RowBox[{"NB", ",", "SQ", ",", "PHI"}], "]"}], "*", 
             RowBox[{
              RowBox[{"Conjugate", "[", 
               RowBox[{"lC2", "[", 
                RowBox[{"ALPHA", ",", "SQ", ",", "PHI"}], "]"}], "]"}], "^", 
              "2"}]}], " ", "+", " ", 
            RowBox[{
             RowBox[{"Conjugate", "[", 
              RowBox[{"lB", "[", 
               RowBox[{"NB", ",", "SQ", ",", "PHI"}], "]"}], "]"}], "*", 
             RowBox[{
              RowBox[{"lC2", "[", 
               RowBox[{"ALPHA", ",", "SQ", ",", "PHI"}], "]"}], "^", 
              "2"}]}]}], ")"}]}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"lA", "[", 
             RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "2"}], " ", "-", 
         " ", 
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{"lB", "[", 
            RowBox[{"NB", ",", "SQ", ",", "PHI"}], "]"}], "]"}], "^", 
          "2"}]}]}], "]"}]}], "]"}]}]}], ";"}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[279]:=",ExpressionUUID->"f3ba8a96-925d-422a-9915-90b0c86cfd0b"]
}, Closed]],

Cell[CellGroupData[{

Cell["R Functions for Pn", "Subsubsection",ExpressionUUID->"27cbfdc4-1c6b-424e-bf58-f856eeef534f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Still", " ", "not", " ", "working", " ", 
    RowBox[{"(", " ", 
     RowBox[{"equation", " ", "5.5"}], " "}]}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"functionR1DS", ",", "functionR1SD"}], "]"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"functionR1DS", "[", 
      RowBox[{"n_", ",", "ALPHA_", ",", "NB_", ",", "SQ_", ",", "PHI_"}], 
      "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"tildeA", "[", 
        RowBox[{"NB", ",", "SQ"}], "]"}], "^", "n"}], "*", 
      RowBox[{"(", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Divide", "[", 
           RowBox[{
            RowBox[{"Factorial", "[", "n", "]"}], ",", 
            RowBox[{
             RowBox[{"Factorial", "[", "k", "]"}], "*", 
             RowBox[{
              RowBox[{"Factorial", "[", 
               RowBox[{"n", "-", "k"}], "]"}], "^", "2"}]}]}], "]"}], "*", 
          RowBox[{"Divide", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Abs", "[", 
              RowBox[{"tildeB", "[", 
               RowBox[{"NB", ",", "SQ", ",", "PHI"}], "]"}], "]"}], "^", 
             "k"}], ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"2", 
               RowBox[{"tildeA", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "k"}]}], 
           "]"}], "*", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"HermiteH", "[", 
             RowBox[{"k", ",", 
              RowBox[{"Divide", "[", 
               RowBox[{
                RowBox[{"tildeC", "[", 
                 RowBox[{"ALPHA", ",", "NB", ",", "SQ", ",", "PHI"}], "]"}], 
                ",", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"2", 
                  RowBox[{"tildeB", "[", 
                   RowBox[{"NB", ",", "SQ", ",", "PHI"}], "]"}]}], "]"}]}], 
               "]"}]}], "]"}], "]"}], "^", "2"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "0", ",", "n"}], "}"}]}], "]"}], ")"}]}]}], ";"}],
    "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"functionR1SD", "[", 
      RowBox[{"n_", ",", "ALPHA_", ",", "NB_", ",", "SQ_", ",", "PHI_"}], 
      "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"tildeA", "[", 
        RowBox[{"NB", ",", "SQ"}], "]"}], "^", "n"}], "*", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Divide", "[", 
          RowBox[{"1", ",", 
           RowBox[{"Factorial", "[", "k", "]"}]}], "]"}], "*", 
         RowBox[{"Binomial", "[", 
          RowBox[{"n", ",", "k"}], "]"}], "*", 
         RowBox[{"Divide", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"tildeB", "[", 
              RowBox[{"NB", ",", "SQ", ",", "PHI"}], "]"}], "]"}], "^", "k"}],
            ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"2", 
              RowBox[{"tildeA", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "k"}]}], "]"}],
          "*", 
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{"HermiteH", "[", 
            RowBox[{"k", ",", 
             RowBox[{
              RowBox[{"Divide", "[", 
               RowBox[{"1", ",", 
                RowBox[{"2", 
                 RowBox[{"Sqrt", "[", 
                  RowBox[{"tildeB", "[", 
                   RowBox[{"NB", ",", "SQ", ",", "PHI"}], "]"}], "]"}]}]}], 
               "]"}], "*", 
              RowBox[{"tildeC2", "[", 
               RowBox[{"ALPHA", ",", "NB", ",", "SQ", ",", "PHI"}], "]"}]}]}],
             "]"}], "]"}], "^", "2"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "0", ",", "n"}], "}"}]}], "]"}]}]}], 
    ";"}]}]}]], "Input",
 CellLabel->
  "In[282]:=",ExpressionUUID->"2157adcc-0564-4095-8ae7-213aa590b9a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "**********************************************)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
   "Function", " ", "R", " ", "for", " ", "Displaced", " ", "Squeezed", " ", 
    "thermal", " ", "states"}], "*)"}], "\n", 
  RowBox[{"(*", "**********************************************)"}], "\n", 
  "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"From", " ", "equation", " ", "5.6"}], ":"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"functionR2DS", "[", 
      RowBox[{"n_", ",", "ALPHA_", ",", "NB_", ",", "SQ_", ",", "PHI_"}], 
      "]"}], ":=", 
     RowBox[{
      RowBox[{"Divide", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"-", "1"}], ")"}], "^", "n"}], ",", 
        RowBox[{"2", "^", 
         RowBox[{"(", 
          RowBox[{"2", "n"}], ")"}]}]}], "]"}], "*", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"tildeA", "[", 
          RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
         RowBox[{"normtildeB", "[", 
          RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "n"}], "*", "\n", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Divide", "[", 
          RowBox[{"1", ",", 
           RowBox[{
            RowBox[{"Factorial", "[", "k", "]"}], "*", 
            RowBox[{"Factorial", "[", 
             RowBox[{"n", "-", "k"}], "]"}]}]}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Divide", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"tildeA", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}], "-", 
              RowBox[{"normtildeB", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"tildeA", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
              RowBox[{"normtildeB", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}]}]}], "]"}], "^", "k"}], ")"}],
          "*", "\n", 
         RowBox[{"HermiteH", "[", 
          RowBox[{
           RowBox[{"2", "k"}], ",", 
           RowBox[{"Divide", "[", 
            RowBox[{
             RowBox[{"I", "*", 
              RowBox[{"Im", "[", 
               RowBox[{
                RowBox[{"tildeC", "[", 
                 RowBox[{"ALPHA", ",", "NB", ",", "SQ", ",", "PHI"}], "]"}], 
                "*", 
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", "I"}], "*", 
                  RowBox[{"PHI", "/", "2"}]}], "]"}]}], "]"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"tildeA", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}], "-", 
               RowBox[{"normtildeB", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}]}], "]"}]}], "]"}]}], "]"}], 
         "*", 
         RowBox[{"HermiteH", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"2", "n"}], "-", 
            RowBox[{"2", "k"}]}], ",", 
           RowBox[{"Divide", "[", 
            RowBox[{
             RowBox[{"I", "*", 
              RowBox[{"Re", "[", 
               RowBox[{
                RowBox[{"tildeC", "[", 
                 RowBox[{"ALPHA", ",", "NB", ",", "SQ", ",", "PHI"}], "]"}], 
                "*", 
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", "I"}], "*", 
                  RowBox[{"PHI", "/", "2"}]}], "]"}]}], "]"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"tildeA", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
               RowBox[{"normtildeB", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}]}], "]"}]}], "]"}]}], "]"}]}],
         ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "0", ",", "n"}], "}"}]}], "]"}]}]}], ";"}], "\n", 
   RowBox[{"(*", 
    RowBox[{
    "Function", " ", "of", " ", "norm", " ", "of", " ", "alpha", " ", "and", 
     " ", "the", " ", "relative", " ", 
     RowBox[{"phase", ":"}]}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"functionR3DS", "[", 
      RowBox[{"n_", ",", "MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], 
      "]"}], ":=", 
     RowBox[{
      RowBox[{"Divide", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"-", "1"}], ")"}], "^", "n"}], ",", 
        RowBox[{"2", "^", 
         RowBox[{"(", 
          RowBox[{"2", "n"}], ")"}]}]}], "]"}], "*", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"tildeA", "[", 
          RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
         RowBox[{"normtildeB", "[", 
          RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "n"}], "*", "\n", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Divide", "[", 
          RowBox[{"1", ",", 
           RowBox[{
            RowBox[{"Factorial", "[", "k", "]"}], "*", 
            RowBox[{"Factorial", "[", 
             RowBox[{"n", "-", "k"}], "]"}]}]}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Divide", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"tildeA", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}], "-", 
              RowBox[{"normtildeB", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"tildeA", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
              RowBox[{"normtildeB", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}]}]}], "]"}], "^", "k"}], ")"}],
          "*", "\n", 
         RowBox[{"HermiteH", "[", 
          RowBox[{
           RowBox[{"2", "k"}], ",", 
           RowBox[{"Divide", "[", 
            RowBox[{
             RowBox[{"I", "*", 
              RowBox[{"Im", "[", 
               RowBox[{"hermtildeCDS", "[", 
                RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], 
               "]"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"tildeA", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}], "-", 
               RowBox[{"normtildeB", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}]}], "]"}]}], "]"}]}], "]"}], 
         "*", 
         RowBox[{"HermiteH", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"2", "n"}], "-", 
            RowBox[{"2", "k"}]}], ",", 
           RowBox[{"Divide", "[", 
            RowBox[{
             RowBox[{"I", "*", 
              RowBox[{"Re", "[", 
               RowBox[{"hermtildeCDS", "[", 
                RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], 
               "]"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"tildeA", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
               RowBox[{"normtildeB", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}]}], "]"}]}], "]"}]}], "]"}]}],
         ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "0", ",", "n"}], "}"}]}], "]"}]}]}], ";"}], "\n", 
   "\n", 
   RowBox[{"(*", "**********************************************)"}], "\n", 
   RowBox[{"(*", 
    RowBox[{
    "Function", " ", "R", " ", "for", " ", "Squeezed", " ", "Displaced", " ", 
     "thermal", " ", "states"}], "*)"}], "\n", 
   RowBox[{"(*", "**********************************************)"}], "\n", 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"functionR2SD", "[", 
      RowBox[{"n_", ",", "ALPHA_", ",", "NB_", ",", "SQ_", ",", "PHI_"}], 
      "]"}], ":=", 
     RowBox[{
      RowBox[{"Divide", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"-", "1"}], ")"}], "^", "n"}], ",", 
        RowBox[{"2", "^", 
         RowBox[{"(", 
          RowBox[{"2", "n"}], ")"}]}]}], "]"}], "*", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"tildeA", "[", 
          RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
         RowBox[{"normtildeB", "[", 
          RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "n"}], "*", "\n", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Divide", "[", 
          RowBox[{"1", ",", 
           RowBox[{
            RowBox[{"Factorial", "[", "k", "]"}], "*", 
            RowBox[{"Factorial", "[", 
             RowBox[{"n", "-", "k"}], "]"}]}]}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Divide", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"tildeA", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}], "-", 
              RowBox[{"normtildeB", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"tildeA", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
              RowBox[{"normtildeB", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}]}]}], "]"}], "^", "k"}], ")"}],
          "*", "\n", 
         RowBox[{"HermiteH", "[", 
          RowBox[{
           RowBox[{"2", "k"}], ",", 
           RowBox[{"Divide", "[", 
            RowBox[{
             RowBox[{"I", "*", 
              RowBox[{"Im", "[", 
               RowBox[{
                RowBox[{"tildeC2", "[", 
                 RowBox[{"ALPHA", ",", "NB", ",", "SQ", ",", "PHI"}], "]"}], 
                "*", 
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", "I"}], "*", 
                  RowBox[{"PHI", "/", "2"}]}], "]"}]}], "]"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"tildeA", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}], "-", 
               RowBox[{"normtildeB", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}]}], "]"}]}], "]"}]}], "]"}], 
         "*", 
         RowBox[{"HermiteH", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"2", "n"}], "-", 
            RowBox[{"2", "k"}]}], ",", 
           RowBox[{"Divide", "[", 
            RowBox[{
             RowBox[{"I", "*", 
              RowBox[{"Re", "[", 
               RowBox[{
                RowBox[{"tildeC2", "[", 
                 RowBox[{"ALPHA", ",", "NB", ",", "SQ", ",", "PHI"}], "]"}], 
                "*", 
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", "I"}], "*", 
                  RowBox[{"PHI", "/", "2"}]}], "]"}]}], "]"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"tildeA", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
               RowBox[{"normtildeB", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}]}], "]"}]}], "]"}]}], "]"}]}],
         ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "0", ",", "n"}], "}"}]}], "]"}]}]}], ";"}], "\n", 
   RowBox[{"(*", 
    RowBox[{
    "Function", " ", "of", " ", "norm", " ", "of", " ", "alpha", " ", "and", 
     " ", "the", " ", "relative", " ", 
     RowBox[{"phase", ":"}]}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"functionR3SD", "[", 
      RowBox[{"n_", ",", "MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], 
      "]"}], ":=", 
     RowBox[{
      RowBox[{"Divide", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"-", "1"}], ")"}], "^", "n"}], ",", 
        RowBox[{"2", "^", 
         RowBox[{"(", 
          RowBox[{"2", "n"}], ")"}]}]}], "]"}], "*", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"tildeA", "[", 
          RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
         RowBox[{"normtildeB", "[", 
          RowBox[{"NB", ",", "SQ"}], "]"}]}], ")"}], "^", "n"}], "*", "\n", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Divide", "[", 
          RowBox[{"1", ",", 
           RowBox[{
            RowBox[{"Factorial", "[", "k", "]"}], "*", 
            RowBox[{"Factorial", "[", 
             RowBox[{"n", "-", "k"}], "]"}]}]}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Divide", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"tildeA", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}], "-", 
              RowBox[{"normtildeB", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"tildeA", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
              RowBox[{"normtildeB", "[", 
               RowBox[{"NB", ",", "SQ"}], "]"}]}]}], "]"}], "^", "k"}], ")"}],
          "*", "\n", 
         RowBox[{"HermiteH", "[", 
          RowBox[{
           RowBox[{"2", "k"}], ",", 
           RowBox[{"Divide", "[", 
            RowBox[{
             RowBox[{"I", "*", 
              RowBox[{"Im", "[", 
               RowBox[{"hermtildeCSD", "[", 
                RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], 
               "]"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"tildeA", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}], "-", 
               RowBox[{"normtildeB", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}]}], "]"}]}], "]"}]}], "]"}], 
         "*", 
         RowBox[{"HermiteH", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"2", "n"}], "-", 
            RowBox[{"2", "k"}]}], ",", 
           RowBox[{"Divide", "[", 
            RowBox[{
             RowBox[{"I", "*", 
              RowBox[{"Re", "[", 
               RowBox[{"hermtildeCSD", "[", 
                RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], 
               "]"}]}], ",", 
             RowBox[{"Sqrt", "[", 
              RowBox[{
               RowBox[{"tildeA", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
               RowBox[{"normtildeB", "[", 
                RowBox[{"NB", ",", "SQ"}], "]"}]}], "]"}]}], "]"}]}], "]"}]}],
         ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "0", ",", "n"}], "}"}]}], "]"}]}]}], ";"}], 
   "\n"}]}]], "Input",
 CellLabel->
  "In[285]:=",ExpressionUUID->"1bff46ad-0916-4922-8092-18dcb7391d25"],

Cell[BoxData[""], "Input",
 CellLabel->
  "In[289]:=",ExpressionUUID->"d934405d-6ab4-40df-b605-835e54312278"],

Cell[BoxData[""], "Input",
 CellLabel->
  "In[290]:=",ExpressionUUID->"f102d34b-3a45-43a2-aba3-af5325312b63"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{
   "pnDGaussianM1DS", ",", "pnDGaussianM1SD", ",", "pnDGaussianM2DS", ",", 
    "pnDGaussianM2SD", ",", "pnDGaussianM3DS", ",", "pnDGaussianM3SD"}], 
   "]"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"Equation", " ", "5.5"}], " ", "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"Not", " ", "working", " ", 
    RowBox[{"yet", "!"}]}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"pnDGaussianM1DS", "[", 
    RowBox[{"n_", ",", "ALPHA_", ",", "SQ_", ",", "NB_", ",", "PHI_"}], "]"}],
    ":=", 
   RowBox[{"Pi", "*", 
    RowBox[{"lQ0", "[", 
     RowBox[{"NB", ",", "SQ", ",", "PHI", ",", "ALPHA"}], "]"}], "*", 
    RowBox[{"functionR1DS", "[", 
     RowBox[{"n", ",", "ALPHA", ",", "NB", ",", "SQ", ",", "PHI"}], "]"}]}]}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"pnDGaussianM1SD", "[", 
     RowBox[{"n_", ",", "ALPHA_", ",", "SQ_", ",", "NB_", ",", "PHI_"}], 
     "]"}], ":=", 
    RowBox[{"Pi", "*", 
     RowBox[{"lQ0", "[", 
      RowBox[{"NB", ",", "SQ", ",", "PHI", ",", "ALPHA"}], "]"}], "*", 
     RowBox[{"functionR1SD", "[", 
      RowBox[{"n", ",", "ALPHA", ",", "NB", ",", "SQ", ",", "PHI"}], 
      "]"}]}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"Equation", " ", "5.6"}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"pnDGaussianM2DS", "[", 
    RowBox[{"n_", ",", "ALPHA_", ",", "SQ_", ",", "NB_", ",", "PHI_"}], "]"}],
    ":=", 
   RowBox[{"Pi", "*", 
    RowBox[{"lQ02DS", "[", 
     RowBox[{"NB", ",", "SQ", ",", "PHI", ",", "ALPHA"}], "]"}], "*", 
    RowBox[{"functionR2DS", "[", 
     RowBox[{"n", ",", "ALPHA", ",", "NB", ",", "SQ", ",", "PHI"}], "]"}]}]}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"pnDGaussianM2SD", "[", 
     RowBox[{"n_", ",", "ALPHA_", ",", "SQ_", ",", "NB_", ",", "PHI_"}], 
     "]"}], ":=", 
    RowBox[{"Pi", "*", 
     RowBox[{"lQ02SD", "[", 
      RowBox[{"NB", ",", "SQ", ",", "PHI", ",", "ALPHA"}], "]"}], "*", 
     RowBox[{"functionR2SD", "[", 
      RowBox[{"n", ",", "ALPHA", ",", "NB", ",", "SQ", ",", "PHI"}], 
      "]"}]}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"Equation", " ", "5.6"}], " ", "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Now", " ", "the", " ", "Pn", " ", "for", " ", "Displaced", " ", 
     "Squeezed", " ", "and", " ", "Squeezed", " ", "displaced", " ", 
     "thermal", " ", "states", " ", "as", " ", "function", " ", "of", " ", 
     "relative", " ", "phase", " ", "PSI", " ", "and"}], " ", "|", "alpha", 
    "|"}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"pnDGaussianM3DS", "[", 
     RowBox[{"n_", ",", "MALPHA_", ",", "SQ_", ",", "NB_", ",", "PSI_"}], 
     "]"}], ":=", 
    RowBox[{"Pi", "*", 
     RowBox[{"lQ03DS", "[", 
      RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], "*", 
     RowBox[{"functionR3DS", "[", 
      RowBox[{"n", ",", "MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], 
      "]"}]}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"pnDGaussianM3SD", "[", 
      RowBox[{"n_", ",", "MALPHA_", ",", "SQ_", ",", "NB_", ",", "PSI_"}], 
      "]"}], ":=", 
     RowBox[{"Pi", "*", 
      RowBox[{"lQ03SD", "[", 
       RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], "*", 
      RowBox[{"functionR3SD", "[", 
       RowBox[{"n", ",", "MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], 
       "]"}]}]}], ";"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"pnDGaussianM3SD", "[", 
    RowBox[{"n_", ",", "MALPHA_", ",", "SQ_", ",", "NB_", ",", "PSI_"}], 
    "]"}], ":=", 
   RowBox[{"Refine", "[", 
    RowBox[{
     RowBox[{"Re", "[", 
      RowBox[{"Pi", "*", 
       RowBox[{"lQ03SD", "[", 
        RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], "*", 
       RowBox[{"functionR3SD", "[", 
        RowBox[{"n", ",", "MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], 
        "]"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Element", "[", 
        RowBox[{"MALPHA", ",", "Reals"}], "]"}], ",", 
       RowBox[{"Element", "[", 
        RowBox[{"SQ", ",", "Reals"}], "]"}], ",", 
       RowBox[{"Element", "[", 
        RowBox[{"NB", ",", "Reals"}], "]"}], ",", 
       RowBox[{"Element", "[", 
        RowBox[{"PSI", ",", "Reals"}], "]"}]}], "}"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellLabel->
  "In[291]:=",ExpressionUUID->"fb58b7d6-c957-4a2d-9dec-2832f80c43ae"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"pnCoherent", "[", 
    RowBox[{"n_", ",", "vp_", ",", "vq_", ",", "mq_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"P0", "[", 
     RowBox[{
      RowBox[{"matrixM", "[", 
       RowBox[{"vp", ",", "0", ",", "vq"}], "]"}], ",", "mq", ",", "0"}], 
     "]"}], "*", 
    RowBox[{
     RowBox[{"hermiteH2D", "[", 
      RowBox[{"n", ",", 
       RowBox[{"matrixR", "[", 
        RowBox[{
         RowBox[{"matrixM", "[", 
          RowBox[{"vp", ",", "0", ",", "vq"}], "]"}], ",", "mq", ",", "0"}], 
        "]"}], ",", 
       RowBox[{"etaVec", "[", 
        RowBox[{
         RowBox[{"matrixR", "[", 
          RowBox[{
           RowBox[{"matrixM", "[", 
            RowBox[{"vp", ",", "0", ",", "vq"}], "]"}], ",", "mq", ",", "0"}],
           "]"}], ",", 
         RowBox[{"yVec", "[", 
          RowBox[{
           RowBox[{"matrixM", "[", 
            RowBox[{"vp", ",", "0", ",", "vq"}], "]"}], ",", 
           RowBox[{"zVec", "[", 
            RowBox[{"mq", ",", "0"}], "]"}]}], "]"}]}], "]"}]}], "]"}], "/", 
     RowBox[{"Factorial", "[", "n", "]"}]}]}]}], ";"}]], "Input",
 CellLabel->
  "In[298]:=",ExpressionUUID->"f45e9652-acf0-4db0-b125-6ba12c3787dc"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Pn for Squeezed Displaced Thermal State State- V.3 (Mathematica)\
\>", "Subsection",ExpressionUUID->"2053399e-a2b8-471b-b508-1e8c6559d9ec"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Simplifyied", " ", "version", " ", "by", " ", "mathematica"}], 
   "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "MALPHA", ",", "NB", ",", "SQ", ",", "PSI", ",", "lQ0V3", ",", "fSumV3", 
     ",", "pnV3"}], "]"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"f1", "[", 
      RowBox[{"NB_", ",", "SQ_"}], "]"}], "=", 
     RowBox[{"FullSimplify", "[", 
      RowBox[{
       RowBox[{"tildeA", "[", 
        RowBox[{"NB", ",", "SQ"}], "]"}], "+", 
       RowBox[{"normtildeB", "[", 
        RowBox[{"NB", ",", "SQ"}], "]"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"f2", "[", 
      RowBox[{"NB_", ",", "SQ_"}], "]"}], " ", "=", " ", 
     RowBox[{"FullSimplify", "[", 
      RowBox[{
       RowBox[{"tildeA", "[", 
        RowBox[{"NB", ",", "SQ"}], "]"}], "-", 
       RowBox[{"normtildeB", "[", 
        RowBox[{"NB", ",", "SQ"}], "]"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"f3", "[", 
      RowBox[{"MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], "]"}], " ", 
     "=", " ", 
     RowBox[{"FullSimplify", "[", 
      RowBox[{"hermtildeCSD", "[", 
       RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], "]"}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"lQ0V3", "[", 
      RowBox[{"MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], "]"}], "=", 
     RowBox[{"FullSimplify", "[", 
      RowBox[{"lQ03SD", "[", 
       RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], "]"}]}], 
    ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"fSumV3", "[", 
     RowBox[{"n_", ",", "MALPHA_", ",", "NB_", ",", "SQ_", ",", "PSI_"}], 
     "]"}], ":=", 
    RowBox[{
     RowBox[{"Divide", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"-", "1"}], ")"}], "^", "n"}], ",", 
       RowBox[{"2", "^", 
        RowBox[{"(", 
         RowBox[{"2", "n"}], ")"}]}]}], "]"}], "*", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"f1", "[", 
        RowBox[{"NB", ",", "SQ"}], "]"}], ")"}], "^", "n"}], "*", "\n", 
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Divide", "[", 
         RowBox[{"1", ",", 
          RowBox[{
           RowBox[{"Factorial", "[", "k", "]"}], "*", 
           RowBox[{"Factorial", "[", 
            RowBox[{"n", "-", "k"}], "]"}]}]}], "]"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Divide", "[", 
           RowBox[{
            RowBox[{"f2", "[", 
             RowBox[{"NB", ",", "SQ"}], "]"}], ",", 
            RowBox[{"f1", "[", 
             RowBox[{"NB", ",", "SQ"}], "]"}]}], "]"}], "^", "k"}], ")"}], 
        "*", "\n", 
        RowBox[{"HermiteH", "[", 
         RowBox[{
          RowBox[{"2", "k"}], ",", 
          RowBox[{"Divide", "[", 
           RowBox[{
            RowBox[{"I", "*", 
             RowBox[{"Im", "[", 
              RowBox[{"f3", "[", 
               RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], 
              "]"}]}], ",", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"f2", "[", 
              RowBox[{"NB", ",", "SQ"}], "]"}], "]"}]}], "]"}]}], "]"}], "*", 
        RowBox[{"HermiteH", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"2", "n"}], "-", 
           RowBox[{"2", "k"}]}], ",", 
          RowBox[{"Divide", "[", 
           RowBox[{
            RowBox[{"I", "*", 
             RowBox[{"Re", "[", 
              RowBox[{"f3", "[", 
               RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], 
              "]"}]}], ",", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"f1", "[", 
              RowBox[{"NB", ",", "SQ"}], "]"}], "]"}]}], "]"}]}], "]"}]}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0", ",", "n"}], "}"}]}], "]"}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"pnV3", "[", 
      RowBox[{"n_", ",", "MALPHA_", ",", "SQ_", ",", "NB_", ",", "PSI_"}], 
      "]"}], ":=", 
     RowBox[{"Re", "[", 
      RowBox[{"Pi", "*", 
       RowBox[{"lQ0V3", "[", 
        RowBox[{"MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], "]"}], "*", 
       RowBox[{"fSumV3", "[", 
        RowBox[{"n", ",", "MALPHA", ",", "NB", ",", "SQ", ",", "PSI"}], 
        "]"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"pnV3N", "[", 
      RowBox[{
       RowBox[{"n_", "?", "NumericQ"}], ",", 
       RowBox[{"MALPHA_", "?", "NumericQ"}], ",", 
       RowBox[{"SQ_", "?", "NumericQ"}], ",", 
       RowBox[{"NB_", "?", "NumericQ"}], ",", 
       RowBox[{"PSI_", "?", "NumericQ"}]}], "]"}], ":=", 
     RowBox[{"pnV3", "[", 
      RowBox[{"n", ",", "MALPHA", ",", "SQ", ",", "NB", ",", "PSI"}], "]"}]}],
     ";"}]}]}]], "Input",
 CellLabel->
  "In[299]:=",ExpressionUUID->"a375e839-2cb9-4778-b154-e3729719c025"]
}, Closed]],

Cell[CellGroupData[{

Cell["P_down(t)", "Subsection",
 InitializationCell->
  True,ExpressionUUID->"7a892184-4d84-4b63-aca5-1c75659e9eaf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Functions", "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "ALPHA", ",", "R", ",", "NBAR", ",", "PHASE", ",", "OMEGA", ",", "pDownt",
      ",", "pDowntN0", ",", "pDowntVec"}], "]"}], "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"P", 
      RowBox[{"(", "t", ")"}], " ", "as", " ", "a", " ", "function", " ", 
      "of", " ", "gamma"}], ",", " ", "n", ",", " ", 
     RowBox[{"VP", " ", "and", " ", "VQ"}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"pDownt", "[", 
      RowBox[{
      "ALPHA_", ",", "R_", ",", "NBAR_", ",", "PHASE_", ",", "t_", ",", "NF_",
        ",", "OMEGA_", ",", "GAMMA_"}], "]"}], ":=", 
     RowBox[{"0.5", "+", 
      RowBox[{"0.5", "*", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"pnV3", "[", 
           RowBox[{"n", ",", "ALPHA", ",", "R", ",", "NBAR", ",", "PHASE"}], 
           "]"}], "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"OMEGA", "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "GAMMA"}], "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "0", ",", "NF"}], "}"}]}], "]"}]}]}]}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"pDowntN", "[", 
      RowBox[{
       RowBox[{"ALPHA_", "?", "NumericQ"}], ",", 
       RowBox[{"R_", "?", "NumericQ"}], ",", 
       RowBox[{"NBAR_", "?", "NumericQ"}], ",", 
       RowBox[{"PHASE_", "?", "NumericQ"}], ",", "t_", ",", 
       RowBox[{"NF_", "?", "NumericQ"}], ",", 
       RowBox[{"OMEGA_", "?", "NumericQ"}], ",", 
       RowBox[{"GAMMA_", "?", "NumericQ"}]}], "]"}], ":=", 
     RowBox[{"0.5", "+", 
      RowBox[{"0.5", "*", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"pnV3N", "[", 
           RowBox[{"n", ",", "ALPHA", ",", "R", ",", "NBAR", ",", "PHASE"}], 
           "]"}], "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"OMEGA", "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "GAMMA"}], "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "0", ",", "NF"}], "}"}]}], "]"}]}]}]}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"pDowntVec", "[", 
      RowBox[{"PVEC_", ",", "t_", ",", "NF_", ",", "OMEGA_", ",", "GAMMA_"}], 
      "]"}], ":=", 
     RowBox[{"0.5", "+", 
      RowBox[{"0.5", "*", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"PVEC", "[", "n", "]"}], "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"OMEGA", "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "GAMMA"}], "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "0", ",", "NF"}], "}"}]}], "]"}]}]}]}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"pDowntN0", "[", 
      RowBox[{"t_", ",", "PN0_", ",", "OMEGA_", ",", "GAMMA_"}], "]"}], ":=", 
     RowBox[{"0.5", "+", 
      RowBox[{"0.5", "*", "PN0", "*", 
       RowBox[{"Cos", "[", 
        RowBox[{"OMEGA", "*", "t"}], "]"}], "*", 
       RowBox[{"Exp", "[", 
        RowBox[{
         RowBox[{"-", "GAMMA"}], "*", "t"}], "]"}]}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"pDowntN01", "[", 
      RowBox[{"t_", ",", "PN0_", ",", "PN1_", ",", "OMEGA_", ",", "GAMMA_"}], 
      "]"}], ":=", 
     RowBox[{"0.5", "+", 
      RowBox[{"0.5", "*", "PN0", "*", 
       RowBox[{"Cos", "[", 
        RowBox[{"OMEGA", "*", "t"}], "]"}], "*", 
       RowBox[{"Exp", "[", 
        RowBox[{
         RowBox[{"-", "GAMMA"}], "*", "t"}], "]"}]}], "+", 
      RowBox[{"0.5", "*", "PN1", "*", 
       RowBox[{"Cos", "[", 
        RowBox[{"OMEGA", "*", 
         RowBox[{"Sqrt", "[", "2", "]"}], "*", "t"}], "]"}], "*", 
       RowBox[{"Exp", "[", 
        RowBox[{
         RowBox[{"-", "GAMMA"}], "*", 
         RowBox[{"Sqrt", "[", "2", "]"}], "*", "t"}], "]"}]}]}]}], ";"}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"PtList", "[", 
      RowBox[{"pnList_", ",", "t_", ",", "nFockFinal_", ",", "gamma_"}], 
      "]"}], ":=", 
     RowBox[{"0.5", "+", 
      RowBox[{"0.5", "*", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"pnList", "[", 
           RowBox[{"[", 
            RowBox[{"n", "+", "1"}], "]"}], "]"}], "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"omega", "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "gamma"}], "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "0", ",", "nFockFinal"}], "}"}]}], "]"}]}]}]}], 
    ";"}], "\n", 
   RowBox[{"(*", 
    RowBox[{"Apply", "[", 
     RowBox[{"Plus", ",", 
      RowBox[{"pDown", "-", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Pt2", "[", 
           RowBox[{"vpp", ",", "vqq", ",", "#", ",", "200"}], "]"}], "&"}], 
         ",", "tDown"}], "]"}]}]}], "]"}], "*)"}], "\n", 
   RowBox[{"Clear", "[", 
    RowBox[{"fErrorT", ",", "fErrorT2"}], "]"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"fErrorT", "[", 
      RowBox[{"vp_", ",", "vq_"}], "]"}], ":=", "           ", 
     RowBox[{"Apply", "[", 
      RowBox[{"Plus", ",", 
       RowBox[{"wDown", "*", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"pDown", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "300"}], "]"}], "]"}], "-", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Pt2", "[", 
               RowBox[{"vp", ",", "vq", ",", "#", ",", "150", ",", "gama"}], 
               "]"}], "&"}], ",", 
             RowBox[{"tDown", "[", 
              RowBox[{"[", 
               RowBox[{"1", ";;", "300"}], "]"}], "]"}]}], "]"}]}], ")"}], 
         "^", "2"}]}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"fErrorT2", "[", 
      RowBox[{"vp_", ",", "vq_", ",", "g_", ",", "nFockFinal_"}], "]"}], ":=", 
     RowBox[{"Apply", "[", 
      RowBox[{"Plus", ",", 
       RowBox[{"wDown", "*", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"pDown", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "300"}], "]"}], "]"}], "-", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Pt2", "[", 
               RowBox[{
               "vp", ",", "vq", ",", "#", ",", "nFockFinal", ",", "g"}], 
               "]"}], "&"}], ",", 
             RowBox[{"tDown", "[", 
              RowBox[{"[", 
               RowBox[{"1", ";;", "300"}], "]"}], "]"}]}], "]"}]}], ")"}], 
         "^", "2"}]}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"wResiduals2", "[", 
      RowBox[{
      "vp_", ",", "vq_", ",", "pDown_", ",", "tDown_", ",", "wDown_", ",", 
       "g_", ",", "nFockFinal_"}], "]"}], ":=", 
     RowBox[{"Apply", "[", 
      RowBox[{"Plus", ",", 
       RowBox[{"wDown", "*", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"pDown", "-", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Pt2", "[", 
               RowBox[{
               "vp", ",", "vq", ",", "#", ",", "nFockFinal", ",", "g"}], 
               "]"}], "&"}], ",", "tDown"}], "]"}]}], ")"}], "^", "2"}]}]}], 
      "]"}]}], ";"}], "\n", "\n"}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[307]:=",ExpressionUUID->"e745d3f8-a287-426e-ac60-77cf9f9d35d3"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "getH5data", "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getH5data", "[", "filePath_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"path", "=", "filePath"}], ",", "groups", ",", "spath", ",", 
        "data", ",", "id"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"spath", "=", 
        RowBox[{"FileInformation", "[", 
         RowBox[{"path", ",", "\"\<AbsoluteShortFileName\>\""}], "]"}]}], ";",
        "\n", "\n", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", " ", 
          RowBox[{"Import", "[", 
           RowBox[{"spath", ",", "\"\<Data\>\""}], "]"}]}], ",", 
         RowBox[{"id", "=", 
          RowBox[{"data", "[", 
           RowBox[{"[", "31", "]"}], "]"}]}], ",", 
         RowBox[{"groups", "=", " ", 
          RowBox[{"Import", "[", "spath", "]"}]}]}], "}"}]}]}], "\n", "]"}]}],
    ";"}], "\n", "\n"}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[318]:=",ExpressionUUID->"f6f9f314-abfd-4f73-8193-6fce2951af55"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "getH5sq", "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"getH5sq", "[", 
    RowBox[{"g_", ",", "expid_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"t", ",", 
       RowBox[{"rawdata", "=", "expid"}], ",", "data", ",", "r", ",", "\n", 
       "list", ",", "posTrue", ",", "posValue", ",", "posValue2", ",", "pl", 
       ",", "pr", ",", "stringVal"}], "}"}], ",", "\n", 
     RowBox[{"(*", 
      RowBox[{"expid", " ", "comes", " ", "in", " ", "a", " ", "single", " ", 
       RowBox[{"line", ".", " ", "StringSplit"}], " ", "separates", " ", "it",
        " ", "in", " ", "a", " ", "list", " ", "of", " ", "string", " ", 
       RowBox[{"lines", ":"}]}], " ", "*)"}], "\n", 
     RowBox[{
      RowBox[{"data", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"rawdata", ",", "\"\<}\>\""}], "]"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Locates", " ", "the", " ", "line", " ", "number", " ", "that", " ", 
         "contains", " ", "\"\<squeeze_time\>\""}], ":"}], " ", "*)"}], "\n", 
      RowBox[{"list", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"StringContainsQ", "[", 
           RowBox[{"#", ",", "\"\<squeeze_time\>\""}], "]"}], "&"}], ",", 
         "data"}], "]"}]}], ";", "\n", 
      RowBox[{"posTrue", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"list", ",", "True"}], "]"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Find", " ", "the", " ", "position", " ", "in", " ", "the", " ", 
        "string", " ", "of", " ", "the", " ", "time", " ", "of", " ", 
        "squeezing", " ", 
        RowBox[{"applyied", ":"}]}], " ", "*)"}], "\n", 
      RowBox[{"posValue", "=", 
       RowBox[{"StringPosition", "[", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"posTrue", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", "\"\<e-\>\""}],
         "]"}]}], ";", "\n", 
      RowBox[{"posValue2", "=", 
       RowBox[{"StringPosition", "[", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"posTrue", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
         "\"\<value\>\""}], "]"}]}], ";", "\n", 
      RowBox[{"pl", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"posValue2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}], "+", "4"}]}], ";", "\n", 
      RowBox[{"pr", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"posValue", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "+", "3"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Getting", " ", "the", " ", "t", " ", "value", " ", 
         RowBox[{"(", 
          RowBox[{"string", " ", "form"}], ")"}]}], ":"}], " ", "*)"}], "\n", 
      RowBox[{"stringVal", "=", 
       RowBox[{"StringTake", "[", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"posTrue", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"pl", ",", "pr"}], "}"}]}], "]"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{"Translate", " ", "t", 
        RowBox[{"(", "string", ")"}], " ", "to", " ", 
        RowBox[{"number", ":"}]}], " ", "*)"}], "\n", 
      RowBox[{"t", "=", 
       RowBox[{
        RowBox[{"Interpreter", "[", "\"\<Number\>\"", "]"}], "[", "stringVal",
         "]"}]}], ";", "\n", 
      RowBox[{"r", "=", 
       RowBox[{"g", "*", "t"}]}]}]}], "]"}]}], ";"}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[320]:=",ExpressionUUID->"7a17c49d-5367-4a0c-983e-723769ae2177"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "getH5st", "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"getH5st", "[", "expid_", "]"}], ":=", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"t", ",", 
       RowBox[{"rawdata", "=", "expid"}], ",", "data", ",", "r", ",", "\n", 
       "list", ",", "posTrue", ",", "posValue", ",", "posValue2", ",", "pl", 
       ",", "pr", ",", "stringVal"}], "}"}], ",", "\n", 
     RowBox[{"(*", 
      RowBox[{"expid", " ", "comes", " ", "in", " ", "a", " ", "single", " ", 
       RowBox[{"line", ".", " ", "StringSplit"}], " ", "separates", " ", "it",
        " ", "in", " ", "a", " ", "list", " ", "of", " ", "string", " ", 
       RowBox[{"lines", ":"}]}], " ", "*)"}], "\n", 
     RowBox[{
      RowBox[{"data", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"rawdata", ",", "\"\<}\>\""}], "]"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Locates", " ", "the", " ", "line", " ", "number", " ", "that", " ", 
         "contains", " ", "\"\<squeeze_time\>\""}], ":"}], " ", "*)"}], "\n", 
      RowBox[{"list", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"StringContainsQ", "[", 
           RowBox[{"#", ",", "\"\<squeeze_time\>\""}], "]"}], "&"}], ",", 
         "data"}], "]"}]}], ";", "\n", 
      RowBox[{"posTrue", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"list", ",", "True"}], "]"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Find", " ", "the", " ", "position", " ", "in", " ", "the", " ", 
        "string", " ", "of", " ", "the", " ", "time", " ", "of", " ", 
        "squeezing", " ", 
        RowBox[{"applyied", ":"}]}], " ", "*)"}], "\n", 
      RowBox[{"posValue", "=", 
       RowBox[{"StringPosition", "[", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"posTrue", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", "\"\<e-\>\""}],
         "]"}]}], ";", "\n", 
      RowBox[{"posValue2", "=", 
       RowBox[{"StringPosition", "[", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"posTrue", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
         "\"\<value\>\""}], "]"}]}], ";", "\n", 
      RowBox[{"pl", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"posValue2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}], "+", "4"}]}], ";", "\n", 
      RowBox[{"pr", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"posValue", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "+", "3"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Getting", " ", "the", " ", "t", " ", "value", " ", 
         RowBox[{"(", 
          RowBox[{"string", " ", "form"}], ")"}]}], ":"}], " ", "*)"}], "\n", 
      RowBox[{"stringVal", "=", 
       RowBox[{"StringTake", "[", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"posTrue", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"pl", ",", "pr"}], "}"}]}], "]"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{"Translate", " ", "t", 
        RowBox[{"(", "string", ")"}], " ", "to", " ", 
        RowBox[{"number", ":"}]}], " ", "*)"}], "\n", 
      RowBox[{"t", "=", 
       RowBox[{
        RowBox[{"Interpreter", "[", "\"\<Number\>\"", "]"}], "[", "stringVal",
         "]"}]}]}]}], "\n", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[322]:=",ExpressionUUID->"e4b6008f-f0a2-474d-bb8f-d7c41dca26eb"]
}, Closed]],

Cell[CellGroupData[{

Cell["Estimators Functions V3", "Subsection",
 InitializationCell->
  True,ExpressionUUID->"775bf533-c805-4f5d-8b4e-e4022b33d756"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "estimatorThermalt3", "]"}], "\n", 
 RowBox[{
  RowBox[{"estimatorThermalt3", "[", 
   RowBox[{
   "POPLIST_", ",", "ERRLIST_", ",", "TLIST_", ",", "NF_", ",", "METHOD1_", 
    ",", "METHOD2_", ",", "IT_", ",", "NTi_", ",", "NTf_", ",", "OMEGAi_", 
    ",", "OMEGAf_", ",", "GAMMAi_", ",", "GAMMAf_", ",", "WP_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"pop", "=", "POPLIST"}], ",", 
      RowBox[{"err", "=", "ERRLIST"}], ",", 
      RowBox[{"tvec", "=", "TLIST"}], ",", 
      RowBox[{"method1", "=", "METHOD1"}], ",", 
      RowBox[{"method2", "=", "METHOD2"}], ",", "wSquaredError", ",", 
      "result1", ",", "result2", ",", "\n", "ci", ",", "cf", ",", "om", ",", 
      "gm", ",", 
      RowBox[{"omii", "=", "OMEGAi"}], ",", 
      RowBox[{"omf", "=", "OMEGAf"}], ",", 
      RowBox[{"gmii", "=", "GAMMAi"}], ",", 
      RowBox[{"gmf", "=", "GAMMAf"}], ",", 
      RowBox[{"nti", "=", "NTi"}], ",", 
      RowBox[{"ntf", "=", "NTf"}], ",", "ntii", ",", "omegaii", ",", 
      "gammaii", ",", "\n", "ntff", ",", "omegaf", ",", "gammaf", ",", "p0", 
      ",", "omega", ",", "gamma", ",", 
      RowBox[{"mi", "=", "IT"}], ",", 
      RowBox[{"wp", "=", "WP"}], ",", "tpoints", ",", "ALPHA", ",", "R", ",", 
      "NBAR", ",", "PHASE", ",", 
      RowBox[{"nf", "=", "NF"}], ",", "er1", ",", "er2", ",", "nt"}], "}"}], 
    ",", "\n", "\n", 
    RowBox[{
     RowBox[{"tpoints", "=", 
      RowBox[{
       RowBox[{"Dimensions", "[", "tvec", "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Fit", " ", "for", " ", "Thermal", " ", "State", " ", "from", " ", 
        "P_down", 
        RowBox[{"(", "t", ")"}], " ", 
        RowBox[{"data", ".", " ", "nbar"}]}], ",", " ", 
       RowBox[{
       "omega", " ", "and", " ", "gamma", " ", "are", " ", "variables"}]}], 
      " ", "*)"}], "\n", 
     RowBox[{
      RowBox[{"wSquaredError", "[", 
       RowBox[{"nt_", ",", "om_", ",", "gm_"}], "]"}], "=", 
      RowBox[{"SetPrecision", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Divide", "[", 
          RowBox[{"1", ",", 
           RowBox[{"err", "^", "2"}]}], "]"}], ".", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"pop", "-", " ", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"pDownt", "[", 
               RowBox[{"0", ",", "0", ",", "nt", ",", "0", ",", 
                RowBox[{"tvec", "[", 
                 RowBox[{"[", "t", "]"}], "]"}], ",", "nf", ",", "om", ",", 
                "gm"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", "1", ",", "tpoints"}], "}"}]}], "]"}]}], 
           ")"}], "^", "2"}]}], ",", "wp"}], "]"}]}], ";", "\n", 
     RowBox[{"result1", "=", 
      RowBox[{"NMinimize", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"wSquaredError", "[", 
           RowBox[{"nt", ",", "omega", ",", "gamma"}], "]"}], ",", 
          RowBox[{
           RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
           RowBox[{"omega", ">", "0"}], "&&", 
           RowBox[{"gamma", ">", "0"}]}]}], "}"}], ",", "\n", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"omega", ",", "omii", ",", "omf"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"gamma", ",", "gmii", ",", "gmf"}], "}"}]}], "}"}], ",", 
        RowBox[{"Method", "->", "method1"}], ",", 
        RowBox[{"MaxIterations", "->", "mi"}], ",", 
        RowBox[{"WorkingPrecision", "->", "wp"}]}], "]"}]}], ";", "\n", 
     RowBox[{"er1", "=", 
      RowBox[{"Part", "[", 
       RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ntii", ",", "omegaii", ",", "gammaii"}], "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nt", ",", "omega", ",", "gamma"}], "}"}], "/.", 
       RowBox[{"Part", "[", 
        RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
     RowBox[{"result2", "=", 
      RowBox[{"FindMinimum", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"wSquaredError", "[", 
           RowBox[{"nt", ",", "omega", ",", "gamma"}], "]"}], ",", 
          RowBox[{
           RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
           RowBox[{"omega", ">", "0"}], "&&", 
           RowBox[{"gamma", ">", "0"}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"nt", ",", "ntii"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"omega", ",", "omegaii"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"gamma", ",", "gammaii"}], "}"}]}], "}"}], ",", 
        RowBox[{"Method", "->", "method2"}], ",", 
        RowBox[{"MaxIterations", "->", "mi"}], ",", 
        RowBox[{"WorkingPrecision", "->", "wp"}]}], "]"}]}], ";", "\n", 
     RowBox[{"er2", "=", 
      RowBox[{"Part", "[", 
       RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ntff", ",", "omegaf", ",", "gammaf"}], "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nt", ",", "omega", ",", "gamma"}], "}"}], "/.", 
       RowBox[{"Part", "[", 
        RowBox[{"result2", ",", "2"}], "]"}]}]}], ";", "\n", 
     RowBox[{"{", 
      RowBox[{"ntff", ",", "omegaf", ",", "gammaf", ",", "er1", ",", "er2"}], 
      "}"}]}]}], "\n", "]"}]}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[324]:=",ExpressionUUID->"9a630d46-2440-4cca-a77d-ebd8522dabff"]
}, Closed]],

Cell[CellGroupData[{

Cell["Get data from H5", "Subsection",
 InitializationCell->
  True,ExpressionUUID->"f9318b59-16a0-4117-9a97-333ef291027e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"squeezeTime", "[", "DATAFILE_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data", "=", "DATAFILE"}], ",", "list1", ",", "list2", ",", 
       "res", ",", "res2", ",", "dim"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"list1", "=", 
       RowBox[{"StringCases", "[", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "31"}], "]"}], "]"}], ",", 
         RowBox[{
         "\"\<squeeze_time\>\"", "~~", "__", "~~", "\"\<ty\>\"", "~~", "__", 
          "~~", "\"\<NoScan\>\"", "~~", "__", "~~", "\"\<value\>\""}]}], 
        "]"}]}], ";", "\n", 
      RowBox[{"list2", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"list1", ",", "\"\<},\>\""}], "]"}]}], ";", "\n", 
      RowBox[{"res", "=", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"StringCases", "[", 
         RowBox[{
          RowBox[{"StringSplit", "[", 
           RowBox[{"list2", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], ",", 
          "NumberString"}], "]"}], "]"}]}], ";", "\n", 
      RowBox[{"res2", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"res", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "!=", 
            RowBox[{"{", "}"}]}], "&&", 
           RowBox[{"#", "!=", 
            RowBox[{"{", "1", "}"}]}]}], "&"}]}], "]"}]}], ";", "\n", 
      RowBox[{"dim", "=", 
       RowBox[{
        RowBox[{"Dimensions", "[", 
         RowBox[{"res2", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"dim", "==", "1"}], ",", 
        RowBox[{
         RowBox[{"res2", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"res2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "*", 
         RowBox[{"10", "^", 
          RowBox[{
           RowBox[{"res2", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}]}], "]"}]}]}], "\n", "\n", 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementTime", "[", "DATAFILE_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data", "=", "DATAFILE"}], ",", "list1", ",", "list2", ",", 
       "res", ",", "res2", ",", "dim"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"list1", "=", 
       RowBox[{"StringCases", "[", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "31"}], "]"}], "]"}], ",", 
         RowBox[{
         "\"\<displacement_time\>\"", "~~", "__", "~~", "\"\<ty\>\"", "~~", 
          "__", "~~", "\"\<NoScan\>\"", "~~", "__", "~~", "\"\<value\>\""}]}],
         "]"}]}], ";", "\n", 
      RowBox[{"list2", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"list1", ",", "\"\<},\>\""}], "]"}]}], ";", "\n", 
      RowBox[{"res", "=", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"StringCases", "[", 
         RowBox[{
          RowBox[{"StringSplit", "[", 
           RowBox[{"list2", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], ",", 
          "NumberString"}], "]"}], "]"}]}], ";", "\n", 
      RowBox[{"res2", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"res", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "!=", 
            RowBox[{"{", "}"}]}], "&&", 
           RowBox[{"#", "!=", 
            RowBox[{"{", "1", "}"}]}]}], "&"}]}], "]"}]}], ";", "\n", 
      RowBox[{"dim", "=", 
       RowBox[{
        RowBox[{"Dimensions", "[", 
         RowBox[{"res2", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"dim", "==", "1"}], ",", 
        RowBox[{
         RowBox[{"res2", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"res2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "*", 
         RowBox[{"10", "^", 
          RowBox[{
           RowBox[{"res2", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}]}], "]"}]}]}], "\n", "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"displacementPhase", "[", "DATAFILE_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data", "=", "DATAFILE"}], ",", "list1", ",", "list2", ",", 
       "res", ",", "res2", ",", "dim"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"list1", "=", 
       RowBox[{"StringCases", "[", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "31"}], "]"}], "]"}], ",", 
         RowBox[{
         "\"\<displacement_phase\>\"", "~~", "__", "~~", "\"\<value\>\"", "~~",
           "__", "~~", "\"\<},\>\""}]}], "]"}]}], ";", "\n", 
      RowBox[{"list2", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"list1", ",", "\"\<},\>\""}], "]"}]}], ";", "\n", 
      RowBox[{"res", "=", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"StringCases", "[", 
         RowBox[{
          RowBox[{"StringSplit", "[", 
           RowBox[{"list2", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], ",", 
          "NumberString"}], "]"}], "]"}]}], ";", "\n", 
      RowBox[{"res2", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"res", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "!=", 
            RowBox[{"{", "}"}]}], "&&", 
           RowBox[{"#", "!=", 
            RowBox[{"{", "1", "}"}]}]}], "&"}]}], "]"}]}], ";", "\n", 
      RowBox[{"dim", "=", 
       RowBox[{
        RowBox[{"Dimensions", "[", 
         RowBox[{"res2", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"dim", "==", "1"}], ",", 
        RowBox[{
         RowBox[{"res2", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"res2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "*", 
         RowBox[{"10", "^", 
          RowBox[{
           RowBox[{"res2", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}]}], "]"}]}]}], "\n", "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"squeezePhase", "[", "DATAFILE_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data", "=", "DATAFILE"}], ",", "list1", ",", "list2", ",", 
       "res", ",", "res2", ",", "dim"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"list1", "=", 
       RowBox[{"StringCases", "[", 
        RowBox[{
         RowBox[{"data", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "31"}], "]"}], "]"}], ",", 
         RowBox[{
         "\"\<squeeze_phase\>\"", "~~", "__", "~~", "\"\<value\>\"", "~~", 
          "__", "~~", "\"\<},\>\""}]}], "]"}]}], ";", "\n", 
      RowBox[{"list2", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"list1", ",", "\"\<},\>\""}], "]"}]}], ";", "\n", 
      RowBox[{"res", "=", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"StringCases", "[", 
         RowBox[{
          RowBox[{"StringSplit", "[", 
           RowBox[{"list2", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], ",", 
          "NumberString"}], "]"}], "]"}]}], ";", "\n", 
      RowBox[{"res2", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"res", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "!=", 
            RowBox[{"{", "}"}]}], "&&", 
           RowBox[{"#", "!=", 
            RowBox[{"{", "1", "}"}]}]}], "&"}]}], "]"}]}], ";", "\n", 
      RowBox[{"dim", "=", 
       RowBox[{
        RowBox[{"Dimensions", "[", 
         RowBox[{"res2", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"dim", "==", "1"}], ",", 
        RowBox[{
         RowBox[{"res2", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"res2", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "*", 
         RowBox[{"10", "^", 
          RowBox[{
           RowBox[{"res2", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}]}], "]"}]}]}], "\n", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[326]:=",ExpressionUUID->"39e95099-0859-4d11-b47a-8cff09f8a897"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "getH5data", "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"getH5data", "[", "filePath_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"path", "=", "filePath"}], ",", "groups", ",", "spath", ",", 
       "data", ",", "id"}], "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"spath", "=", 
       RowBox[{"FileInformation", "[", 
        RowBox[{"path", ",", "\"\<AbsoluteShortFileName\>\""}], "]"}]}], ";", 
      "\n", "\n", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"data", "=", " ", 
         RowBox[{"Import", "[", 
          RowBox[{"spath", ",", "\"\<Data\>\""}], "]"}]}], ",", 
        RowBox[{"id", "=", 
         RowBox[{"data", "[", 
          RowBox[{"[", "31", "]"}], "]"}]}], ",", 
        RowBox[{"groups", "=", " ", 
         RowBox[{"Import", "[", "spath", "]"}]}]}], "}"}]}]}], "\n", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[330]:=",ExpressionUUID->"ca440ccc-8ac0-4128-ba93-513d5694d7bc"]
}, Closed]],

Cell[CellGroupData[{

Cell["estimatorThermalt4 - t0", "Subsection",ExpressionUUID->"dd96c0fe-cdfb-41b7-a157-37def4bc5719"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "estimatorThermalt4", "]"}], "\n", 
 RowBox[{
  RowBox[{"estimatorThermalt4", "[", 
   RowBox[{
   "POPLIST_", ",", "ERRLIST_", ",", "TLIST_", ",", "NF_", ",", "METHOD1_", 
    ",", "METHOD2_", ",", "IT_", ",", "NTi_", ",", "NTf_", ",", "OMEGAi_", 
    ",", "OMEGAf_", ",", "GAMMAi_", ",", "GAMMAf_", ",", "t0i_", ",", "t0f_", 
    ",", "WP_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"pop", "=", "POPLIST"}], ",", 
      RowBox[{"err", "=", "ERRLIST"}], ",", 
      RowBox[{"tvec", "=", "TLIST"}], ",", 
      RowBox[{"method1", "=", "METHOD1"}], ",", 
      RowBox[{"method2", "=", "METHOD2"}], ",", "wSquaredError", ",", 
      "result1", ",", "result2", ",", "\n", "ci", ",", "cf", ",", "om", ",", 
      "gm", ",", 
      RowBox[{"omii", "=", "OMEGAi"}], ",", 
      RowBox[{"omf", "=", "OMEGAf"}], ",", 
      RowBox[{"gmii", "=", "GAMMAi"}], ",", 
      RowBox[{"gmf", "=", "GAMMAf"}], ",", 
      RowBox[{"nti", "=", "NTi"}], ",", 
      RowBox[{"ntf", "=", "NTf"}], ",", "ntii", ",", "omegaii", ",", 
      "gammaii", ",", "\n", "ntff", ",", "omegaf", ",", "gammaf", ",", "p0", 
      ",", "omega", ",", "gamma", ",", 
      RowBox[{"mi", "=", "IT"}], ",", 
      RowBox[{"wp", "=", "WP"}], ",", "tpoints", ",", "ALPHA", ",", "R", ",", 
      "NBAR", ",", "PHASE", ",", 
      RowBox[{"nf", "=", "NF"}], ",", "er1", ",", "er2", ",", "nt", ",", "t0",
       ",", "t0ii", ",", "t0ff"}], "}"}], ",", "\n", "\n", 
    RowBox[{
     RowBox[{"tpoints", "=", 
      RowBox[{
       RowBox[{"Dimensions", "[", "tvec", "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Fit", " ", "for", " ", "Thermal", " ", "State", " ", "from", " ", 
        "P_down", 
        RowBox[{"(", "t", ")"}], " ", 
        RowBox[{"data", ".", " ", "nbar"}]}], ",", " ", 
       RowBox[{
       "omega", " ", "and", " ", "gamma", " ", "are", " ", "variables"}]}], 
      " ", "*)"}], "\n", 
     RowBox[{
      RowBox[{"wSquaredError", "[", 
       RowBox[{"nt_", ",", "t0_", ",", "om_", ",", "gm_"}], "]"}], "=", 
      RowBox[{"SetPrecision", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Divide", "[", 
          RowBox[{"1", ",", 
           RowBox[{"err", "^", "2"}]}], "]"}], ".", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"pop", "-", " ", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"pDowntMod", "[", 
               RowBox[{"0", ",", "0", ",", "nt", ",", "0", ",", "t0", ",", 
                RowBox[{"tvec", "[", 
                 RowBox[{"[", "t", "]"}], "]"}], ",", "nf", ",", "om", ",", 
                "gm"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", "1", ",", "tpoints"}], "}"}]}], "]"}]}], 
           ")"}], "^", "2"}]}], ",", "wp"}], "]"}]}], ";", "\n", 
     RowBox[{"result1", "=", 
      RowBox[{"NMinimize", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"wSquaredError", "[", 
           RowBox[{"nt", ",", "t0", ",", "omega", ",", "gamma"}], "]"}], ",", 
          RowBox[{
           RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
           RowBox[{"omega", ">", "0"}], "&&", 
           RowBox[{"gamma", ">", "0"}], "&&", 
           RowBox[{"t0", ">", "0"}]}]}], "}"}], ",", "\n", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"t0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"omega", ",", "omii", ",", "omf"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"gamma", ",", "gmii", ",", "gmf"}], "}"}]}], "}"}], ",", 
        RowBox[{"Method", "->", "method1"}], ",", 
        RowBox[{"MaxIterations", "->", "mi"}], ",", 
        RowBox[{"WorkingPrecision", "->", "wp"}]}], "]"}]}], ";", "\n", 
     RowBox[{"er1", "=", 
      RowBox[{"Part", "[", 
       RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ntii", ",", "t0ii", ",", "omegaii", ",", "gammaii"}], "}"}], 
      "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nt", ",", "t0", ",", "omega", ",", "gamma"}], "}"}], "/.", 
       RowBox[{"Part", "[", 
        RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
     RowBox[{"result2", "=", 
      RowBox[{"FindMinimum", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"wSquaredError", "[", 
           RowBox[{"nt", ",", "t0", ",", "omega", ",", "gamma"}], "]"}], ",", 
          RowBox[{
           RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
           RowBox[{"omega", ">", "0"}], "&&", 
           RowBox[{"gamma", ">", "0"}], "&&", 
           RowBox[{"t0", ">", "0"}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"nt", ",", "ntii"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"t0", ",", "t0ii"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"omega", ",", "omegaii"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"gamma", ",", "gammaii"}], "}"}]}], "}"}], ",", 
        RowBox[{"Method", "->", "method2"}], ",", 
        RowBox[{"MaxIterations", "->", "mi"}], ",", 
        RowBox[{"WorkingPrecision", "->", "wp"}]}], "]"}]}], ";", "\n", 
     RowBox[{"er2", "=", 
      RowBox[{"Part", "[", 
       RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ntff", ",", "t0ff", ",", "omegaf", ",", "gammaf"}], "}"}], 
      "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nt", ",", "t0", ",", "omega", ",", "gamma"}], "}"}], "/.", 
       RowBox[{"Part", "[", 
        RowBox[{"result2", ",", "2"}], "]"}]}]}], ";", "\n", 
     RowBox[{"{", 
      RowBox[{
      "ntff", ",", "t0ff", ",", "omegaf", ",", "gammaf", ",", "er1", ",", 
       "er2"}], "}"}]}]}], "\n", "]"}]}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[346]:=",ExpressionUUID->"3986d077-1945-4789-9d47-1cbaa5bd08cf"]
}, Closed]],

Cell[CellGroupData[{

Cell["estimatorThermalt5 - A0", "Subsection",ExpressionUUID->"1e778ead-4b5a-4367-bd38-8a637f734344"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "estimatorThermalt5", "]"}], "\n", 
 RowBox[{
  RowBox[{"estimatorThermalt5", "[", 
   RowBox[{
   "POPLIST_", ",", "ERRLIST_", ",", "TLIST_", ",", "NF_", ",", "METHOD1_", 
    ",", "METHOD2_", ",", "IT_", ",", "NTi_", ",", "NTf_", ",", "OMEGAi_", 
    ",", "OMEGAf_", ",", "GAMMAi_", ",", "GAMMAf_", ",", "t0i_", ",", "t0f_", 
    ",", "WP_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"pop", "=", "POPLIST"}], ",", 
      RowBox[{"err", "=", "ERRLIST"}], ",", 
      RowBox[{"tvec", "=", "TLIST"}], ",", 
      RowBox[{"method1", "=", "METHOD1"}], ",", 
      RowBox[{"method2", "=", "METHOD2"}], ",", "wSquaredError", ",", 
      "result1", ",", "result2", ",", "\n", "ci", ",", "cf", ",", "om", ",", 
      "gm", ",", 
      RowBox[{"omii", "=", "OMEGAi"}], ",", 
      RowBox[{"omf", "=", "OMEGAf"}], ",", 
      RowBox[{"gmii", "=", "GAMMAi"}], ",", 
      RowBox[{"gmf", "=", "GAMMAf"}], ",", 
      RowBox[{"nti", "=", "NTi"}], ",", 
      RowBox[{"ntf", "=", "NTf"}], ",", "ntii", ",", "omegaii", ",", 
      "gammaii", ",", "\n", "ntff", ",", "omegaf", ",", "gammaf", ",", "p0", 
      ",", "omega", ",", "gamma", ",", 
      RowBox[{"mi", "=", "IT"}], ",", 
      RowBox[{"wp", "=", "WP"}], ",", "tpoints", ",", "ALPHA", ",", "R", ",", 
      "NBAR", ",", "PHASE", ",", 
      RowBox[{"nf", "=", "NF"}], ",", "er1", ",", "er2", ",", "nt", ",", "a0",
       ",", "a0ii", ",", "a0ff"}], "}"}], ",", "\n", "\n", 
    RowBox[{
     RowBox[{"tpoints", "=", 
      RowBox[{
       RowBox[{"Dimensions", "[", "tvec", "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Fit", " ", "for", " ", "Thermal", " ", "State", " ", "from", " ", 
        "P_down", 
        RowBox[{"(", "t", ")"}], " ", 
        RowBox[{"data", ".", " ", "nbar"}]}], ",", " ", 
       RowBox[{
       "omega", " ", "and", " ", "gamma", " ", "are", " ", "variables"}]}], 
      " ", "*)"}], "\n", 
     RowBox[{
      RowBox[{"wSquaredError", "[", 
       RowBox[{"nt_", ",", "a0_", ",", "om_", ",", "gm_"}], "]"}], "=", 
      RowBox[{"SetPrecision", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Divide", "[", 
          RowBox[{"1", ",", 
           RowBox[{"err", "^", "2"}]}], "]"}], ".", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"pop", "-", " ", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"pDowntMod2", "[", 
               RowBox[{"0", ",", "0", ",", "nt", ",", "0", ",", "a0", ",", 
                RowBox[{"tvec", "[", 
                 RowBox[{"[", "t", "]"}], "]"}], ",", "nf", ",", "om", ",", 
                "gm"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", "1", ",", "tpoints"}], "}"}]}], "]"}]}], 
           ")"}], "^", "2"}]}], ",", "wp"}], "]"}]}], ";", "\n", 
     RowBox[{"result1", "=", 
      RowBox[{"NMinimize", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"wSquaredError", "[", 
           RowBox[{"nt", ",", "a0", ",", "omega", ",", "gamma"}], "]"}], ",", 
          RowBox[{
           RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
           RowBox[{"omega", ">", "0"}], "&&", 
           RowBox[{"gamma", ">", "0"}], "&&", 
           RowBox[{"a0", ">", "0"}]}]}], "}"}], ",", "\n", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"a0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"omega", ",", "omii", ",", "omf"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"gamma", ",", "gmii", ",", "gmf"}], "}"}]}], "}"}], ",", 
        RowBox[{"Method", "->", "method1"}], ",", 
        RowBox[{"MaxIterations", "->", "mi"}], ",", 
        RowBox[{"WorkingPrecision", "->", "wp"}]}], "]"}]}], ";", "\n", 
     RowBox[{"er1", "=", 
      RowBox[{"Part", "[", 
       RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ntii", ",", "a0ii", ",", "omegaii", ",", "gammaii"}], "}"}], 
      "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nt", ",", "a0", ",", "omega", ",", "gamma"}], "}"}], "/.", 
       RowBox[{"Part", "[", 
        RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
     RowBox[{"result2", "=", 
      RowBox[{"FindMinimum", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"wSquaredError", "[", 
           RowBox[{"nt", ",", "a0", ",", "omega", ",", "gamma"}], "]"}], ",", 
          RowBox[{
           RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
           RowBox[{"omega", ">", "0"}], "&&", 
           RowBox[{"gamma", ">", "0"}], "&&", 
           RowBox[{"a0", ">", "0"}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"nt", ",", "ntii"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"a0", ",", "a0ii"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"omega", ",", "omegaii"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"gamma", ",", "gammaii"}], "}"}]}], "}"}], ",", 
        RowBox[{"Method", "->", "method2"}], ",", 
        RowBox[{"MaxIterations", "->", "mi"}], ",", 
        RowBox[{"WorkingPrecision", "->", "wp"}]}], "]"}]}], ";", "\n", 
     RowBox[{"er2", "=", 
      RowBox[{"Part", "[", 
       RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"ntff", ",", "a0ff", ",", "omegaf", ",", "gammaf"}], "}"}], 
      "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nt", ",", "a0", ",", "omega", ",", "gamma"}], "}"}], "/.", 
       RowBox[{"Part", "[", 
        RowBox[{"result2", ",", "2"}], "]"}]}]}], ";", "\n", 
     RowBox[{"{", 
      RowBox[{
      "ntff", ",", "a0ff", ",", "omegaf", ",", "gammaf", ",", "er1", ",", 
       "er2"}], "}"}]}]}], "\n", "]"}]}], "\n"}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[348]:=",ExpressionUUID->"5ab4ef26-8af5-488f-a326-26f72b30b124"]
}, Closed]],

Cell[CellGroupData[{

Cell["P_down(t) mod", "Subsection",ExpressionUUID->"f568b1bd-549c-46c1-a840-0aa4b9938fa1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Functions", "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "ALPHA", ",", "R", ",", "NBAR", ",", "PHASE", ",", "OMEGA", ",", 
     "pDowntMod"}], "]"}], "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"P", 
      RowBox[{"(", "t", ")"}], " ", "as", " ", "a", " ", "function", " ", 
      "of", " ", "gamma"}], ",", " ", "n", ",", " ", 
     RowBox[{"VP", " ", "and", " ", "VQ"}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"pDowntMod", "[", 
      RowBox[{
      "ALPHA_", ",", "R_", ",", "NBAR_", ",", "PHASE_", ",", "T0_", ",", "t_",
        ",", "NF_", ",", "OMEGA_", ",", "GAMMA_"}], "]"}], ":=", 
     RowBox[{"0.5", "+", 
      RowBox[{"0.5", "*", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"pnV3", "[", 
           RowBox[{"n", ",", "ALPHA", ",", "R", ",", "NBAR", ",", "PHASE"}], 
           "]"}], "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"OMEGA", "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "GAMMA"}], "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", 
            RowBox[{"(", 
             RowBox[{"t", "+", "T0"}], ")"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "0", ",", "NF"}], "}"}]}], "]"}]}]}]}], ";"}], 
   "\n"}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[350]:=",ExpressionUUID->"8c653b2c-11b4-473b-b04c-474046f79b7e"]
}, Closed]],

Cell[CellGroupData[{

Cell["P_down(t) mod2", "Subsection",ExpressionUUID->"45186509-9f7d-4cda-9743-0f5125b2171e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Functions", "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "ALPHA", ",", "R", ",", "NBAR", ",", "PHASE", ",", "OMEGA", ",", 
     "pDowntMod2", ",", "A"}], "]"}], "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"P", 
      RowBox[{"(", "t", ")"}], " ", "as", " ", "a", " ", "function", " ", 
      "of", " ", "gamma"}], ",", " ", "n", ",", " ", 
     RowBox[{"VP", " ", "and", " ", "VQ"}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"pDowntMod2", "[", 
      RowBox[{
      "ALPHA_", ",", "R_", ",", "NBAR_", ",", "PHASE_", ",", "A_", ",", "t_", 
       ",", "NF_", ",", "OMEGA_", ",", "GAMMA_"}], "]"}], ":=", 
     RowBox[{"0.5", "+", 
      RowBox[{"A", "*", "0.5", "*", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"pnV3", "[", 
           RowBox[{"n", ",", "ALPHA", ",", "R", ",", "NBAR", ",", "PHASE"}], 
           "]"}], "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"OMEGA", "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "GAMMA"}], "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "0", ",", "NF"}], "}"}]}], "]"}]}]}]}], ";"}], 
   "\n"}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[352]:=",ExpressionUUID->"0c12db39-430f-448d-bb50-e25e6420a016"]
}, Closed]],

Cell[CellGroupData[{

Cell["P_down(t) mod3", "Subsection",ExpressionUUID->"949c8966-4aea-4646-a548-9fd5963be365"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Functions", "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{
    "ALPHA", ",", "R", ",", "NBAR", ",", "PHASE", ",", "OMEGA", ",", 
     "pDowntMod3", ",", "A"}], "]"}], "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"P", 
      RowBox[{"(", "t", ")"}], " ", "as", " ", "a", " ", "function", " ", 
      "of", " ", "gamma"}], ",", " ", "n", ",", " ", 
     RowBox[{"VP", " ", "and", " ", "VQ"}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"pDowntMod3", "[", 
      RowBox[{
      "ALPHA_", ",", "R_", ",", "NBAR_", ",", "PHASE_", ",", "A_", ",", "B_", 
       ",", "t_", ",", "NF_", ",", "OMEGA_", ",", "GAMMA_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"B", "/", "2"}], "+", 
      RowBox[{"A", "*", 
       RowBox[{
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pnV3", "[", 
            RowBox[{"n", ",", "ALPHA", ",", "R", ",", "NBAR", ",", "PHASE"}], 
            "]"}], "*", 
           RowBox[{"Cos", "[", 
            RowBox[{"OMEGA", "*", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}], "*", 
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", "GAMMA"}], "*", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "0", ",", "NF"}], "}"}]}], "]"}], "/", 
        "2"}]}]}]}], ";"}], "\n", "\n", "\n", "\n", "\n", "\n", "\n", "\n", 
   "\n"}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[354]:=",ExpressionUUID->"f8a10a78-1b57-4f74-82dc-5cd05636ba7d"]
}, Closed]],

Cell[CellGroupData[{

Cell["estimatorThermalMLEv4", "Subsection",ExpressionUUID->"40908c44-d092-457a-8e1b-09d6b08d159c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Step", " ", "1", " ", "with", " ", "MLE", " ", "to", " ", "get", " ", "a",
     " ", "good", " ", "staerting", " ", 
    RowBox[{"point", ".", " ", "For"}], " ", "Single", " ", "fit", " ", 
    "only"}], "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Differently", " ", "from", " ", "version", " ", "1"}], ",", " ", 
    RowBox[{
    "here", " ", "we", " ", "consider", " ", "both", " ", "constrained", " ", 
     "and", " ", "unconstrained", " ", "local", " ", "optimization"}]}], 
   "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"Also", ",", " ", 
    RowBox[{"different", " ", "from", " ", "version", " ", "2"}], ",", " ", 
    RowBox[{"here", " ", "we", " ", "use", " ", 
     RowBox[{"Abs", "[", "]"}], " ", "for", " ", "nbar", " ", "such", " ", 
     "way", " ", "that", " ", "there", " ", "will", " ", "be", " ", 
     "nnegative", " ", "value", " ", "for", " ", "temperature"}]}], "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{"Clear", "[", "estimatorThermalMLEv4", "]"}], "\n", 
   RowBox[{
    RowBox[{"estimatorThermalMLEv4", "[", 
     RowBox[{
     "POPLIST_", ",", "TLIST_", ",", "NF_", ",", "METHOD1_", ",", "METHOD2_", 
      ",", "IT_", ",", "NTi_", ",", "NTf_", ",", "OMi_", ",", "OMf_", ",", 
      "GMi_", ",", "GMf_", ",", "WP_", ",", "AG_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"pop", "=", "POPLIST"}], ",", 
        RowBox[{"tvec", "=", "TLIST"}], ",", 
        RowBox[{"method1", "=", "METHOD1"}], ",", 
        RowBox[{"method2", "=", "METHOD2"}], ",", "wSquaredError", ",", 
        "result1", ",", "result2", ",", "\n", "ai", ",", "bi", ",", "ci", ",",
         "af", ",", "bf", ",", "cf", ",", "af2", ",", "bf2", ",", "cf2", ",", 
        "af3", ",", "bf3", ",", "cf3", ",", "\n", "om", ",", "gm", ",", "\n", 
        RowBox[{"omi", "=", "OMi"}], ",", 
        RowBox[{"omf", "=", "OMf"}], ",", 
        RowBox[{"gmi", "=", "GMi"}], ",", 
        RowBox[{"gmf", "=", "GMf"}], ",", "\n", 
        RowBox[{"nti", "=", "NTi"}], ",", 
        RowBox[{"ntf", "=", "NTf"}], ",", "\n", "p0", ",", "omega", ",", 
        "gamma", ",", 
        RowBox[{"mi", "=", "IT"}], ",", 
        RowBox[{"wp", "=", "WP"}], ",", "tpoints", ",", "\n", "NBAR", ",", 
        "\n", 
        RowBox[{"nf", "=", "NF"}], ",", "\n", "er1", ",", "er2", ",", "er3", 
        ",", "\n", "nt", ",", "\n", 
        RowBox[{"ag", "=", "AG"}], ",", "\n", "pvect", ",", "pvecRt", ",", 
        "mle", ",", "result3", ",", "methodmark", ",", "result4"}], "}"}], 
      ",", "\n", 
      RowBox[{
       RowBox[{"tpoints", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "tvec", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
       RowBox[{"(*", "*)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{"P_down", 
         RowBox[{"(", "t", ")"}], " ", "Vector", " ", "Function"}], "*)"}], 
       "\n", 
       RowBox[{
        RowBox[{"pvect", "[", 
         RowBox[{"NT_", ",", "OM_", ",", "GM_"}], "]"}], ":=", 
        RowBox[{"pDownt", "[", 
         RowBox[{
         "0", ",", "0", ",", "NT", ",", "0", ",", "tvec", ",", "nf", ",", 
          "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"pvecRt", "[", 
         RowBox[{
          RowBox[{"NT_", "?", "NumericQ"}], ",", 
          RowBox[{"OM_", "?", "NumericQ"}], ",", 
          RowBox[{"GM_", "?", "NumericQ"}]}], "]"}], ":=", 
        RowBox[{"pvect", "[", 
         RowBox[{"NT", ",", "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{"(*", "**********************)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Maxiimum", " ", "Log"}], "-", 
         RowBox[{"Likelihood", " ", "function"}]}], "*)"}], "\n", 
       RowBox[{
        RowBox[{"mle", "[", 
         RowBox[{
          RowBox[{"PVEC_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"VectorQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", 
          RowBox[{"POP_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"VectorQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "]"}], 
        ":=", 
        RowBox[{
         RowBox[{"POP", ".", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "PVEC"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "POP"}], ")"}], ".", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", 
            RowBox[{"1", "-", "PVEC"}]}], "]"}]}]}]}], ";", "\n", 
       RowBox[{"(*", "*)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{"result1", "=", 
         RowBox[{"NMaximize", "[", 
          RowBox[{"mle", "[", 
           RowBox[{
            RowBox[{"pvecRt", "[", 
             RowBox[{
              RowBox[{"Abs", "[", "nt", "]"}], ",", "om", ",", "gm"}], "]"}], 
            ",", "pop"}], "]"}]}]}], "*)"}], "\n", 
       RowBox[{"result1", "=", 
        RowBox[{"NMaximize", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"mle", "[", 
             RowBox[{
              RowBox[{"pvecRt", "[", 
               RowBox[{"nt", ",", "om", ",", "gm"}], "]"}], ",", "pop"}], 
             "]"}], ",", 
            RowBox[{
             RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
             RowBox[{"om", ">", "0"}], "&&", 
             RowBox[{"gm", ">", "0"}]}]}], "}"}], ",", "\n", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"om", ",", "omi", ",", "omf"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"gm", ",", "gmi", ",", "gmf"}], "}"}]}], "}"}], ",", 
          RowBox[{"Method", "->", "method1"}], ",", 
          RowBox[{"MaxIterations", "->", "mi"}], ",", 
          RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
          RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
       RowBox[{"er1", "=", 
        RowBox[{"Part", "[", 
         RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"ai", ",", "bi", ",", "ci"}], "}"}], "=", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"nt", ",", "om", ",", "gm"}], "}"}], "/.", 
         RowBox[{"Part", "[", 
          RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", "\n", 
       RowBox[{"(*", 
        RowBox[{"Using", " ", "this", " ", "step", " ", "because", " ", 
         RowBox[{"that", "'"}], "s", " ", "the", " ", "config", " ", "that", 
         " ", "worked", " ", "with", " ", "the", " ", 
         RowBox[{"data", ".", " ", "The"}], " ", "other", " ", "options", " ",
          "below", " ", "worked", " ", "better", " ", "with", " ", "bs", " ", 
         "datasets"}], "*)"}], "\n", 
       RowBox[{"result2", "=", 
        RowBox[{"FindMaximum", "[", 
         RowBox[{
          RowBox[{"mle", "[", 
           RowBox[{
            RowBox[{"pvecRt", "[", 
             RowBox[{
              RowBox[{"Abs", "[", "nt", "]"}], ",", 
              RowBox[{"Abs", "[", "om", "]"}], ",", 
              RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"nt", ",", 
              RowBox[{"Abs", "[", "ai", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"om", ",", 
              RowBox[{"Abs", "[", "bi", "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"gm", ",", 
              RowBox[{"Abs", "[", "ci", "]"}]}], "}"}]}], "}"}], ",", 
          RowBox[{"Method", "->", "method2"}], ",", 
          RowBox[{"MaxIterations", "->", "mi"}], ",", 
          RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
          RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
       RowBox[{"er2", "=", 
        RowBox[{"Part", "[", 
         RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"af", ",", "bf", ",", "cf"}], "}"}], "=", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"nt", ",", "om", ",", "gm"}], "}"}], "/.", 
         RowBox[{"Part", "[", 
          RowBox[{"result2", ",", "2"}], "]"}]}]}], ";", "\n", 
       RowBox[{"methodmark", "=", "0"}], ";", "\n", 
       RowBox[{"(*", 
        RowBox[{"So", ",", " ", 
         RowBox[{"in", " ", "the", " ", "case", " ", "that", " ", "it", " ", 
          RowBox[{"doesn", "'"}], "t", " ", "work", " ", 
          RowBox[{"(", 
           RowBox[{"it", " ", "happens"}], ")"}], " ", "then", " ", "do"}]}], 
        " ", "*)"}], "\n", "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"VectorQ", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"af", ",", "bf", ",", "cf"}], "}"}], ",", "NumericQ"}], 
           "]"}], "==", "False"}], ",", "\n", 
         RowBox[{
          RowBox[{"result2", "=", 
           RowBox[{"FindMaximum", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"mle", "[", 
                RowBox[{
                 RowBox[{"pvecRt", "[", 
                  RowBox[{"nt", ",", "om", ",", "gm"}], "]"}], ",", "pop"}], 
                "]"}], ",", 
               RowBox[{
                RowBox[{"nt", ">", "0"}], "&&", 
                RowBox[{"om", ">", "0"}], "&&", 
                RowBox[{"gm", ">", "0"}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"nt", ",", 
                 RowBox[{
                  RowBox[{"Abs", "[", "ai", "]"}], "/", "2"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"om", ",", 
                 RowBox[{"Abs", "[", "bi", "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"gm", ",", 
                 RowBox[{"Abs", "[", "ci", "]"}]}], "}"}]}], "}"}], ",", 
             RowBox[{"Method", "->", "\"\<InteriorPoint\>\""}], ",", 
             RowBox[{"MaxIterations", "->", "mi"}], ",", 
             RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
             RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
          RowBox[{"result3", "=", 
           RowBox[{"FindMaximum", "[", 
            RowBox[{
             RowBox[{"mle", "[", 
              RowBox[{
               RowBox[{"pvecRt", "[", 
                RowBox[{
                 RowBox[{"Abs", "[", "nt", "]"}], ",", 
                 RowBox[{"Abs", "[", "om", "]"}], ",", 
                 RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], 
              "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"nt", ",", 
                 RowBox[{"0.5", "*", 
                  RowBox[{"Abs", "[", "ai", "]"}]}], ",", 
                 RowBox[{"2", "*", 
                  RowBox[{"Abs", "[", "ai", "]"}]}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"om", ",", 
                 RowBox[{"Abs", "[", "bi", "]"}], ",", "omf"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"gm", ",", 
                 RowBox[{"Abs", "[", "ci", "]"}], ",", "gmf"}], "}"}]}], 
              "}"}], ",", 
             RowBox[{"Method", "->", "\"\<PrincipalAxis\>\""}], ",", 
             RowBox[{"MaxIterations", "->", "mi"}], ",", 
             RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
             RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", "\n", 
          RowBox[{"er2", "=", 
           RowBox[{"Part", "[", 
            RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"af2", ",", "bf2", ",", "cf2"}], "}"}], "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"nt", ",", "om", ",", "gm"}], "}"}], "/.", 
            RowBox[{"Part", "[", 
             RowBox[{"result2", ",", "2"}], "]"}]}]}], ";", "\n", 
          RowBox[{"er3", "=", 
           RowBox[{"Part", "[", 
            RowBox[{"result3", ",", "1"}], "]"}]}], ";", "\n", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"af3", ",", "bf3", ",", "cf3"}], "}"}], "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"nt", ",", "om", ",", "gm"}], "}"}], "/.", 
            RowBox[{"Part", "[", 
             RowBox[{"result3", ",", "2"}], "]"}]}]}], ";", "\n", 
          RowBox[{"(*", 
           RowBox[{
           "IF", " ", "both", " ", "are", " ", "numeric", " ", "get", " ", 
            "the", " ", "best"}], "*)"}], "\n", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"If", " ", "not"}], ",", " ", 
            RowBox[{
            "get", " ", "the", " ", "one", " ", "that", " ", "gave", " ", 
             "numeric", " ", "result"}]}], "*)"}], "\n", 
          RowBox[{"If", "[", "\n", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"VectorQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"af2", ",", "bf2", ",", "cf2"}], "}"}], ",", 
                "NumericQ"}], "]"}], "==", "True"}], "&&", 
             RowBox[{
              RowBox[{"VectorQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"af3", ",", "bf3", ",", "cf3"}], "}"}], ",", 
                "NumericQ"}], "]"}], "==", "True"}]}], ",", "\n", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"er3", ">", "er2"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"af", ",", "bf", ",", "cf"}], "}"}], "=", 
                RowBox[{"{", 
                 RowBox[{"af3", ",", "bf3", ",", "cf3"}], "}"}]}], ";", 
               RowBox[{"er2", "=", "er3"}], ";", 
               RowBox[{"methodmark", "=", "2"}]}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"af", ",", "bf", ",", "cf"}], "}"}], "=", 
                RowBox[{"{", 
                 RowBox[{"af2", ",", "bf2", ",", "cf2"}], "}"}]}], ";", 
               RowBox[{"methodmark", "=", "1"}]}]}], "]"}], ",", "\n", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"VectorQ", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"af2", ",", "bf2", ",", "cf2"}], "}"}], ",", 
                  "NumericQ"}], "]"}], "==", "False"}], "&&", 
               RowBox[{
                RowBox[{"VectorQ", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"af3", ",", "bf3", ",", "cf3"}], "}"}], ",", 
                  "NumericQ"}], "]"}], "==", "False"}]}], ",", "\n", 
              RowBox[{"methodmark", "=", "3"}], ",", "\n", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"VectorQ", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"af2", ",", "bf2", ",", "cf2"}], "}"}], ",", 
                   "NumericQ"}], "]"}], "==", "False"}], ",", "\n", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"af", ",", "bf", ",", "cf"}], "}"}], "=", 
                  RowBox[{"{", 
                   RowBox[{"af3", ",", "bf3", ",", "cf3"}], "}"}]}], ";", 
                 RowBox[{"er2", "=", "er3"}], ";", 
                 RowBox[{"methodmark", "=", "2"}]}], ",", "\n", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"af", ",", "bf", ",", "cf"}], "}"}], "=", 
                  RowBox[{"{", 
                   RowBox[{"af2", ",", "bf2", ",", "cf2"}], "}"}]}], ";", 
                 RowBox[{"methodmark", "=", "1"}]}]}], "\n", "]"}]}], "\n", 
             "]"}]}], "\n", "]"}]}]}], "\n", "]"}], ";", "\n", "\n", "\n", 
       RowBox[{"(*", 
        RowBox[{"Well", ",", " ", 
         RowBox[{"since", " ", "it", " ", 
          RowBox[{"didn", "'"}], "t", " ", "work", " ", 
          RowBox[{"let", "'"}], "s", " ", "go", " ", "back", " ", "to", " ", 
          RowBox[{"newton", "'"}], "s", " ", 
          RowBox[{"method", "."}]}]}], "*)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{
        "If", " ", "we", " ", "are", " ", "here", " ", "maybe", " ", "the", 
         " ", 
         RowBox[{"s", ".", "p", ".", " ", "has"}], " ", "a", " ", "high", " ", 
         RowBox[{"value", ".", " ", "I"}], " ", "try", " ", "to", " ", "fix", 
         " ", "it"}], "*)"}], "\n", 
       RowBox[{"(*", "  ", 
        RowBox[{
         RowBox[{
          RowBox[{"--", 
           RowBox[{"-", " ", "For"}]}], " ", "now"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
           "it", " ", "is", " ", "better", " ", "to", " ", "let", " ", "it", 
            " ", "as", " ", "no", " ", 
            RowBox[{"result", ".", " ", 
             RowBox[{"Newton", "'"}]}], "s", " ", "method", " ", "gives", " ",
             "realy", " ", "bad", " ", "results", " ", "when", " ", "this", 
            " ", "step", " ", "here", " ", "is", " ", 
            RowBox[{"needed", " ", "--"}]}], "-"}], "  ", ";", "\n", 
          RowBox[{"If", "[", "\n", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"VectorQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"af", ",", "bf", ",", "cf"}], "}"}], ",", 
                "NumericQ"}], "]"}], "\[Equal]", "False"}], "&&", 
             RowBox[{
              RowBox[{"VectorQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"af2", ",", "bf2", ",", "cf2"}], "}"}], ",", 
                "NumericQ"}], "]"}], "\[Equal]", "False"}], "&&", 
             RowBox[{
              RowBox[{"VectorQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"af3", ",", "bf3", ",", "cf3"}], "}"}], ",", 
                "NumericQ"}], "]"}], "\[Equal]", "False"}]}], ",", "\n", 
            RowBox[{
             RowBox[{"result4", "=", 
              RowBox[{"FindMaximum", "[", 
               RowBox[{
                RowBox[{"mle", "[", 
                 RowBox[{
                  RowBox[{"pvecRt", "[", 
                   RowBox[{
                    RowBox[{"Abs", "[", "nt", "]"}], ",", 
                    RowBox[{"Abs", "[", "om", "]"}], ",", 
                    RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], 
                 "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"nt", ",", 
                    RowBox[{"Abs", "[", "ai", "]"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"om", ",", 
                    RowBox[{"Abs", "[", "bi", "]"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"gm", ",", 
                    RowBox[{"Abs", "[", "ci", "]"}]}], "}"}]}], "}"}], ",", 
                RowBox[{"Method", "\[Rule]", "\"\<Newton\>\""}], ",", 
                RowBox[{"MaxIterations", "\[Rule]", "mi"}], ",", 
                RowBox[{"WorkingPrecision", "\[Rule]", "wp"}], ",", 
                RowBox[{"AccuracyGoal", "\[Rule]", "ag"}]}], "]"}]}], ";", 
             "\n", 
             RowBox[{"er2", "=", 
              RowBox[{"Part", "[", 
               RowBox[{"result4", ",", "1"}], "]"}]}], ";", "\n", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"af", ",", "bf", ",", "cf"}], "}"}], "=", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"nt", ",", "om", ",", "gm"}], "}"}], "/.", 
               RowBox[{"Part", "[", 
                RowBox[{"result4", ",", "2"}], "]"}]}]}]}]}], "\n", "]"}], 
          ";"}]}], "\n", "*)"}], "\n", 
       RowBox[{"{", 
        RowBox[{
        "af", ",", "bf", ",", "cf", ",", "er1", ",", "er2", ",", 
         "methodmark"}], "}"}]}]}], "\n", "]"}]}], "\n", "\n"}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[356]:=",ExpressionUUID->"557f333a-b6bb-46f0-ab27-0ce37a87a243"]
}, Closed]],

Cell[CellGroupData[{

Cell["estimatorThermalMLEv6", "Subsection",ExpressionUUID->"7fbdb4f8-6fda-45c6-b1bd-c56bbbcfa53a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Step", " ", "1", " ", "with", " ", "MLE", " ", "to", " ", "get", " ", "a",
     " ", "good", " ", "staerting", " ", 
    RowBox[{"point", ".", " ", "For"}], " ", "Single", " ", "fit", " ", 
    "only"}], "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Differently", " ", "from", " ", "version", " ", "1"}], ",", " ", 
    RowBox[{
    "here", " ", "we", " ", "consider", " ", "both", " ", "constrained", " ", 
     "and", " ", "unconstrained", " ", "local", " ", "optimization"}]}], 
   "*)"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"Also", ",", " ", 
    RowBox[{"different", " ", "from", " ", "version", " ", "2"}], ",", " ", 
    RowBox[{"here", " ", "we", " ", "use", " ", 
     RowBox[{"Abs", "[", "]"}], " ", "for", " ", "nbar", " ", "such", " ", 
     "way", " ", "that", " ", "there", " ", "will", " ", "be", " ", 
     "nnegative", " ", "value", " ", "for", " ", "temperature"}]}], "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{"Clear", "[", "estimatorThermalMLEv6", "]"}], "\n", 
   RowBox[{
    RowBox[{"estimatorThermalMLEv6", "[", 
     RowBox[{
     "POPLIST_", ",", "TLIST_", ",", "NF_", ",", "METHOD1_", ",", "METHOD2_", 
      ",", "IT_", ",", "NTi_", ",", "NTf_", ",", "OMi_", ",", "OMf_", ",", 
      "GMi_", ",", "GMf_", ",", "t0i_", ",", "t0f_", ",", "WP_", ",", "AG_", 
      ",", "STEPM_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"pop", "=", "POPLIST"}], ",", 
        RowBox[{"tvec", "=", "TLIST"}], ",", 
        RowBox[{"method1", "=", "METHOD1"}], ",", 
        RowBox[{"method2", "=", "METHOD2"}], ",", "wSquaredError", ",", 
        "result1", ",", "result2", ",", "\n", "ai", ",", "bi", ",", "ci", ",",
         "af", ",", "bf", ",", "cf", ",", "af2", ",", "bf2", ",", "cf2", ",", 
        "af3", ",", "bf3", ",", "cf3", ",", "\n", "om", ",", "gm", ",", "\n", 
        RowBox[{"omi", "=", "OMi"}], ",", 
        RowBox[{"omf", "=", "OMf"}], ",", 
        RowBox[{"gmi", "=", "GMi"}], ",", 
        RowBox[{"gmf", "=", "GMf"}], ",", "\n", 
        RowBox[{"nti", "=", "NTi"}], ",", 
        RowBox[{"ntf", "=", "NTf"}], ",", "\n", "p0", ",", "omega", ",", 
        "gamma", ",", 
        RowBox[{"mi", "=", "IT"}], ",", 
        RowBox[{"wp", "=", "WP"}], ",", "tpoints", ",", "\n", "NBAR", ",", 
        "\n", 
        RowBox[{"nf", "=", "NF"}], ",", "\n", "er1", ",", "er2", ",", "er3", 
        ",", "\n", "nt", ",", "A0", ",", "a0", ",", "\n", 
        RowBox[{"ag", "=", "AG"}], ",", "di", ",", "df", ",", "df3", ",", 
        "df2", ",", "\n", "pvect", ",", "pvecRt", ",", "mle", ",", "result3", 
        ",", "methodmark", ",", "result4", ",", "steps", ",", "pvectv2", ",", 
        "pvecRtv2"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"tpoints", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "tvec", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
       RowBox[{"(*", "*)"}], "\n", "\n", "\n", 
       RowBox[{"(*", "*)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{"P_down", 
         RowBox[{"(", "t", ")"}], " ", "Vector", " ", "Function"}], "*)"}], 
       "\n", 
       RowBox[{
        RowBox[{"pvect", "[", 
         RowBox[{"NT_", ",", "A0_", ",", "OM_", ",", "GM_"}], "]"}], ":=", 
        RowBox[{"pDowntMod2", "[", 
         RowBox[{
         "0", ",", "0", ",", "NT", ",", "0", ",", "A0", ",", "tvec", ",", 
          "nf", ",", "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"pvecRt", "[", 
         RowBox[{
          RowBox[{"NT_", "?", "NumericQ"}], ",", 
          RowBox[{"A0_", "?", "NumericQ"}], ",", 
          RowBox[{"OM_", "?", "NumericQ"}], ",", 
          RowBox[{"GM_", "?", "NumericQ"}]}], "]"}], ":=", 
        RowBox[{"pvect", "[", 
         RowBox[{"NT", ",", "A0", ",", "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{"(*", 
        RowBox[{"Testing", " ", "a", " ", "mod", " ", "for", " ", "A0"}], 
        "*)"}], "\n", 
       RowBox[{
        RowBox[{"pvectv2", "[", 
         RowBox[{"NT_", ",", "A0_", ",", "OM_", ",", "GM_"}], "]"}], ":=", 
        RowBox[{"pDowntMod2", "[", 
         RowBox[{"0", ",", "0", ",", "NT", ",", "0", ",", 
          RowBox[{"5", "*", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "+", 
              RowBox[{"Tanh", "[", "A0", "]"}]}], ")"}], "/", "10"}]}], ",", 
          "tvec", ",", "nf", ",", "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"pvecRtv2", "[", 
         RowBox[{
          RowBox[{"NT_", "?", "NumericQ"}], ",", 
          RowBox[{"A0_", "?", "NumericQ"}], ",", 
          RowBox[{"OM_", "?", "NumericQ"}], ",", 
          RowBox[{"GM_", "?", "NumericQ"}]}], "]"}], ":=", 
        RowBox[{"pvectv2", "[", 
         RowBox[{"NT", ",", "A0", ",", "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{"(*", "**********************)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Maxiimum", " ", "Log"}], "-", 
         RowBox[{"Likelihood", " ", "function"}]}], "*)"}], "\n", 
       RowBox[{
        RowBox[{"mle", "[", 
         RowBox[{
          RowBox[{"PVEC_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"VectorQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", 
          RowBox[{"POP_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"VectorQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "]"}], 
        ":=", 
        RowBox[{
         RowBox[{"POP", ".", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "PVEC"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "POP"}], ")"}], ".", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", 
            RowBox[{"1", "-", "PVEC"}]}], "]"}]}]}]}], ";", "\n", 
       RowBox[{"(*", "*)"}], 
       RowBox[{"(*", 
        RowBox[{"&&", 
         RowBox[{"0", "<", "a0", "\[LessEqual]", "1"}]}], "*)"}], "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"STEPM", "==", "0"}], ",", "\n", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"result1", "=", 
            RowBox[{"NMaximize", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"mle", "[", 
                 RowBox[{
                  RowBox[{"pvecRtv2", "[", 
                   RowBox[{"nt", ",", "a0", ",", "om", ",", "gm"}], "]"}], 
                  ",", "pop"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
                 RowBox[{"om", ">", "0"}], "&&", 
                 RowBox[{"gm", ">", "0"}], "&&", 
                 RowBox[{"a0", "<", "8"}]}]}], "}"}], ",", "\n", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"a0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"om", ",", "omi", ",", "omf"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"gm", ",", "gmi", ",", "gmf"}], "}"}]}], "}"}], ",", 
              RowBox[{"Method", "->", "method1"}], ",", 
              RowBox[{"MaxIterations", "->", "mi"}], ",", 
              RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
              RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
           RowBox[{"er1", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ai", ",", "bi", ",", "ci", ",", "di"}], "}"}], "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"nt", ",", "a0", ",", "om", ",", "gm"}], "}"}], "/.", 
             RowBox[{"Part", "[", 
              RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
           RowBox[{"steps", "=", 
            RowBox[{"11", "/", "10"}]}], ";", "\n", 
           RowBox[{"(*", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"nt", ",", 
                RowBox[{"Abs", "[", "ai", "]"}], ",", 
                RowBox[{"2", 
                 RowBox[{"Abs", "[", "ai", "]"}]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"a0", ",", 
                RowBox[{"Abs", "[", "bi", "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"om", ",", 
                RowBox[{"Abs", "[", "ci", "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"gm", ",", 
                RowBox[{"Abs", "[", "di", "]"}]}], "}"}]}], "}"}], "*)"}], 
           "\n", 
           RowBox[{"result2", "=", 
            RowBox[{"FindMaximum", "[", 
             RowBox[{
              RowBox[{"mle", "[", 
               RowBox[{
                RowBox[{"pvecRtv2", "[", 
                 RowBox[{
                  RowBox[{"Abs", "[", "nt", "]"}], ",", "a0", ",", 
                  RowBox[{"Abs", "[", "om", "]"}], ",", 
                  RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], 
               "]"}], ",", 
              RowBox[{"fSTpointsf", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "a0", ",", "om", ",", "gm"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", 
                  RowBox[{"Abs", "[", "ci", "]"}], ",", 
                  RowBox[{"Abs", "[", "di", "]"}]}], "}"}], ",", "steps", ",",
                 "method2"}], "]"}], ",", 
              RowBox[{"Method", "->", "method2"}], ",", 
              RowBox[{"MaxIterations", "->", "mi"}], ",", 
              RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
              RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
           RowBox[{"er2", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"af", ",", "bf", ",", "cf", ",", "df"}], "}"}], "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"nt", ",", "a0", ",", "om", ",", "gm"}], "}"}], "/.", 
             RowBox[{"Part", "[", 
              RowBox[{"result2", ",", "2"}], "]"}]}]}]}], "}"}], ",", "\n", 
         RowBox[{"(*", 
          RowBox[{"Using", " ", "Step", " ", "Monitor", " ", "here"}], "*)"}],
          "\n", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<Step1\>\"", "]"}], ";", "\n", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"result1", "=", 
             RowBox[{"NMaximize", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"mle", "[", 
                  RowBox[{
                   RowBox[{"pvecRtv2", "[", 
                    RowBox[{"nt", ",", "a0", ",", "om", ",", "gm"}], "]"}], 
                   ",", "pop"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
                  RowBox[{"om", ">", "0"}], "&&", 
                  RowBox[{"gm", ">", "0"}], "&&", 
                  RowBox[{"a0", "<", "8"}]}]}], "}"}], ",", "\n", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"a0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"om", ",", "omi", ",", "omf"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"gm", ",", "gmi", ",", "gmf"}], "}"}]}], "}"}], ",", 
               RowBox[{"Method", "->", "method1"}], ",", 
               RowBox[{"MaxIterations", "->", "mi"}], ",", 
               RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
               RowBox[{"AccuracyGoal", "->", "ag"}], ",", 
               RowBox[{"StepMonitor", ":>", " ", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<Step points = \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{"nt", ",", "a0", ",", "om", ",", "gm"}], "}"}]}], 
                 "]"}]}]}], "]"}]}], ";", "\n", 
            RowBox[{"er1", "=", 
             RowBox[{"Part", "[", 
              RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ai", ",", "bi", ",", "ci", ",", "di"}], "}"}], "=", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"nt", ",", "a0", ",", "om", ",", "gm"}], "}"}], "/.", 
              RowBox[{"Part", "[", 
               RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<Result = \>\"", ",", 
              RowBox[{"{", 
               RowBox[{"ai", ",", "bi", ",", "ci", ",", "di"}], "}"}]}], 
             "]"}], ";", "\n", 
            RowBox[{"Print", "[", "\"\<Step2\>\"", "]"}], ";", "\n", 
            RowBox[{"steps", "=", 
             RowBox[{"11", "/", "10"}]}], ";", "\n", 
            RowBox[{"(*", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"nt", ",", 
                 RowBox[{"Abs", "[", "ai", "]"}], ",", 
                 RowBox[{"2", 
                  RowBox[{"Abs", "[", "ai", "]"}]}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"a0", ",", 
                 RowBox[{"Abs", "[", "bi", "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"om", ",", 
                 RowBox[{"Abs", "[", "ci", "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"gm", ",", 
                 RowBox[{"Abs", "[", "di", "]"}]}], "}"}]}], "}"}], "*)"}], 
            "\n", 
            RowBox[{"result2", "=", 
             RowBox[{"FindMaximum", "[", 
              RowBox[{
               RowBox[{"mle", "[", 
                RowBox[{
                 RowBox[{"pvecRtv2", "[", 
                  RowBox[{
                   RowBox[{"Abs", "[", "nt", "]"}], ",", "a0", ",", 
                   RowBox[{"Abs", "[", "om", "]"}], ",", 
                   RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], 
                "]"}], ",", 
               RowBox[{"fSTpointsf", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"nt", ",", "a0", ",", "om", ",", "gm"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", 
                   RowBox[{"Abs", "[", "ci", "]"}], ",", 
                   RowBox[{"Abs", "[", "di", "]"}]}], "}"}], ",", "steps", 
                 ",", "method2"}], "]"}], ",", 
               RowBox[{"Method", "->", "method2"}], ",", 
               RowBox[{"MaxIterations", "->", "mi"}], ",", 
               RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
               RowBox[{"AccuracyGoal", "->", "ag"}], ",", 
               RowBox[{"StepMonitor", ":>", " ", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<Step points = \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{"nt", ",", "a0", ",", "om", ",", "gm"}], "}"}]}], 
                 "]"}]}]}], "]"}]}], ";", "\n", 
            RowBox[{"er2", "=", 
             RowBox[{"Part", "[", 
              RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"af", ",", "bf", ",", "cf", ",", "df"}], "}"}], "=", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"nt", ",", "a0", ",", "om", ",", "gm"}], "}"}], "/.", 
              RowBox[{"Part", "[", 
               RowBox[{"result2", ",", "2"}], "]"}]}]}]}], "}"}]}]}], "\n", 
        "]"}], ";", "\n", 
       RowBox[{"{", 
        RowBox[{
        "af", ",", "bf", ",", "cf", ",", "df", ",", "er1", ",", "er2"}], 
        "}"}]}]}], "\n", "]"}]}], "\n", "\n"}]}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[358]:=",ExpressionUUID->"4e704253-698c-4746-9461-de70904ec325"]
}, Closed]],

Cell[CellGroupData[{

Cell["estimatorThermalt6 - A0B0", "Subsection",
 CellChangeTimes->{{3.8950963490043006`*^9, 
  3.895096353500375*^9}},ExpressionUUID->"cfdc411f-82ac-4ac5-bd15-\
d095de812705"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "estimatorThermalt6", "]"}], "\n", 
 RowBox[{
  RowBox[{"estimatorThermalt6", "[", 
   RowBox[{
   "POPLIST_", ",", "ERRLIST_", ",", "TLIST_", ",", "NF_", ",", "METHOD1_", 
    ",", "METHOD2_", ",", "IT_", ",", "NTi_", ",", "NTf_", ",", "OMEGAi_", 
    ",", "OMEGAf_", ",", "GAMMAi_", ",", "GAMMAf_", ",", "t0i_", ",", "t0f_", 
    ",", "WP_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"pop", "=", "POPLIST"}], ",", 
      RowBox[{"err", "=", "ERRLIST"}], ",", 
      RowBox[{"tvec", "=", "TLIST"}], ",", 
      RowBox[{"method1", "=", "METHOD1"}], ",", 
      RowBox[{"method2", "=", "METHOD2"}], ",", "wSquaredError", ",", 
      "result1", ",", "result2", ",", "\n", "ci", ",", "cf", ",", "om", ",", 
      "gm", ",", 
      RowBox[{"omii", "=", "OMEGAi"}], ",", 
      RowBox[{"omf", "=", "OMEGAf"}], ",", 
      RowBox[{"gmii", "=", "GAMMAi"}], ",", 
      RowBox[{"gmf", "=", "GAMMAf"}], ",", 
      RowBox[{"nti", "=", "NTi"}], ",", 
      RowBox[{"ntf", "=", "NTf"}], ",", "ntii", ",", "omegaii", ",", 
      "gammaii", ",", "\n", "ntff", ",", "omegaf", ",", "gammaf", ",", "p0", 
      ",", "omega", ",", "gamma", ",", 
      RowBox[{"mi", "=", "IT"}], ",", 
      RowBox[{"wp", "=", "WP"}], ",", "tpoints", ",", "ALPHA", ",", "R", ",", 
      "NBAR", ",", "PHASE", ",", 
      RowBox[{"nf", "=", "NF"}], ",", "er1", ",", "er2", ",", "nt", ",", "a0",
       ",", "b0", ",", "a0ii", ",", "b0ii", ",", "a0ff", ",", "b0ff"}], "}"}],
     ",", "\n", "\n", 
    RowBox[{
     RowBox[{"tpoints", "=", 
      RowBox[{
       RowBox[{"Dimensions", "[", "tvec", "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Fit", " ", "for", " ", "Thermal", " ", "State", " ", "from", " ", 
        "P_down", 
        RowBox[{"(", "t", ")"}], " ", 
        RowBox[{"data", ".", " ", "nbar"}]}], ",", " ", 
       RowBox[{
       "omega", " ", "and", " ", "gamma", " ", "are", " ", "variables"}]}], 
      " ", "*)"}], "\n", 
     RowBox[{
      RowBox[{"wSquaredError", "[", 
       RowBox[{"nt_", ",", "a0_", ",", "b0_", ",", "om_", ",", "gm_"}], "]"}],
       "=", 
      RowBox[{"SetPrecision", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Divide", "[", 
          RowBox[{"1", ",", 
           RowBox[{"err", "^", "2"}]}], "]"}], ".", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"pop", "-", " ", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"pDowntMod4", "[", 
               RowBox[{
               "0", ",", "0", ",", "nt", ",", "0", ",", "a0", ",", "b0", ",", 
                RowBox[{"tvec", "[", 
                 RowBox[{"[", "t", "]"}], "]"}], ",", "nf", ",", "om", ",", 
                "gm"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"t", ",", "1", ",", "tpoints"}], "}"}]}], "]"}]}], 
           ")"}], "^", "2"}]}], ",", "wp"}], "]"}]}], ";", "\n", 
     RowBox[{"result1", "=", 
      RowBox[{"NMinimize", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"wSquaredError", "[", 
           RowBox[{"nt", ",", "a0", ",", "b0", ",", "omega", ",", "gamma"}], 
           "]"}], ",", 
          RowBox[{
           RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
           RowBox[{"omega", ">", "0"}], "&&", 
           RowBox[{"gamma", ">", "0"}], "&&", 
           RowBox[{"a0", ">", "0"}], "&&", 
           RowBox[{"b0", ">", "0"}]}]}], "}"}], ",", "\n", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"a0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"b0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"omega", ",", "omii", ",", "omf"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"gamma", ",", "gmii", ",", "gmf"}], "}"}]}], "}"}], ",", 
        RowBox[{"Method", "->", "method1"}], ",", 
        RowBox[{"MaxIterations", "->", "mi"}], ",", 
        RowBox[{"WorkingPrecision", "->", "wp"}]}], "]"}]}], ";", "\n", 
     RowBox[{"er1", "=", 
      RowBox[{"Part", "[", 
       RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "ntii", ",", "a0ii", ",", "b0ii", ",", "omegaii", ",", "gammaii"}], 
       "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nt", ",", "a0", ",", "b0", ",", "omega", ",", "gamma"}], 
        "}"}], "/.", 
       RowBox[{"Part", "[", 
        RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
     RowBox[{"result2", "=", 
      RowBox[{"FindMinimum", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"wSquaredError", "[", 
           RowBox[{"nt", ",", "a0", ",", "b0", ",", "omega", ",", "gamma"}], 
           "]"}], ",", 
          RowBox[{
           RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
           RowBox[{"omega", ">", "0"}], "&&", 
           RowBox[{"gamma", ">", "0"}], "&&", 
           RowBox[{"a0", ">", "0"}], "&&", 
           RowBox[{"b0", ">", "0"}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"nt", ",", "ntii"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"a0", ",", "a0ii"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"b0", ",", "b0ii"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"omega", ",", "omegaii"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"gamma", ",", "gammaii"}], "}"}]}], "}"}], ",", 
        RowBox[{"Method", "->", "method2"}], ",", 
        RowBox[{"MaxIterations", "->", "mi"}], ",", 
        RowBox[{"WorkingPrecision", "->", "wp"}]}], "]"}]}], ";", "\n", 
     RowBox[{"er2", "=", 
      RowBox[{"Part", "[", 
       RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "ntff", ",", "a0ff", ",", "b0ff", ",", "omegaf", ",", "gammaf"}], 
       "}"}], "=", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nt", ",", "a0", ",", "b0", ",", "omega", ",", "gamma"}], 
        "}"}], "/.", 
       RowBox[{"Part", "[", 
        RowBox[{"result2", ",", "2"}], "]"}]}]}], ";", "\n", 
     RowBox[{"{", 
      RowBox[{
      "ntff", ",", "a0ff", ",", "b0ff", ",", "omegaf", ",", "gammaf", ",", 
       "er1", ",", "er2"}], "}"}]}]}], "\n", "]"}]}], "\n"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.895096357115363*^9, 3.895096485949295*^9}, {
  3.8950965218145924`*^9, 3.8950965434897647`*^9}, {3.8950966311957455`*^9, 
  3.895096663755747*^9}, {3.895098002970152*^9, 3.8950980030504427`*^9}},
 CellLabel->
  "In[360]:=",ExpressionUUID->"13ec1b4e-373d-4936-b061-924d40ca7626"]
}, Closed]],

Cell[CellGroupData[{

Cell["estimatorThermalMLEv7", "Subsection",
 CellChangeTimes->{{3.8933144317643394`*^9, 
  3.8933144348293495`*^9}},ExpressionUUID->"47919a91-7ca0-469d-938e-\
82b0b52c004a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Incomplete", ".", " ", "Needs"}], " ", "lots", " ", "of", " ", 
    "work", " ", "yet"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"Clear", "[", "estimatorThermalMLEv7", "]"}], "\n", 
   RowBox[{
    RowBox[{"estimatorThermalMLEv7", "[", 
     RowBox[{
     "POPLIST_", ",", "TLIST_", ",", "NF_", ",", "METHOD1_", ",", "METHOD2_", 
      ",", "IT_", ",", "NTi_", ",", "NTf_", ",", "OMi_", ",", "OMf_", ",", 
      "GMi_", ",", "GMf_", ",", "t0i_", ",", "t0f_", ",", "WP_", ",", "AG_", 
      ",", "STEPM_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"pop", "=", "POPLIST"}], ",", 
        RowBox[{"tvec", "=", "TLIST"}], ",", 
        RowBox[{"method1", "=", "METHOD1"}], ",", 
        RowBox[{"method2", "=", "METHOD2"}], ",", "wSquaredError", ",", 
        "result1", ",", "result2", ",", "\n", "ai", ",", "bi", ",", "ci", ",",
         "af", ",", "bf", ",", "cf", ",", "af2", ",", "bf2", ",", "cf2", ",", 
        "af3", ",", "bf3", ",", "cf3", ",", "\n", "om", ",", "gm", ",", "\n", 
        RowBox[{"omi", "=", "OMi"}], ",", 
        RowBox[{"omf", "=", "OMf"}], ",", 
        RowBox[{"gmi", "=", "GMi"}], ",", 
        RowBox[{"gmf", "=", "GMf"}], ",", "\n", 
        RowBox[{"nti", "=", "NTi"}], ",", 
        RowBox[{"ntf", "=", "NTf"}], ",", "\n", "p0", ",", "omega", ",", 
        "gamma", ",", 
        RowBox[{"mi", "=", "IT"}], ",", 
        RowBox[{"wp", "=", "WP"}], ",", "tpoints", ",", "\n", "NBAR", ",", 
        "\n", 
        RowBox[{"nf", "=", "NF"}], ",", "\n", "er1", ",", "er2", ",", "er3", 
        ",", "\n", "nt", ",", "A0", ",", "a0", ",", "b0", ",", "ei", ",", 
        "ef", ",", "B0", ",", "\n", 
        RowBox[{"ag", "=", "AG"}], ",", "di", ",", "df", ",", "df3", ",", 
        "df2", ",", "\n", "pvect", ",", "pvecRt", ",", "mle", ",", "result3", 
        ",", "methodmark", ",", "result4", ",", "steps", ",", "pvectv2", ",", 
        "pvecRtv2"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"tpoints", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "tvec", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
       RowBox[{"(*", "*)"}], "\n", "\n", "\n", 
       RowBox[{"(*", "*)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{"P_down", 
         RowBox[{"(", "t", ")"}], " ", "Vector", " ", "Function"}], "*)"}], 
       "\n", 
       RowBox[{
        RowBox[{"pvect", "[", 
         RowBox[{"NT_", ",", "A0_", ",", "B0", ",", "OM_", ",", "GM_"}], 
         "]"}], ":=", 
        RowBox[{"pDowntMod3", "[", 
         RowBox[{
         "0", ",", "0", ",", "NT", ",", "0", ",", "A0", ",", "B0", ",", 
          "tvec", ",", "nf", ",", "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"pvecRt", "[", 
         RowBox[{
          RowBox[{"NT_", "?", "NumericQ"}], ",", 
          RowBox[{"A0_", "?", "NumericQ"}], ",", 
          RowBox[{"B0_", "?", "NumericQ"}], ",", 
          RowBox[{"OM_", "?", "NumericQ"}], ",", 
          RowBox[{"GM_", "?", "NumericQ"}]}], "]"}], ":=", 
        RowBox[{"pvect", "[", 
         RowBox[{"NT", ",", "A0", ",", "B0", ",", "OM", ",", "GM"}], "]"}]}], 
       ";", "\n", 
       RowBox[{"(*", 
        RowBox[{"Testing", " ", "a", " ", "mod", " ", "for", " ", "A0"}], 
        "*)"}], "\n", 
       RowBox[{
        RowBox[{"pvectv2", "[", 
         RowBox[{"NT_", ",", "A0_", ",", "B0_", ",", "OM_", ",", "GM_"}], 
         "]"}], ":=", 
        RowBox[{"pDowntMod3", "[", 
         RowBox[{"0", ",", "0", ",", "NT", ",", "0", ",", 
          RowBox[{"5", "*", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "+", 
              RowBox[{"Tanh", "[", "A0", "]"}]}], ")"}], "/", "10"}]}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", 
             RowBox[{"Tanh", "[", "B0", "]"}]}], ")"}], "/", "2"}], ",", 
          "tvec", ",", "nf", ",", "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"pvecRtv2", "[", 
         RowBox[{
          RowBox[{"NT_", "?", "NumericQ"}], ",", 
          RowBox[{"A0_", "?", "NumericQ"}], ",", 
          RowBox[{"B0_", "?", "NumericQ"}], ",", 
          RowBox[{"OM_", "?", "NumericQ"}], ",", 
          RowBox[{"GM_", "?", "NumericQ"}]}], "]"}], ":=", 
        RowBox[{"pvectv2", "[", 
         RowBox[{"NT", ",", "A0", ",", "B0", ",", "OM", ",", "GM"}], "]"}]}], 
       ";", "\n", 
       RowBox[{"(*", "**********************)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Maxiimum", " ", "Log"}], "-", 
         RowBox[{"Likelihood", " ", "function"}]}], "*)"}], "\n", 
       RowBox[{
        RowBox[{"mle", "[", 
         RowBox[{
          RowBox[{"PVEC_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"VectorQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", 
          RowBox[{"POP_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"VectorQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "]"}], 
        ":=", 
        RowBox[{
         RowBox[{"POP", ".", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "PVEC"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "POP"}], ")"}], ".", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", 
            RowBox[{"1", "-", "PVEC"}]}], "]"}]}]}]}], ";", "\n", 
       RowBox[{"(*", "*)"}], 
       RowBox[{"(*", 
        RowBox[{"&&", 
         RowBox[{"0", "<", "a0", "\[LessEqual]", "1"}]}], "*)"}], "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"STEPM", "==", "0"}], ",", "\n", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"result1", "=", 
            RowBox[{"NMaximize", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"mle", "[", 
                 RowBox[{
                  RowBox[{"pvecRtv2", "[", 
                   RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}],
                    "]"}], ",", "pop"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
                 RowBox[{"om", ">", "0"}], "&&", 
                 RowBox[{"gm", ">", "0"}], "&&", 
                 RowBox[{"a0", "<", "8"}], "&&", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"Tanh", "[", "a0", "]"}]}], ")"}], "/", "2"}], 
                  "<", "b0", "<", 
                  RowBox[{"2", "-", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"Tanh", "[", "a0", "]"}]}], ")"}], "/", 
                    "2"}]}]}]}]}], "}"}], ",", "\n", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"a0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"om", ",", "omi", ",", "omf"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"gm", ",", "gmi", ",", "gmf"}], "}"}]}], "}"}], ",", 
              RowBox[{"Method", "->", "method1"}], ",", 
              RowBox[{"MaxIterations", "->", "mi"}], ",", 
              RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
              RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
           RowBox[{"er1", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
             "}"}], "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
              "}"}], "/.", 
             RowBox[{"Part", "[", 
              RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
           RowBox[{"Print", "[", 
            RowBox[{"{", 
             RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
             "}"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"steps", "=", 
            RowBox[{"11", "/", "10"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"stpointsS2", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "}"}],
                     "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", "ci", 
                    ",", 
                    RowBox[{"Abs", "[", "di", "]"}], ",", 
                    RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "1", ",", 
                    RowBox[{
                    RowBox[{"Dimensions", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "}"}],
                     "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
                "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"stpointsS2", "=", 
              RowBox[{"fSTpointsf", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", "ci", ",", 
                  RowBox[{"Abs", "[", "di", "]"}], ",", 
                  RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], ",", "steps", ",",
                 "method2"}], "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
           "\n", 
           RowBox[{"result2", "=", 
            RowBox[{"FindMaximum", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"mle", "[", 
                RowBox[{
                 RowBox[{"pvecRtv2", "[", 
                  RowBox[{
                   RowBox[{"Abs", "[", "nt", "]"}], ",", 
                   RowBox[{"Abs", "[", "a0", "]"}], ",", 
                   RowBox[{"Abs", "[", "b0", "]"}], ",", 
                   RowBox[{"Abs", "[", "om", "]"}], ",", 
                   RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], 
                "]"}], "}"}], ",", 
              RowBox[{"fSTpointsf", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Abs", "[", "ai", "]"}], ",", 
                  RowBox[{"Abs", "[", "bi", "]"}], ",", 
                  RowBox[{"Abs", "[", "ci", "]"}], ",", 
                  RowBox[{"Abs", "[", "di", "]"}], ",", 
                  RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], ",", "steps", ",",
                 "method2"}], "]"}], ",", 
              RowBox[{"Method", "->", "method2"}], ",", 
              RowBox[{"MaxIterations", "->", "mi"}], ",", 
              RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
              RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
           RowBox[{"er2", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"af", ",", "bf", ",", "cf", ",", "df", ",", "ef"}], 
             "}"}], "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
              "}"}], "/.", 
             RowBox[{"Part", "[", 
              RowBox[{"result2", ",", "2"}], "]"}]}]}]}], "}"}], ",", "\n", 
         RowBox[{"(*", 
          RowBox[{"Using", " ", "Step", " ", "Monitor", " ", "here"}], "*)"}],
          "\n", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<Step1\>\"", "]"}], ";", "\n", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"result1", "=", 
             RowBox[{"NMaximize", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"mle", "[", 
                  RowBox[{
                   RowBox[{"pvecRtv2", "[", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "]"}],
                    ",", "pop"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
                  RowBox[{"om", ">", "0"}], "&&", 
                  RowBox[{"gm", ">", "0"}], "&&", 
                  RowBox[{"a0", "<", "8"}]}]}], "}"}], ",", "\n", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"a0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"b0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"om", ",", "omi", ",", "omf"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"gm", ",", "gmi", ",", "gmf"}], "}"}]}], "}"}], ",", 
               RowBox[{"Method", "->", "method1"}], ",", 
               RowBox[{"MaxIterations", "->", "mi"}], ",", 
               RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
               RowBox[{"AccuracyGoal", "->", "ag"}], ",", 
               RowBox[{"StepMonitor", ":>", " ", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<Step points = \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}],
                    "}"}]}], "]"}]}]}], "]"}]}], ";", "\n", 
            RowBox[{"er1", "=", 
             RowBox[{"Part", "[", 
              RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
              "}"}], "=", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
               "}"}], "/.", 
              RowBox[{"Part", "[", 
               RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<Result = \>\"", ",", 
              RowBox[{"{", 
               RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
               "}"}]}], "]"}], ";", "\n", 
            RowBox[{"Print", "[", "\"\<Step2\>\"", "]"}], ";", "\n", 
            RowBox[{"steps", "=", 
             RowBox[{"11", "/", "10"}]}], ";", "\n", "\n", 
            RowBox[{"result2", "=", 
             RowBox[{"FindMaximum", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"mle", "[", 
                 RowBox[{
                  RowBox[{"pvecRtv2", "[", 
                   RowBox[{
                    RowBox[{"Abs", "[", "nt", "]"}], ",", "a0", ",", "b0", 
                    ",", 
                    RowBox[{"Abs", "[", "om", "]"}], ",", 
                    RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], 
                 "]"}], "}"}], ",", 
               RowBox[{"fSTpointsf", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
                  "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", "ci", ",", 
                   RowBox[{"Abs", "[", "di", "]"}], ",", 
                   RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], ",", "steps", 
                 ",", "method2"}], "]"}], ",", 
               RowBox[{"Method", "->", "method2"}], ",", 
               RowBox[{"MaxIterations", "->", "mi"}], ",", 
               RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
               RowBox[{"AccuracyGoal", "->", "ag"}], ",", 
               RowBox[{"StepMonitor", ":>", " ", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<Step points = \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}],
                    "}"}]}], "]"}]}]}], "]"}]}], ";", "\n", 
            RowBox[{"er2", "=", 
             RowBox[{"Part", "[", 
              RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"af", ",", "bf", ",", "cf", ",", "df", ",", "ef"}], 
              "}"}], "=", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
               "}"}], "/.", 
              RowBox[{"Part", "[", 
               RowBox[{"result2", ",", "2"}], "]"}]}]}]}], "}"}]}]}], "\n", 
        "]"}], ";", "\n", 
       RowBox[{"{", 
        RowBox[{
        "af", ",", "bf", ",", "cf", ",", "df", ",", "ef", ",", "er1", ",", 
         "er2"}], "}"}]}]}], "\n", "]"}]}], "\n", "\n"}]}]], "Input",
 CellChangeTimes->{{3.893161528473217*^9, 3.893161667393219*^9}, 
   3.893161725553217*^9, {3.8931624336536465`*^9, 3.8931625039716463`*^9}, 
   3.893162773461666*^9, {3.8931632108632607`*^9, 3.8931632622932477`*^9}, {
   3.8931633061592474`*^9, 3.89316331399925*^9}, {3.8931634418182497`*^9, 
   3.893163466462248*^9}, {3.893163524625763*^9, 3.8931635392677617`*^9}, 
   3.893163575086763*^9, {3.893163626102763*^9, 3.893163632307761*^9}, 
   3.893163699856762*^9, {3.893163786796762*^9, 3.8931638243517613`*^9}, {
   3.8931640537952166`*^9, 3.8931640575012174`*^9}, {3.893164435070443*^9, 
   3.8931644591095057`*^9}, {3.8933169786138544`*^9, 3.893317107861854*^9}, {
   3.8933171625468545`*^9, 3.893317203957853*^9}, {3.8933172491538544`*^9, 
   3.8933174823948545`*^9}, {3.893317669101857*^9, 3.893317746273853*^9}, 
   3.893317897308855*^9, {3.89331825061423*^9, 3.8933182870522413`*^9}, {
   3.89331833111723*^9, 3.8933183375562296`*^9}, {3.8933188166802287`*^9, 
   3.89331884175625*^9}, {3.893318876943228*^9, 3.89331889720923*^9}, {
   3.8933192869002295`*^9, 3.8933192902562294`*^9}, {3.893319342167228*^9, 
   3.8933193693412294`*^9}, {3.8933205954562283`*^9, 
   3.8933206218592296`*^9}, {3.8933207446692295`*^9, 3.8933207476132298`*^9}},
 CellLabel->
  "In[362]:=",ExpressionUUID->"3e6d556e-54ad-4e0d-8c0a-c537b7ef355a"]
}, Closed]],

Cell[CellGroupData[{

Cell["estimatorThermalMLEv8", "Subsection",
 CellChangeTimes->{{3.8933144317643394`*^9, 3.8933144348293495`*^9}, 
   3.8933194838532286`*^9},ExpressionUUID->"1a5691af-5513-4981-8b60-\
668c43ba0307"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Incomplete", ".", " ", "Needs"}], " ", "lots", " ", "of", " ", 
    "work", " ", "yet"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"Clear", "[", "estimatorThermalMLEv8", "]"}], "\n", 
   RowBox[{
    RowBox[{"estimatorThermalMLEv8", "[", 
     RowBox[{
     "POPLIST_", ",", "TLIST_", ",", "NF_", ",", "METHOD1_", ",", "METHOD2_", 
      ",", "IT_", ",", "NTi_", ",", "NTf_", ",", "OMi_", ",", "OMf_", ",", 
      "GMi_", ",", "GMf_", ",", "t0i_", ",", "t0f_", ",", "WP_", ",", "AG_", 
      ",", "STEPM_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"pop", "=", "POPLIST"}], ",", 
        RowBox[{"tvec", "=", "TLIST"}], ",", 
        RowBox[{"method1", "=", "METHOD1"}], ",", 
        RowBox[{"method2", "=", "METHOD2"}], ",", "wSquaredError", ",", 
        "result1", ",", "result2", ",", "\n", "ai", ",", "bi", ",", "ci", ",",
         "af", ",", "bf", ",", "cf", ",", "af2", ",", "bf2", ",", "cf2", ",", 
        "af3", ",", "bf3", ",", "cf3", ",", "\n", "om", ",", "gm", ",", "\n", 
        RowBox[{"omi", "=", "OMi"}], ",", 
        RowBox[{"omf", "=", "OMf"}], ",", 
        RowBox[{"gmi", "=", "GMi"}], ",", 
        RowBox[{"gmf", "=", "GMf"}], ",", "\n", 
        RowBox[{"nti", "=", "NTi"}], ",", 
        RowBox[{"ntf", "=", "NTf"}], ",", "\n", "p0", ",", "omega", ",", 
        "gamma", ",", 
        RowBox[{"mi", "=", "IT"}], ",", 
        RowBox[{"wp", "=", "WP"}], ",", "tpoints", ",", "\n", "NBAR", ",", 
        "\n", 
        RowBox[{"nf", "=", "NF"}], ",", "\n", "er1", ",", "er2", ",", "er3", 
        ",", "\n", "nt", ",", "A0", ",", "a0", ",", "b0", ",", "ei", ",", 
        "ef", ",", "B0", ",", "\n", 
        RowBox[{"ag", "=", "AG"}], ",", "di", ",", "df", ",", "df3", ",", 
        "df2", ",", "\n", "pvect", ",", "pvecRt", ",", "mle", ",", "result3", 
        ",", "methodmark", ",", "result4", ",", "steps", ",", "pvectv2", ",", 
        "pvecRtv2"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"tpoints", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "tvec", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
       RowBox[{"(*", "*)"}], "\n", "\n", "\n", 
       RowBox[{"(*", "*)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{"P_down", 
         RowBox[{"(", "t", ")"}], " ", "Vector", " ", "Function"}], "*)"}], 
       "\n", 
       RowBox[{
        RowBox[{"pvect", "[", 
         RowBox[{"NT_", ",", "A0_", ",", "B0", ",", "OM_", ",", "GM_"}], 
         "]"}], ":=", 
        RowBox[{"pDowntMod3", "[", 
         RowBox[{
         "0", ",", "0", ",", "NT", ",", "0", ",", "A0", ",", "B0", ",", 
          "tvec", ",", "nf", ",", "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"pvecRt", "[", 
         RowBox[{
          RowBox[{"NT_", "?", "NumericQ"}], ",", 
          RowBox[{"A0_", "?", "NumericQ"}], ",", 
          RowBox[{"B0_", "?", "NumericQ"}], ",", 
          RowBox[{"OM_", "?", "NumericQ"}], ",", 
          RowBox[{"GM_", "?", "NumericQ"}]}], "]"}], ":=", 
        RowBox[{"pvect", "[", 
         RowBox[{"NT", ",", "A0", ",", "B0", ",", "OM", ",", "GM"}], "]"}]}], 
       ";", "\n", 
       RowBox[{"(*", 
        RowBox[{"Testing", " ", "a", " ", "mod", " ", "for", " ", "A0"}], 
        "*)"}], "\n", 
       RowBox[{
        RowBox[{"pvectv2", "[", 
         RowBox[{"NT_", ",", "A0_", ",", "B0_", ",", "OM_", ",", "GM_"}], 
         "]"}], ":=", 
        RowBox[{"pDowntMod3", "[", 
         RowBox[{"0", ",", "0", ",", "NT", ",", "0", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", 
             RowBox[{"Tanh", "[", 
              RowBox[{
               RowBox[{"5", "A0"}], "-", "2"}], "]"}]}], ")"}], "/", "2"}], 
          ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", 
             RowBox[{"Tanh", "[", 
              RowBox[{
               RowBox[{"5", "B0"}], "-", "2"}], "]"}]}], ")"}], "/", "2"}], 
          " ", ",", "tvec", ",", "nf", ",", "OM", ",", "GM"}], "]"}]}], ";", 
       "\n", 
       RowBox[{
        RowBox[{"pvecRtv2", "[", 
         RowBox[{
          RowBox[{"NT_", "?", "NumericQ"}], ",", 
          RowBox[{"A0_", "?", "NumericQ"}], ",", 
          RowBox[{"B0_", "?", "NumericQ"}], ",", 
          RowBox[{"OM_", "?", "NumericQ"}], ",", 
          RowBox[{"GM_", "?", "NumericQ"}]}], "]"}], ":=", 
        RowBox[{"pvectv2", "[", 
         RowBox[{"NT", ",", "A0", ",", "B0", ",", "OM", ",", "GM"}], "]"}]}], 
       ";", "\n", 
       RowBox[{"(*", "**********************)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Maxiimum", " ", "Log"}], "-", 
         RowBox[{"Likelihood", " ", "function"}]}], "*)"}], "\n", 
       RowBox[{
        RowBox[{"mle", "[", 
         RowBox[{
          RowBox[{"PVEC_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"VectorQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", 
          RowBox[{"POP_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"VectorQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "]"}], 
        ":=", 
        RowBox[{
         RowBox[{"POP", ".", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "PVEC"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "POP"}], ")"}], ".", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", 
            RowBox[{"1", "-", "PVEC"}]}], "]"}]}]}]}], ";", "\n", 
       RowBox[{"(*", "*)"}], 
       RowBox[{"(*", 
        RowBox[{"&&", 
         RowBox[{"0", "<", "a0", "\[LessEqual]", "1"}]}], "*)"}], "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"STEPM", "==", "0"}], ",", "\n", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"result1", "=", 
            RowBox[{"NMaximize", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"mle", "[", 
                 RowBox[{
                  RowBox[{"pvecRtv2", "[", 
                   RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}],
                    "]"}], ",", "pop"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"0", "\[LessEqual]", "nt", "\[LessEqual]", "1"}], "&&", 
                 RowBox[{"om", ">", "0"}], "&&", 
                 RowBox[{"gm", ">", "0"}], "&&", 
                 RowBox[{"0", "<", "a0", " ", "\[LessEqual]", "5"}], "&&", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"Tanh", "[", 
                    RowBox[{
                    RowBox[{"5", "a0"}], "-", "2"}], "]"}]}], ")"}], "/", 
                   "2"}], " ", "<", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"Tanh", "[", 
                    RowBox[{
                    RowBox[{"5", "b0"}], "-", "2"}], "]"}]}], ")"}], "/", 
                   "2"}]}], " ", "&&", 
                 RowBox[{"b0", "<", 
                  RowBox[{"2", "-", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"Tanh", "[", 
                    RowBox[{
                    RowBox[{"5", "a0"}], "-", "2"}], "]"}]}], ")"}], "/", 
                    "2"}]}]}]}]}], " ", "}"}], ",", "\n", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"a0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"om", ",", "omi", ",", "omf"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"gm", ",", "gmi", ",", "gmf"}], "}"}]}], "}"}], ",", 
              RowBox[{"Method", "->", "method1"}], ",", 
              RowBox[{"MaxIterations", "->", "mi"}], ",", 
              RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
              RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
           RowBox[{"er1", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
             "}"}], "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
              "}"}], "/.", 
             RowBox[{"Part", "[", 
              RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
           RowBox[{"Print", "[", 
            RowBox[{"{", 
             RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
             "}"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"steps", "=", 
            RowBox[{"11", "/", "10"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"stpointsS2", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "}"}],
                     "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", "ci", 
                    ",", 
                    RowBox[{"Abs", "[", "di", "]"}], ",", 
                    RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "1", ",", 
                    RowBox[{
                    RowBox[{"Dimensions", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "}"}],
                     "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
                "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"stpointsS2", "=", 
              RowBox[{"fSTpointsf", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", "ci", ",", 
                  RowBox[{"Abs", "[", "di", "]"}], ",", 
                  RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], ",", "steps", ",",
                 "method2"}], "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
           "\n", 
           RowBox[{"result2", "=", 
            RowBox[{"FindMaximum", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"mle", "[", 
                RowBox[{
                 RowBox[{"pvecRtv2", "[", 
                  RowBox[{
                   RowBox[{"Abs", "[", "nt", "]"}], ",", 
                   RowBox[{"Abs", "[", "a0", "]"}], ",", 
                   RowBox[{"Abs", "[", "b0", "]"}], ",", 
                   RowBox[{"Abs", "[", "om", "]"}], ",", 
                   RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], 
                "]"}], "}"}], ",", 
              RowBox[{"fSTpointsf", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", "ci", ",", 
                  RowBox[{"Abs", "[", "di", "]"}], ",", 
                  RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], ",", "steps", ",",
                 "method2"}], "]"}], ",", 
              RowBox[{"Method", "->", "method2"}], ",", 
              RowBox[{"MaxIterations", "->", "mi"}], ",", 
              RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
              RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
           RowBox[{"er2", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"af", ",", "bf", ",", "cf", ",", "df", ",", "ef"}], 
             "}"}], "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
              "}"}], "/.", 
             RowBox[{"Part", "[", 
              RowBox[{"result2", ",", "2"}], "]"}]}]}]}], "}"}], ",", "\n", 
         RowBox[{"(*", 
          RowBox[{"Using", " ", "Step", " ", "Monitor", " ", "here"}], "*)"}],
          "\n", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<Step1\>\"", "]"}], ";", "\n", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"result1", "=", 
             RowBox[{"NMaximize", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"mle", "[", 
                  RowBox[{
                   RowBox[{"pvecRtv2", "[", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "]"}],
                    ",", "pop"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"0", "<=", "nt", "<=", "1"}], "&&", 
                  RowBox[{"om", ">", "0"}], "&&", 
                  RowBox[{"gm", ">", "0"}], "&&", 
                  RowBox[{"a0", "<", "8"}]}]}], "}"}], ",", "\n", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"a0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"b0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"om", ",", "omi", ",", "omf"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"gm", ",", "gmi", ",", "gmf"}], "}"}]}], "}"}], ",", 
               RowBox[{"Method", "->", "method1"}], ",", 
               RowBox[{"MaxIterations", "->", "mi"}], ",", 
               RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
               RowBox[{"AccuracyGoal", "->", "ag"}], ",", 
               RowBox[{"StepMonitor", ":>", " ", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<Step points = \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}],
                    "}"}]}], "]"}]}]}], "]"}]}], ";", "\n", 
            RowBox[{"er1", "=", 
             RowBox[{"Part", "[", 
              RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
              "}"}], "=", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
               "}"}], "/.", 
              RowBox[{"Part", "[", 
               RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<Result = \>\"", ",", 
              RowBox[{"{", 
               RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
               "}"}]}], "]"}], ";", "\n", 
            RowBox[{"Print", "[", "\"\<Step2\>\"", "]"}], ";", "\n", 
            RowBox[{"steps", "=", 
             RowBox[{"11", "/", "10"}]}], ";", "\n", "\n", 
            RowBox[{"result2", "=", 
             RowBox[{"FindMaximum", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"mle", "[", 
                 RowBox[{
                  RowBox[{"pvecRtv2", "[", 
                   RowBox[{
                    RowBox[{"Abs", "[", "nt", "]"}], ",", "a0", ",", "b0", 
                    ",", 
                    RowBox[{"Abs", "[", "om", "]"}], ",", 
                    RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], 
                 "]"}], "}"}], ",", 
               RowBox[{"fSTpointsf", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
                  "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", "ci", ",", 
                   RowBox[{"Abs", "[", "di", "]"}], ",", 
                   RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], ",", "steps", 
                 ",", "method2"}], "]"}], ",", 
               RowBox[{"Method", "->", "method2"}], ",", 
               RowBox[{"MaxIterations", "->", "mi"}], ",", 
               RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
               RowBox[{"AccuracyGoal", "->", "ag"}], ",", 
               RowBox[{"StepMonitor", ":>", " ", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<Step points = \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}],
                    "}"}]}], "]"}]}]}], "]"}]}], ";", "\n", 
            RowBox[{"er2", "=", 
             RowBox[{"Part", "[", 
              RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"af", ",", "bf", ",", "cf", ",", "df", ",", "ef"}], 
              "}"}], "=", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
               "}"}], "/.", 
              RowBox[{"Part", "[", 
               RowBox[{"result2", ",", "2"}], "]"}]}]}]}], "}"}]}]}], "\n", 
        "]"}], ";", "\n", 
       RowBox[{"{", 
        RowBox[{
        "af", ",", "bf", ",", "cf", ",", "df", ",", "ef", ",", "er1", ",", 
         "er2"}], "}"}]}]}], "\n", "]"}]}], "\n", "\n"}]}]], "Input",
 CellChangeTimes->{{3.893161528473217*^9, 3.893161667393219*^9}, 
   3.893161725553217*^9, {3.8931624336536465`*^9, 3.8931625039716463`*^9}, 
   3.893162773461666*^9, {3.8931632108632607`*^9, 3.8931632622932477`*^9}, {
   3.8931633061592474`*^9, 3.89316331399925*^9}, {3.8931634418182497`*^9, 
   3.893163466462248*^9}, {3.893163524625763*^9, 3.8931635392677617`*^9}, 
   3.893163575086763*^9, {3.893163626102763*^9, 3.893163632307761*^9}, 
   3.893163699856762*^9, {3.893163786796762*^9, 3.8931638243517613`*^9}, {
   3.8931640537952166`*^9, 3.8931640575012174`*^9}, {3.893164435070443*^9, 
   3.8931644591095057`*^9}, {3.8933169786138544`*^9, 3.893317107861854*^9}, {
   3.8933171625468545`*^9, 3.893317203957853*^9}, {3.8933172491538544`*^9, 
   3.8933174823948545`*^9}, {3.893317669101857*^9, 3.893317746273853*^9}, 
   3.893317897308855*^9, {3.89331825061423*^9, 3.8933182870522413`*^9}, {
   3.89331833111723*^9, 3.8933183375562296`*^9}, {3.8933188166802287`*^9, 
   3.89331884175625*^9}, {3.893318876943228*^9, 3.89331889720923*^9}, {
   3.8933192869002295`*^9, 3.8933192902562294`*^9}, {3.893319342167228*^9, 
   3.8933193693412294`*^9}, {3.8933194875332456`*^9, 
   3.8933194894462285`*^9}, {3.8933198058112297`*^9, 3.89331983969623*^9}, {
   3.8933199304432306`*^9, 3.8933199728482447`*^9}, {3.893320084754238*^9, 
   3.893320090712245*^9}, 3.89332021772423*^9, {3.8933203543432293`*^9, 
   3.89332035828223*^9}, {3.893320458524232*^9, 3.893320507783248*^9}, {
   3.893321459588229*^9, 3.89332151389625*^9}, 3.8933215613482313`*^9, {
   3.8933217455862284`*^9, 3.893321748463228*^9}, {3.8933218033752317`*^9, 
   3.893321846504245*^9}, {3.89332188016623*^9, 3.8933219197082295`*^9}, 
   3.89332237889223*^9, {3.8933251858645144`*^9, 3.8933252214585133`*^9}, {
   3.8933253708295126`*^9, 3.8933253802455287`*^9}, {3.893325460844513*^9, 
   3.893325464854534*^9}, {3.8933254999585395`*^9, 3.893325500275513*^9}, {
   3.8933255315005145`*^9, 3.893325535307535*^9}, 3.8933255728525524`*^9, {
   3.893325691387514*^9, 3.893325728071513*^9}, 3.893325775177514*^9, {
   3.8933258471145144`*^9, 3.893325847842513*^9}, {3.8933259037825155`*^9, 
   3.893325962707515*^9}, {3.8933261283175783`*^9, 3.8933261401815767`*^9}, {
   3.893326177781578*^9, 3.893326182092579*^9}, 3.893326335297579*^9, {
   3.893326369000581*^9, 3.8933263745255785`*^9}},
 CellLabel->
  "In[364]:=",ExpressionUUID->"487d2485-adfd-4b76-bf69-bc384f8d4886"]
}, Closed]],

Cell[CellGroupData[{

Cell["estimatorThermalMLEv9", "Subsection",
 CellChangeTimes->{{3.8933144317643394`*^9, 3.8933144348293495`*^9}, 
   3.8933194838532286`*^9, {3.893929826350217*^9, 
   3.893929826397092*^9}},ExpressionUUID->"4b8dc021-84f8-4ddb-8d76-\
599eeb5b8c65"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Incomplete", ".", " ", "Needs"}], " ", "lots", " ", "of", " ", 
    "work", " ", "yet"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"Clear", "[", "estimatorThermalMLEv9", "]"}], "\n", 
   RowBox[{
    RowBox[{"estimatorThermalMLEv9", "[", 
     RowBox[{
     "POPLIST_", ",", "TLIST_", ",", "NF_", ",", "METHOD1_", ",", "METHOD2_", 
      ",", "IT_", ",", "NTi_", ",", "NTf_", ",", "OMi_", ",", "OMf_", ",", 
      "GMi_", ",", "GMf_", ",", "t0i_", ",", "t0f_", ",", "WP_", ",", "AG_", 
      ",", "STEPM_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"pop", "=", "POPLIST"}], ",", 
        RowBox[{"tvec", "=", "TLIST"}], ",", 
        RowBox[{"method1", "=", "METHOD1"}], ",", 
        RowBox[{"method2", "=", "METHOD2"}], ",", "wSquaredError", ",", 
        "result1", ",", "result2", ",", "\n", "ai", ",", "bi", ",", "ci", ",",
         "af", ",", "bf", ",", "cf", ",", "af2", ",", "bf2", ",", "cf2", ",", 
        "af3", ",", "bf3", ",", "cf3", ",", "\n", "om", ",", "gm", ",", "\n", 
        RowBox[{"omi", "=", "OMi"}], ",", 
        RowBox[{"omf", "=", "OMf"}], ",", 
        RowBox[{"gmi", "=", "GMi"}], ",", 
        RowBox[{"gmf", "=", "GMf"}], ",", "\n", 
        RowBox[{"nti", "=", "NTi"}], ",", 
        RowBox[{"ntf", "=", "NTf"}], ",", "\n", "p0", ",", "omega", ",", 
        "gamma", ",", 
        RowBox[{"mi", "=", "IT"}], ",", 
        RowBox[{"wp", "=", "WP"}], ",", "tpoints", ",", "\n", "NBAR", ",", 
        "\n", 
        RowBox[{"nf", "=", "NF"}], ",", "\n", "er1", ",", "er2", ",", "er3", 
        ",", "\n", "nt", ",", "A0", ",", "a0", ",", "b0", ",", "ei", ",", 
        "ef", ",", "B0", ",", "\n", 
        RowBox[{"ag", "=", "AG"}], ",", "di", ",", "df", ",", "df3", ",", 
        "df2", ",", "\n", "pvect", ",", "pvecRt", ",", "mle", ",", "result3", 
        ",", "methodmark", ",", "result4", ",", "steps", ",", "pvectv2", ",", 
        "pvecRtv2"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"tpoints", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "tvec", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
       RowBox[{"(*", "*)"}], "\n", "\n", "\n", 
       RowBox[{"(*", "*)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{"P_down", 
         RowBox[{"(", "t", ")"}], " ", "Vector", " ", "Function"}], "*)"}], 
       "\n", 
       RowBox[{
        RowBox[{"pvect", "[", 
         RowBox[{"NT_", ",", "A0_", ",", "B0", ",", "OM_", ",", "GM_"}], 
         "]"}], ":=", 
        RowBox[{"pDowntMod4", "[", 
         RowBox[{
         "0", ",", "0", ",", "NT", ",", "0", ",", "A0", ",", "B0", ",", 
          "tvec", ",", "nf", ",", "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"pvecRt", "[", 
         RowBox[{
          RowBox[{"NT_", "?", "NumericQ"}], ",", 
          RowBox[{"A0_", "?", "NumericQ"}], ",", 
          RowBox[{"B0_", "?", "NumericQ"}], ",", 
          RowBox[{"OM_", "?", "NumericQ"}], ",", 
          RowBox[{"GM_", "?", "NumericQ"}]}], "]"}], ":=", 
        RowBox[{"pvect", "[", 
         RowBox[{"NT", ",", "A0", ",", "B0", ",", "OM", ",", "GM"}], "]"}]}], 
       ";", "\n", 
       RowBox[{"(*", 
        RowBox[{"Testing", " ", "a", " ", "mod", " ", "for", " ", "A0"}], 
        "*)"}], "\n", 
       RowBox[{
        RowBox[{"pvectv2", "[", 
         RowBox[{"NT_", ",", "A0_", ",", "B0_", ",", "OM_", ",", "GM_"}], 
         "]"}], ":=", 
        RowBox[{"pDowntMod4", "[", 
         RowBox[{
         "0", ",", "0", ",", "NT", ",", "0", ",", "A0", ",", "B0", ",", 
          "tvec", ",", "nf", ",", "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"pvecRtv2", "[", 
         RowBox[{
          RowBox[{"NT_", "?", "NumericQ"}], ",", 
          RowBox[{"A0_", "?", "NumericQ"}], ",", 
          RowBox[{"B0_", "?", "NumericQ"}], ",", 
          RowBox[{"OM_", "?", "NumericQ"}], ",", 
          RowBox[{"GM_", "?", "NumericQ"}]}], "]"}], ":=", 
        RowBox[{"pvectv2", "[", 
         RowBox[{"NT", ",", "A0", ",", "B0", ",", "OM", ",", "GM"}], "]"}]}], 
       ";", "\n", 
       RowBox[{"(*", "**********************)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Maxiimum", " ", "Log"}], "-", 
         RowBox[{"Likelihood", " ", "function"}]}], "*)"}], "\n", 
       RowBox[{
        RowBox[{"mle", "[", 
         RowBox[{
          RowBox[{"PVEC_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"VectorQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", 
          RowBox[{"POP_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"VectorQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "]"}], 
        ":=", 
        RowBox[{
         RowBox[{"POP", ".", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "PVEC"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "POP"}], ")"}], ".", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", 
            RowBox[{"1", "-", "PVEC"}]}], "]"}]}]}]}], ";", "\n", 
       RowBox[{"(*", "*)"}], 
       RowBox[{"(*", 
        RowBox[{"&&", 
         RowBox[{"0", "<", "a0", "\[LessEqual]", "1"}]}], "*)"}], "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"STEPM", "==", "0"}], ",", "\n", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"result1", "=", 
            RowBox[{"NMaximize", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"mle", "[", 
                 RowBox[{
                  RowBox[{"pvecRtv2", "[", 
                   RowBox[{
                    RowBox[{"Abs", "[", "nt", "]"}], ",", 
                    RowBox[{"Abs", "[", "a0", "]"}], ",", 
                    RowBox[{"Abs", "[", "b0", "]"}], ",", "om", ",", "gm"}], 
                   "]"}], ",", "pop"}], "]"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "1"}], "\[LessEqual]", "nt", "\[LessEqual]", 
                  "1"}], "&&", 
                 RowBox[{"om", ">", "0"}], "&&", 
                 RowBox[{"gm", ">", "0"}], "&&", 
                 RowBox[{
                  RowBox[{"Abs", "[", "a0", "]"}], "<", "0.05"}], "&&", 
                 RowBox[{
                  RowBox[{"Abs", "[", "b0", "]"}], "<", "0.05"}]}]}], 
               RowBox[{"(*", 
                RowBox[{"&&", 
                 RowBox[{"a0", "\[GreaterEqual]", "0"}], "&&", 
                 RowBox[{"b0", "\[GreaterEqual]", "0"}]}], "*)"}], "}"}], ",",
               "\n", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"a0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"om", ",", "omi", ",", "omf"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"gm", ",", "gmi", ",", "gmf"}], "}"}]}], "}"}], ",", 
              RowBox[{"Method", "->", "method1"}], ",", 
              RowBox[{"MaxIterations", "->", "mi"}], ",", 
              RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
              RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
           RowBox[{"er1", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
             "}"}], "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
              "}"}], "/.", 
             RowBox[{"Part", "[", 
              RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
           RowBox[{"Print", "[", 
            RowBox[{"{", 
             RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
             "}"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"steps", "=", 
            RowBox[{"11", "/", "10"}]}], ";", "\n", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"stpointsS2", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "}"}],
                     "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", "ci", 
                    ",", 
                    RowBox[{"Abs", "[", "di", "]"}], ",", 
                    RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "1", ",", 
                    RowBox[{
                    RowBox[{"Dimensions", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "}"}],
                     "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
                "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"stpointsS2", "=", 
              RowBox[{"fSTpointsf", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", "ci", ",", 
                  RowBox[{"Abs", "[", "di", "]"}], ",", 
                  RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], ",", "steps", ",",
                 "method2"}], "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"result2", "=", 
            RowBox[{"FindMaximum", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"mle", "[", 
                RowBox[{
                 RowBox[{"pvecRtv2", "[", 
                  RowBox[{
                   RowBox[{"Abs", "[", "nt", "]"}], ",", "a0", ",", "b0", ",", 
                   RowBox[{"Abs", "[", "om", "]"}], ",", 
                   RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], 
                "]"}], "}"}], ",", 
              RowBox[{"fSTpointsf", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Abs", "[", "ai", "]"}], ",", 
                  RowBox[{"Abs", "[", "bi", "]"}], ",", 
                  RowBox[{"Abs", "[", "ci", "]"}], ",", 
                  RowBox[{"Abs", "[", "di", "]"}], ",", 
                  RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], ",", "steps", ",",
                 "method2"}], "]"}], ",", 
              RowBox[{"Method", "->", "method2"}], ",", 
              RowBox[{"MaxIterations", "->", "mi"}], ",", 
              RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
              RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
           "\n", 
           RowBox[{"er2", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"af", ",", "bf", ",", "cf", ",", "df", ",", "ef"}], 
             "}"}], "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
              "}"}], "/.", 
             RowBox[{"Part", "[", 
              RowBox[{"result2", ",", "2"}], "]"}]}]}]}], "}"}], ",", "\n", 
         RowBox[{"(*", 
          RowBox[{"Using", " ", "Step", " ", "Monitor", " ", "here"}], "*)"}],
          "\n", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<Step1\>\"", "]"}], ";", "\n", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"result1", "=", 
             RowBox[{"NMaximize", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"mle", "[", 
                  RowBox[{
                   RowBox[{"pvecRtv2", "[", 
                    RowBox[{
                    RowBox[{"Abs", "[", "nt", "]"}], ",", "a0", ",", "b0", 
                    ",", "om", ",", "gm"}], "]"}], ",", "pop"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "1"}], "\[LessEqual]", "nt", "\[LessEqual]", 
                   "1"}], "&&", 
                  RowBox[{"om", ">", "0"}], "&&", 
                  RowBox[{"gm", ">", "0"}], "&&", 
                  RowBox[{"a0", "\[GreaterEqual]", "0"}], "&&", 
                  RowBox[{"b0", "\[GreaterEqual]", "0"}]}]}], "}"}], ",", 
               "\n", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"a0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"b0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"om", ",", "omi", ",", "omf"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"gm", ",", "gmi", ",", "gmf"}], "}"}]}], "}"}], ",", 
               RowBox[{"Method", "->", "method1"}], ",", 
               RowBox[{"MaxIterations", "->", "mi"}], ",", 
               RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
               RowBox[{"AccuracyGoal", "->", "ag"}], ",", 
               RowBox[{"StepMonitor", ":>", " ", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<Step points = \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{
                   "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm", ",", 
                    RowBox[{"mle", "[", 
                    RowBox[{
                    RowBox[{"pvecRtv2", "[", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "]"}],
                     ",", "pop"}], "]"}]}], "}"}]}], "]"}]}]}], "]"}]}], ";", 
            "\n", 
            RowBox[{"er1", "=", 
             RowBox[{"Part", "[", 
              RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
              "}"}], "=", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
               "}"}], "/.", 
              RowBox[{"Part", "[", 
               RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<Result = \>\"", ",", 
              RowBox[{"{", 
               RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
               "}"}]}], "]"}], ";", "\n", 
            RowBox[{"Print", "[", "\"\<Step2\>\"", "]"}], ";", "\n", 
            RowBox[{"steps", "=", 
             RowBox[{"11", "/", "10"}]}], ";", "\n", "\n", 
            RowBox[{"result2", "=", 
             RowBox[{"FindMaximum", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"mle", "[", 
                 RowBox[{
                  RowBox[{"pvecRtv2", "[", 
                   RowBox[{
                    RowBox[{"Abs", "[", "nt", "]"}], ",", "a0", ",", 
                    RowBox[{"Abs", "[", "b0", "]"}], ",", 
                    RowBox[{"Abs", "[", "om", "]"}], ",", 
                    RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], 
                 "]"}], "}"}], ",", 
               RowBox[{"fSTpointsf", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
                  "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Abs", "[", "ai", "]"}], ",", 
                   RowBox[{"Abs", "[", "bi", "]"}], ",", 
                   RowBox[{"Abs", "[", "ci", "]"}], ",", 
                   RowBox[{"Abs", "[", "di", "]"}], ",", 
                   RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], ",", "steps", 
                 ",", "method2"}], "]"}], ",", 
               RowBox[{"Method", "->", "method2"}], ",", 
               RowBox[{"MaxIterations", "->", "mi"}], ",", 
               RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
               RowBox[{"AccuracyGoal", "->", "ag"}], ",", 
               RowBox[{"StepMonitor", ":>", " ", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<Step points = \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{
                   "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm", ",", 
                    RowBox[{"mle", "[", 
                    RowBox[{
                    RowBox[{"pvecRtv2", "[", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "]"}],
                     ",", "pop"}], "]"}]}], "}"}]}], "]"}]}]}], "]"}]}], ";", 
            "\n", 
            RowBox[{"er2", "=", 
             RowBox[{"Part", "[", 
              RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"af", ",", "bf", ",", "cf", ",", "df", ",", "ef"}], 
              "}"}], "=", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
               "}"}], "/.", 
              RowBox[{"Part", "[", 
               RowBox[{"result2", ",", "2"}], "]"}]}]}]}], "}"}]}]}], "\n", 
        "]"}], ";", "\n", 
       RowBox[{"{", 
        RowBox[{
        "af", ",", "bf", ",", "cf", ",", "df", ",", "ef", ",", "er1", ",", 
         "er2"}], "}"}]}]}], "\n", "]"}]}], "\n", "\n"}]}]], "Input",
 CellChangeTimes->{{3.893161528473217*^9, 3.893161667393219*^9}, 
   3.893161725553217*^9, {3.8931624336536465`*^9, 3.8931625039716463`*^9}, 
   3.893162773461666*^9, {3.8931632108632607`*^9, 3.8931632622932477`*^9}, {
   3.8931633061592474`*^9, 3.89316331399925*^9}, {3.8931634418182497`*^9, 
   3.893163466462248*^9}, {3.893163524625763*^9, 3.8931635392677617`*^9}, 
   3.893163575086763*^9, {3.893163626102763*^9, 3.893163632307761*^9}, 
   3.893163699856762*^9, {3.893163786796762*^9, 3.8931638243517613`*^9}, {
   3.8931640537952166`*^9, 3.8931640575012174`*^9}, {3.893164435070443*^9, 
   3.8931644591095057`*^9}, {3.8933169786138544`*^9, 3.893317107861854*^9}, {
   3.8933171625468545`*^9, 3.893317203957853*^9}, {3.8933172491538544`*^9, 
   3.8933174823948545`*^9}, {3.893317669101857*^9, 3.893317746273853*^9}, 
   3.893317897308855*^9, {3.89331825061423*^9, 3.8933182870522413`*^9}, {
   3.89331833111723*^9, 3.8933183375562296`*^9}, {3.8933188166802287`*^9, 
   3.89331884175625*^9}, {3.893318876943228*^9, 3.89331889720923*^9}, {
   3.8933192869002295`*^9, 3.8933192902562294`*^9}, {3.893319342167228*^9, 
   3.8933193693412294`*^9}, {3.8933194875332456`*^9, 
   3.8933194894462285`*^9}, {3.8933198058112297`*^9, 3.89331983969623*^9}, {
   3.8933199304432306`*^9, 3.8933199728482447`*^9}, {3.893320084754238*^9, 
   3.893320090712245*^9}, 3.89332021772423*^9, {3.8933203543432293`*^9, 
   3.89332035828223*^9}, {3.893320458524232*^9, 3.893320507783248*^9}, {
   3.893321459588229*^9, 3.89332151389625*^9}, 3.8933215613482313`*^9, {
   3.8933217455862284`*^9, 3.893321748463228*^9}, {3.8933218033752317`*^9, 
   3.893321846504245*^9}, {3.89332188016623*^9, 3.8933219197082295`*^9}, 
   3.89332237889223*^9, {3.8933251858645144`*^9, 3.8933252214585133`*^9}, {
   3.8933253708295126`*^9, 3.8933253802455287`*^9}, {3.893325460844513*^9, 
   3.893325464854534*^9}, {3.8933254999585395`*^9, 3.893325500275513*^9}, {
   3.8933255315005145`*^9, 3.893325535307535*^9}, 3.8933255728525524`*^9, {
   3.893325691387514*^9, 3.893325728071513*^9}, 3.893325775177514*^9, {
   3.8933258471145144`*^9, 3.893325847842513*^9}, {3.8933259037825155`*^9, 
   3.893325962707515*^9}, {3.8933261283175783`*^9, 3.8933261401815767`*^9}, {
   3.893326177781578*^9, 3.893326182092579*^9}, 3.893326335297579*^9, {
   3.893326369000581*^9, 3.8933263745255785`*^9}, {3.8939298326781244`*^9, 
   3.8939299048045945`*^9}, {3.893929942260688*^9, 3.8939299633459682`*^9}, {
   3.8939304171183662`*^9, 3.893930463479401*^9}, {3.89393053463518*^9, 
   3.893930537838193*^9}, {3.8939308679544897`*^9, 3.8939308892478595`*^9}, {
   3.8939317789520807`*^9, 3.893931800138111*^9}, {3.8939319131250963`*^9, 
   3.8939319783139267`*^9}, {3.893932168160508*^9, 3.89393221196815*^9}, {
   3.893932321363877*^9, 3.8939323284659147`*^9}, {3.8943536206255016`*^9, 
   3.8943536340875125`*^9}, {3.894353761193982*^9, 3.8943538005517826`*^9}, {
   3.894355351225137*^9, 3.894355359064782*^9}, {3.8943554356631813`*^9, 
   3.894355454814376*^9}, {3.8943554932450066`*^9, 3.8943554990561666`*^9}, {
   3.8943556246286783`*^9, 3.8943556464127984`*^9}, {3.8943565809117155`*^9, 
   3.89435659474646*^9}, {3.8943566382609625`*^9, 3.8943566471530294`*^9}, {
   3.894357391909689*^9, 3.8943574596818857`*^9}, {3.895929287177478*^9, 
   3.8959293195361614`*^9}},
 CellLabel->
  "In[366]:=",ExpressionUUID->"a42504a1-d89c-44d8-a4fb-dcb247f29a39"]
}, Closed]],

Cell[CellGroupData[{

Cell["estimatorThermalMLEv10", "Subsection",
 CellChangeTimes->{{3.8933144317643394`*^9, 3.8933144348293495`*^9}, 
   3.8933194838532286`*^9, {3.893929826350217*^9, 3.893929826397092*^9}, {
   3.8945339524761953`*^9, 
   3.8945339530585685`*^9}},ExpressionUUID->"0bc4ac02-035c-42c6-9b1f-\
0502c58906cf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Incomplete", ".", " ", "Needs"}], " ", "lots", " ", "of", " ", 
    "work", " ", "yet"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{"Clear", "[", "estimatorThermalMLEv10", "]"}], "\n", 
   RowBox[{
    RowBox[{"estimatorThermalMLEv10", "[", 
     RowBox[{
     "POPLIST_", ",", "TLIST_", ",", "NF_", ",", "METHOD1_", ",", "METHOD2_", 
      ",", "IT_", ",", "NTi_", ",", "NTf_", ",", "OMi_", ",", "OMf_", ",", 
      "GMi_", ",", "GMf_", ",", "t0i_", ",", "t0f_", ",", "WP_", ",", "AG_", 
      ",", "STEPM_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"pop", "=", "POPLIST"}], ",", 
        RowBox[{"tvec", "=", "TLIST"}], ",", 
        RowBox[{"method1", "=", "METHOD1"}], ",", 
        RowBox[{"method2", "=", "METHOD2"}], ",", "wSquaredError", ",", 
        "result1", ",", "result2", ",", "\n", "ai", ",", "bi", ",", "ci", ",",
         "af", ",", "bf", ",", "cf", ",", "af2", ",", "bf2", ",", "cf2", ",", 
        "af3", ",", "bf3", ",", "cf3", ",", "\n", "om", ",", "gm", ",", "\n", 
        RowBox[{"omi", "=", "OMi"}], ",", 
        RowBox[{"omf", "=", "OMf"}], ",", 
        RowBox[{"gmi", "=", "GMi"}], ",", 
        RowBox[{"gmf", "=", "GMf"}], ",", "\n", 
        RowBox[{"nti", "=", "NTi"}], ",", 
        RowBox[{"ntf", "=", "NTf"}], ",", "\n", "p0", ",", "omega", ",", 
        "gamma", ",", 
        RowBox[{"mi", "=", "IT"}], ",", 
        RowBox[{"wp", "=", "WP"}], ",", "tpoints", ",", "\n", "NBAR", ",", 
        "\n", 
        RowBox[{"nf", "=", "NF"}], ",", "\n", "er1", ",", "er2", ",", "er3", 
        ",", "\n", "nt", ",", "A0", ",", "a0", ",", "b0", ",", "ei", ",", 
        "ef", ",", "B0", ",", "\n", 
        RowBox[{"ag", "=", "AG"}], ",", "di", ",", "df", ",", "df3", ",", 
        "df2", ",", "\n", "pvect", ",", "pvecRt", ",", "mle", ",", "result3", 
        ",", "methodmark", ",", "result4", ",", "steps", ",", "pvectv2", ",", 
        "pvecRtv2"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"tpoints", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "tvec", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
       RowBox[{"(*", "*)"}], "\n", "\n", "\n", 
       RowBox[{"(*", "*)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{"P_down", 
         RowBox[{"(", "t", ")"}], " ", "Vector", " ", "Function"}], "*)"}], 
       "\n", 
       RowBox[{
        RowBox[{"pvect", "[", 
         RowBox[{"NT_", ",", "A0_", ",", "B0", ",", "OM_", ",", "GM_"}], 
         "]"}], ":=", 
        RowBox[{"pDowntMod4", "[", 
         RowBox[{
         "0", ",", "0", ",", "NT", ",", "0", ",", "A0", ",", "B0", ",", 
          "tvec", ",", "nf", ",", "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"pvecRt", "[", 
         RowBox[{
          RowBox[{"NT_", "?", "NumericQ"}], ",", 
          RowBox[{"A0_", "?", "NumericQ"}], ",", 
          RowBox[{"B0_", "?", "NumericQ"}], ",", 
          RowBox[{"OM_", "?", "NumericQ"}], ",", 
          RowBox[{"GM_", "?", "NumericQ"}]}], "]"}], ":=", 
        RowBox[{"pvect", "[", 
         RowBox[{"NT", ",", "A0", ",", "B0", ",", "OM", ",", "GM"}], "]"}]}], 
       ";", "\n", 
       RowBox[{"(*", 
        RowBox[{"Testing", " ", "a", " ", "mod", " ", "for", " ", "A0"}], 
        "*)"}], "\n", 
       RowBox[{
        RowBox[{"pvectv2", "[", 
         RowBox[{"NT_", ",", "A0_", ",", "B0_", ",", "OM_", ",", "GM_"}], 
         "]"}], ":=", 
        RowBox[{"pDowntMod4", "[", 
         RowBox[{
         "0", ",", "0", ",", "NT", ",", "0", ",", "A0", ",", "B0", ",", 
          "tvec", ",", "nf", ",", "OM", ",", "GM"}], "]"}]}], ";", "\n", 
       RowBox[{
        RowBox[{"pvecRtv2", "[", 
         RowBox[{
          RowBox[{"NT_", "?", "NumericQ"}], ",", 
          RowBox[{"A0_", "?", "NumericQ"}], ",", 
          RowBox[{"B0_", "?", "NumericQ"}], ",", 
          RowBox[{"OM_", "?", "NumericQ"}], ",", 
          RowBox[{"GM_", "?", "NumericQ"}]}], "]"}], ":=", 
        RowBox[{"pvectv2", "[", 
         RowBox[{"NT", ",", "A0", ",", "B0", ",", "OM", ",", "GM"}], "]"}]}], 
       ";", "\n", 
       RowBox[{"(*", "**********************)"}], "\n", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Maxiimum", " ", "Log"}], "-", 
         RowBox[{"Likelihood", " ", "function"}]}], "*)"}], "\n", 
       RowBox[{
        RowBox[{"mle", "[", 
         RowBox[{
          RowBox[{"PVEC_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"VectorQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}], ",", 
          RowBox[{"POP_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"VectorQ", "[", 
              RowBox[{"#", ",", "NumericQ"}], "]"}], "&"}], ")"}]}]}], "]"}], 
        ":=", 
        RowBox[{
         RowBox[{"POP", ".", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", "PVEC"}], "]"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "POP"}], ")"}], ".", 
          RowBox[{"Log", "[", 
           RowBox[{"10", ",", 
            RowBox[{"1", "-", "PVEC"}]}], "]"}]}]}]}], ";", "\n", 
       RowBox[{"(*", "*)"}], 
       RowBox[{"(*", 
        RowBox[{"&&", 
         RowBox[{"0", "<", "a0", "\[LessEqual]", "1"}]}], "*)"}], "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"STEPM", "==", "0"}], ",", "\[IndentingNewLine]", "\n", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"result1", "=", 
            RowBox[{"NMaximize", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"mle", "[", 
                 RowBox[{
                  RowBox[{"pvecRtv2", "[", 
                   RowBox[{
                    RowBox[{"Abs", "[", "nt", "]"}], ",", 
                    RowBox[{"Abs", "[", "a0", "]"}], ",", 
                    RowBox[{"Abs", "[", "b0", "]"}], ",", "om", ",", "gm"}], 
                   "]"}], ",", "pop"}], "]"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "1"}], "\[LessEqual]", "nt", "\[LessEqual]", 
                  "1"}], "&&", 
                 RowBox[{"om", ">", "0"}], "&&", 
                 RowBox[{"gm", ">", "0"}], "&&", 
                 RowBox[{
                  RowBox[{"Abs", "[", "a0", "]"}], "<", "0.05"}], "&&", 
                 RowBox[{
                  RowBox[{"Abs", "[", "b0", "]"}], "<", "0.05"}]}]}], 
               RowBox[{"(*", 
                RowBox[{"&&", 
                 RowBox[{"a0", "\[GreaterEqual]", "0"}], "&&", 
                 RowBox[{"b0", "\[GreaterEqual]", "0"}]}], "*)"}], "}"}], ",",
               "\n", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"a0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"om", ",", "omi", ",", "omf"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"gm", ",", "gmi", ",", "gmf"}], "}"}]}], "}"}], ",", 
              RowBox[{"Method", "->", "method1"}], ",", 
              RowBox[{"MaxIterations", "->", "mi"}], ",", 
              RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
              RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
           RowBox[{"er1", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
             "}"}], "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
              "}"}], "/.", 
             RowBox[{"Part", "[", 
              RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
           RowBox[{"Print", "[", 
            RowBox[{"{", 
             RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
             "}"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"steps", "=", 
            RowBox[{"11", "/", "10"}]}], ";", "\n", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"stpointsS2", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "}"}],
                     "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", "ci", 
                    ",", 
                    RowBox[{"Abs", "[", "di", "]"}], ",", 
                    RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "1", ",", 
                    RowBox[{
                    RowBox[{"Dimensions", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "}"}],
                     "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
                "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"stpointsS2", "=", 
              RowBox[{"fSTpointsf", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Abs", "[", "ai", "]"}], ",", "bi", ",", "ci", ",", 
                  RowBox[{"Abs", "[", "di", "]"}], ",", 
                  RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], ",", "steps", ",",
                 "method2"}], "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"result2", "=", 
            RowBox[{"FindMaximum", "[", 
             RowBox[{
              RowBox[{"mle", "[", 
               RowBox[{
                RowBox[{"pvecRtv2", "[", 
                 RowBox[{
                  RowBox[{"Abs", "[", "nt", "]"}], ",", 
                  RowBox[{"Abs", "[", "a0", "]"}], ",", 
                  RowBox[{"Abs", "[", "b0", "]"}], ",", 
                  RowBox[{"Abs", "[", "om", "]"}], ",", 
                  RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], 
               "]"}], ",", 
              RowBox[{"fSTpointsf", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Abs", "[", "ai", "]"}], ",", 
                  RowBox[{"Abs", "[", "bi", "]"}], ",", 
                  RowBox[{"Abs", "[", "ci", "]"}], ",", 
                  RowBox[{"Abs", "[", "di", "]"}], ",", 
                  RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], ",", "steps", ",",
                 "method2"}], "]"}], ",", 
              RowBox[{"Method", "->", "method2"}], ",", 
              RowBox[{"MaxIterations", "->", "mi"}], ",", 
              RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
              RowBox[{"AccuracyGoal", "->", "ag"}]}], "]"}]}], ";", "\n", 
           "\n", 
           RowBox[{"er2", "=", 
            RowBox[{"Part", "[", 
             RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"af", ",", "bf", ",", "cf", ",", "df", ",", "ef"}], 
             "}"}], "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
              "}"}], "/.", 
             RowBox[{"Part", "[", 
              RowBox[{"result2", ",", "2"}], "]"}]}]}]}], "}"}], ",", "\n", 
         RowBox[{"(*", 
          RowBox[{"Using", " ", "Step", " ", "Monitor", " ", "here"}], "*)"}],
          "\n", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<Step1\>\"", "]"}], ";", "\n", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"result1", "=", 
             RowBox[{"NMaximize", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"mle", "[", 
                  RowBox[{
                   RowBox[{"pvecRtv2", "[", 
                    RowBox[{
                    RowBox[{"Abs", "[", "nt", "]"}], ",", "a0", ",", "b0", 
                    ",", "om", ",", "gm"}], "]"}], ",", "pop"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "1"}], "\[LessEqual]", "nt", "\[LessEqual]", 
                   "1"}], "&&", 
                  RowBox[{"om", ">", "0"}], "&&", 
                  RowBox[{"gm", ">", "0"}], "&&", 
                  RowBox[{"a0", "\[GreaterEqual]", "0"}], "&&", 
                  RowBox[{"b0", "\[GreaterEqual]", "0"}]}]}], "}"}], ",", 
               "\n", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"nt", ",", "nti", ",", "ntf"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"a0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"b0", ",", "t0i", ",", "t0f"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"om", ",", "omi", ",", "omf"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"gm", ",", "gmi", ",", "gmf"}], "}"}]}], "}"}], ",", 
               RowBox[{"Method", "->", "method1"}], ",", 
               RowBox[{"MaxIterations", "->", "mi"}], ",", 
               RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
               RowBox[{"AccuracyGoal", "->", "ag"}], ",", 
               RowBox[{"StepMonitor", ":>", " ", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<Step points = \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{
                   "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm", ",", 
                    RowBox[{"mle", "[", 
                    RowBox[{
                    RowBox[{"pvecRtv2", "[", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "]"}],
                     ",", "pop"}], "]"}]}], "}"}]}], "]"}]}]}], "]"}]}], ";", 
            "\n", 
            RowBox[{"er1", "=", 
             RowBox[{"Part", "[", 
              RowBox[{"result1", ",", "1"}], "]"}]}], ";", "\n", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
              "}"}], "=", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
               "}"}], "/.", 
              RowBox[{"Part", "[", 
               RowBox[{"result1", ",", "2"}], "]"}]}]}], ";", "\n", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<Result = \>\"", ",", 
              RowBox[{"{", 
               RowBox[{"ai", ",", "bi", ",", "ci", ",", "di", ",", "ei"}], 
               "}"}]}], "]"}], ";", "\n", 
            RowBox[{"Print", "[", "\"\<Step2\>\"", "]"}], ";", "\n", 
            RowBox[{"steps", "=", 
             RowBox[{"11", "/", "10"}]}], ";", "\n", "\n", 
            RowBox[{"result2", "=", 
             RowBox[{"FindMaximum", "[", 
              RowBox[{
               RowBox[{"mle", "[", 
                RowBox[{
                 RowBox[{"pvecRtv2", "[", 
                  RowBox[{
                   RowBox[{"Abs", "[", "nt", "]"}], ",", 
                   RowBox[{"Abs", "[", "a0", "]"}], ",", 
                   RowBox[{"Abs", "[", "b0", "]"}], ",", 
                   RowBox[{"Abs", "[", "om", "]"}], ",", 
                   RowBox[{"Abs", "[", "gm", "]"}]}], "]"}], ",", "pop"}], 
                "]"}], ",", 
               RowBox[{"fSTpointsf", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
                  "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Abs", "[", "ai", "]"}], ",", 
                   RowBox[{"Abs", "[", "bi", "]"}], ",", 
                   RowBox[{"Abs", "[", "ci", "]"}], ",", 
                   RowBox[{"Abs", "[", "di", "]"}], ",", 
                   RowBox[{"Abs", "[", "ei", "]"}]}], "}"}], ",", "steps", 
                 ",", "method2"}], "]"}], ",", 
               RowBox[{"Method", "->", "method2"}], ",", 
               RowBox[{"MaxIterations", "->", "mi"}], ",", 
               RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
               RowBox[{"AccuracyGoal", "->", "ag"}], ",", 
               RowBox[{"StepMonitor", ":>", " ", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<Step points = \>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{
                   "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm", ",", 
                    RowBox[{"mle", "[", 
                    RowBox[{
                    RowBox[{"pvecRtv2", "[", 
                    RowBox[{
                    "nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], "]"}],
                     ",", "pop"}], "]"}]}], "}"}]}], "]"}]}]}], "]"}]}], ";", 
            "\n", 
            RowBox[{"er2", "=", 
             RowBox[{"Part", "[", 
              RowBox[{"result2", ",", "1"}], "]"}]}], ";", "\n", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"af", ",", "bf", ",", "cf", ",", "df", ",", "ef"}], 
              "}"}], "=", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"nt", ",", "a0", ",", "b0", ",", "om", ",", "gm"}], 
               "}"}], "/.", 
              RowBox[{"Part", "[", 
               RowBox[{"result2", ",", "2"}], "]"}]}]}]}], "}"}]}]}], "\n", 
        "]"}], ";", "\n", 
       RowBox[{"{", 
        RowBox[{
        "af", ",", "bf", ",", "cf", ",", "df", ",", "ef", ",", "er1", ",", 
         "er2"}], "}"}]}]}], "\n", "]"}]}], "\n", "\n"}]}]], "Input",
 CellChangeTimes->{{3.893161528473217*^9, 3.893161667393219*^9}, 
   3.893161725553217*^9, {3.8931624336536465`*^9, 3.8931625039716463`*^9}, 
   3.893162773461666*^9, {3.8931632108632607`*^9, 3.8931632622932477`*^9}, {
   3.8931633061592474`*^9, 3.89316331399925*^9}, {3.8931634418182497`*^9, 
   3.893163466462248*^9}, {3.893163524625763*^9, 3.8931635392677617`*^9}, 
   3.893163575086763*^9, {3.893163626102763*^9, 3.893163632307761*^9}, 
   3.893163699856762*^9, {3.893163786796762*^9, 3.8931638243517613`*^9}, {
   3.8931640537952166`*^9, 3.8931640575012174`*^9}, {3.893164435070443*^9, 
   3.8931644591095057`*^9}, {3.8933169786138544`*^9, 3.893317107861854*^9}, {
   3.8933171625468545`*^9, 3.893317203957853*^9}, {3.8933172491538544`*^9, 
   3.8933174823948545`*^9}, {3.893317669101857*^9, 3.893317746273853*^9}, 
   3.893317897308855*^9, {3.89331825061423*^9, 3.8933182870522413`*^9}, {
   3.89331833111723*^9, 3.8933183375562296`*^9}, {3.8933188166802287`*^9, 
   3.89331884175625*^9}, {3.893318876943228*^9, 3.89331889720923*^9}, {
   3.8933192869002295`*^9, 3.8933192902562294`*^9}, {3.893319342167228*^9, 
   3.8933193693412294`*^9}, {3.8933194875332456`*^9, 
   3.8933194894462285`*^9}, {3.8933198058112297`*^9, 3.89331983969623*^9}, {
   3.8933199304432306`*^9, 3.8933199728482447`*^9}, {3.893320084754238*^9, 
   3.893320090712245*^9}, 3.89332021772423*^9, {3.8933203543432293`*^9, 
   3.89332035828223*^9}, {3.893320458524232*^9, 3.893320507783248*^9}, {
   3.893321459588229*^9, 3.89332151389625*^9}, 3.8933215613482313`*^9, {
   3.8933217455862284`*^9, 3.893321748463228*^9}, {3.8933218033752317`*^9, 
   3.893321846504245*^9}, {3.89332188016623*^9, 3.8933219197082295`*^9}, 
   3.89332237889223*^9, {3.8933251858645144`*^9, 3.8933252214585133`*^9}, {
   3.8933253708295126`*^9, 3.8933253802455287`*^9}, {3.893325460844513*^9, 
   3.893325464854534*^9}, {3.8933254999585395`*^9, 3.893325500275513*^9}, {
   3.8933255315005145`*^9, 3.893325535307535*^9}, 3.8933255728525524`*^9, {
   3.893325691387514*^9, 3.893325728071513*^9}, 3.893325775177514*^9, {
   3.8933258471145144`*^9, 3.893325847842513*^9}, {3.8933259037825155`*^9, 
   3.893325962707515*^9}, {3.8933261283175783`*^9, 3.8933261401815767`*^9}, {
   3.893326177781578*^9, 3.893326182092579*^9}, 3.893326335297579*^9, {
   3.893326369000581*^9, 3.8933263745255785`*^9}, {3.8939298326781244`*^9, 
   3.8939299048045945`*^9}, {3.893929942260688*^9, 3.8939299633459682`*^9}, {
   3.8939304171183662`*^9, 3.893930463479401*^9}, {3.89393053463518*^9, 
   3.893930537838193*^9}, {3.8939308679544897`*^9, 3.8939308892478595`*^9}, {
   3.8939317789520807`*^9, 3.893931800138111*^9}, {3.8939319131250963`*^9, 
   3.8939319783139267`*^9}, {3.893932168160508*^9, 3.89393221196815*^9}, {
   3.893932321363877*^9, 3.8939323284659147`*^9}, {3.8943536206255016`*^9, 
   3.8943536340875125`*^9}, {3.894353761193982*^9, 3.8943538005517826`*^9}, {
   3.894355351225137*^9, 3.894355359064782*^9}, {3.8943554356631813`*^9, 
   3.894355454814376*^9}, {3.8943554932450066`*^9, 3.8943554990561666`*^9}, {
   3.8943556246286783`*^9, 3.8943556464127984`*^9}, {3.8943565809117155`*^9, 
   3.89435659474646*^9}, {3.8943566382609625`*^9, 3.8943566471530294`*^9}, {
   3.894357391909689*^9, 3.8943574596818857`*^9}, {3.894533957217385*^9, 
   3.894533961187542*^9}, {3.8945347519473643`*^9, 3.894534762239546*^9}, {
   3.894535063079174*^9, 3.8945350841182065`*^9}, {3.8959586264324055`*^9, 
   3.895958631243646*^9}, {3.895959275829696*^9, 3.8959592787667503`*^9}, 
   3.8959593284848137`*^9, {3.895959388959377*^9, 3.8959594176693068`*^9}, {
   3.897560020754464*^9, 
   3.8975600212304916`*^9}},ExpressionUUID->"86366245-136a-4d9b-82aa-\
895c2776b050"]
}, Closed]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "fSTpointsf", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"fSTpointsf", "[", 
    RowBox[{"VARVEC_", ",", "PTVEC_", ",", "STEP_", ",", "METHOD_"}], "]"}], ":=",
    "\n", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"METHOD", "==", "\"\<PrincipalAxis\>\""}], ",", "\n", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Table", "[", "\n", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"i", "==", "2"}], ",", "\n", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Ceiling", "[", 
               RowBox[{"PTVEC", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], "==", "8"}], ",", 
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"VARVEC", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", "1", ",", "0"}], "}"}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"VARVEC", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"PTVEC", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"STEP", "*", 
                 RowBox[{"PTVEC", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}], "}"}]}], "]"}], 
           ",", " ", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"For", "  ", "a0"}], " ", "=", " ", 
             RowBox[{"8", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"1", "+", 
                  RowBox[{
                   RowBox[{"Tanh", "[", "a0", "]"}], "/", "2"}]}], " ", "=", 
                 " ", "1"}], ")"}], ".", " ", 
               RowBox[{"That", "'"}]}], "s", " ", "the", " ", "upper", " ", 
              "bound", " ", "for", " ", 
              RowBox[{"a8", ".", " ", "Starting"}], " ", "direction", " ", 
              RowBox[{"(", 
               RowBox[{"8", ",", " ", 
                RowBox[{"STEP", "*", "8"}]}], ")"}], " ", 
              RowBox[{"it", "'"}], "s", " ", 
              RowBox[{"bad", "!"}]}]}], "*)"}], "\n", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"VARVEC", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"PTVEC", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"STEP", "*", 
               RowBox[{"PTVEC", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}], "}"}]}], "]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{
            RowBox[{"Dimensions", "[", "VARVEC", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", "1"}], 
      "]"}], ",", "\n", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"VARVEC", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", 
            RowBox[{"PTVEC", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{
            RowBox[{"Dimensions", "[", "VARVEC", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", "1"}], 
      "]"}]}], "\n", "]"}]}], ";"}]}], "Code",
 InitializationCell->False,
 CellChangeTimes->{{3.8975601102923365`*^9, 3.8975601121112785`*^9}},
 CellLabel->
  "In[439]:=",ExpressionUUID->"86843635-2adc-432c-9cf3-40ef92fe4c4f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{
   "ALPHA", ",", "R", ",", "NBAR", ",", "PHASE", ",", "OMEGA", ",", 
    "pDowntMod3", ",", "A", ",", "pDowntMod4"}], "]"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"P", 
     RowBox[{"(", "t", ")"}], " ", "as", " ", "a", " ", "function", " ", "of",
      " ", "gamma"}], ",", " ", "n", ",", " ", 
    RowBox[{"VP", " ", "and", " ", "VQ"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"pDowntMod3", "[", 
     RowBox[{
     "ALPHA_", ",", "R_", ",", "NBAR_", ",", "PHASE_", ",", "A_", ",", "B_", 
      ",", "t_", ",", "NF_", ",", "OMEGA_", ",", "GAMMA_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"B", "/", "2"}], "+", 
     RowBox[{"A", "*", 
      RowBox[{
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"pnV3", "[", 
           RowBox[{"n", ",", "ALPHA", ",", "R", ",", "NBAR", ",", "PHASE"}], 
           "]"}], "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"OMEGA", "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "GAMMA"}], "*", 
            RowBox[{"Sqrt", "[", 
             RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "0", ",", "NF"}], "}"}]}], "]"}], "/", 
       "2"}]}]}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"pDowntMod4", "[", 
    RowBox[{
    "ALPHA_", ",", "R_", ",", "NBAR_", ",", "PHASE_", ",", "A_", ",", "B_", 
     ",", "t_", ",", "NF_", ",", "OMEGA_", ",", "GAMMA_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", "A", "+", "B"}], ")"}], "/", "2"}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", "A", "-", "B"}], ")"}], "*", 
     RowBox[{
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"pnV3", "[", 
          RowBox[{"n", ",", "ALPHA", ",", "R", ",", "NBAR", ",", "PHASE"}], 
          "]"}], "*", 
         RowBox[{"Cos", "[", 
          RowBox[{"OMEGA", "*", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}], "*", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "GAMMA"}], "*", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"n", "+", "1"}], "]"}], "*", "t"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "0", ",", "NF"}], "}"}]}], "]"}], "/", "2"}]}]}]}],
   ";"}]}], "Input",
 CellChangeTimes->{{3.893159000939993*^9, 3.893159001299993*^9}, {
   3.893159073562994*^9, 3.8931590798989944`*^9}, {3.89393076046342*^9, 
   3.8939308093992653`*^9}, 3.8975518663967648`*^9},
 CellLabel->
  "In[370]:=",ExpressionUUID->"69002364-3cf5-4703-a3af-6db76375bbb4"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"fL", ",", "fLA0", ",", "fLA02", ",", "fLA03"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fL", "[", 
      RowBox[{"B_", ",", "L_", ",", "X0_", ",", "K_"}], "]"}], "=", 
     RowBox[{"Divide", "[", 
      RowBox[{"L", ",", 
       RowBox[{"1", "+", 
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "K"}], "*", 
          RowBox[{"(", 
           RowBox[{"B", "-", "X0"}], ")"}]}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fLA0", "[", 
      RowBox[{"A_", ",", "B_", ",", "X0_", ",", "KE_"}], "]"}], "=", 
     RowBox[{"Divide", "[", 
      RowBox[{
       RowBox[{"2", "-", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", 
           RowBox[{"Tanh", "[", "A", "]"}]}], ")"}], "/", "2"}]}], ",", 
       RowBox[{"1", "+", 
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", "KE"}], "*", 
          RowBox[{"(", 
           RowBox[{"B", "-", "X0"}], ")"}]}], "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fLA02", "[", 
      RowBox[{"A_", ",", "B_", ",", "X0_", ",", "KE_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"fLA0", "[", 
         RowBox[{"A", ",", "B", ",", "X0", ",", "KE"}], "]"}], "\[LessEqual]",
         " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", 
           RowBox[{"Tanh", "[", "A", "]"}]}], ")"}], "/", "2"}]}], ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{"Tanh", "[", "A", "]"}]}], ")"}], "/", "2"}], ",", 
       RowBox[{"fLA0", "[", 
        RowBox[{"A", ",", "B", ",", "X0", ",", "KE"}], "]"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fLA03", "[", 
      RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
     RowBox[{"If", "[", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", 
           RowBox[{"Tanh", "[", "B", "]"}]}], ")"}], "/", "2"}], 
        "\[LessEqual]", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", 
           RowBox[{"Tanh", "[", "A", "]"}]}], ")"}], "/", "2"}]}], ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{"Tanh", "[", "A", "]"}]}], ")"}], "/", "2"}], ",", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"2", "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", 
             RowBox[{"Tanh", "[", "A", "]"}]}], ")"}], "/", "2"}]}], ")"}], 
        "*", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", 
           RowBox[{"Tanh", "[", "B", "]"}]}], ")"}], "/", "2"}]}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fLA04", "[", 
      RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
     RowBox[{"fLA02", "[", 
      RowBox[{"A", ",", "B", ",", "0", ",", "1"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.8923787818861227`*^9, 3.8923788658146267`*^9}, {
  3.892379386283943*^9, 3.8923793883024793`*^9}, {3.8923794558657*^9, 
  3.892379511073882*^9}, {3.8923795833095703`*^9, 3.892379583918934*^9}, {
  3.8931595968900037`*^9, 3.893159596981003*^9}, {3.893160590001191*^9, 
  3.8931607370001903`*^9}, {3.893164194126351*^9, 3.8931642013393507`*^9}, {
  3.89316425808435*^9, 3.8931643707393494`*^9}, {3.8931644135114017`*^9, 
  3.893164414315401*^9}, {3.8933166951758547`*^9, 3.8933167068428545`*^9}, {
  3.893316757180854*^9, 3.893316818051862*^9}},
 CellLabel->
  "In[141]:=",ExpressionUUID->"3d1f1652-b8fd-44b8-abd9-117f50f60a49"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"totalSqResid", ",", "lkHood"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"totalSqResid", "[", 
      RowBox[{"DATA_", ",", "MODEL_", ",", "NMDATA_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"Divide", "[", 
       RowBox[{"1", ",", 
        RowBox[{
         RowBox[{"errBayes", "[", 
          RowBox[{
           RowBox[{"DATA", "[", 
            RowBox[{"[", 
             RowBox[{"1", ";;", "All"}], "]"}], "]"}], ",", "NMDATA"}], "]"}],
          "^", "2"}]}], "]"}], ".", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"DATA", "-", "MODEL"}], ")"}], "^", "2"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lkHood", "[", 
      RowBox[{"DATA_", ",", "MODEL_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"DATA", ".", 
       RowBox[{"Log", "[", 
        RowBox[{"10", ",", "MODEL"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", "DATA"}], ")"}], ".", 
       RowBox[{"Log", "[", 
        RowBox[{"10", ",", 
         RowBox[{"1", "-", "MODEL"}]}], "]"}]}]}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.895582851441817*^9, 3.895582852662413*^9}, {
  3.895645334167165*^9, 3.895645353314333*^9}, {3.8956458827617984`*^9, 
  3.8956458828197846`*^9}, {3.8962566857351255`*^9, 3.8962566974067917`*^9}},
 CellLabel->
  "In[147]:=",ExpressionUUID->"fe4bb6ca-a930-4c37-a101-d35568c50141"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"flhood", "[", 
    RowBox[{"DATA_", ",", "EST_", ",", "TVEC_", ",", "MAXF_"}], "]"}], ":=", 
   RowBox[{"lkHood", "[", 
    RowBox[{"DATA", ",", 
     RowBox[{"pDownt", "[", 
      RowBox[{"0", ",", "0", ",", 
       RowBox[{"EST", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "TVEC", ",", "MAXF", 
       ",", 
       RowBox[{"EST", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"EST", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"flhoodA", "[", 
    RowBox[{"DATA_", ",", "EST_", ",", "TVEC_", ",", "MAXF_"}], "]"}], ":=", 
   RowBox[{"lkHood", "[", 
    RowBox[{"DATA", ",", 
     RowBox[{"pDowntMod2", "[", 
      RowBox[{"0", ",", "0", ",", 
       RowBox[{"EST", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
       RowBox[{"EST", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", "TVEC", ",", "MAXF", ",", 
       RowBox[{"EST", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", 
       RowBox[{"EST", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"flhoodAB", "[", 
    RowBox[{"DATA_", ",", "EST_", ",", "TVEC_", ",", "MAXF_"}], "]"}], ":=", 
   RowBox[{"lkHood", "[", 
    RowBox[{"DATA", ",", 
     RowBox[{"pDowntMod4", "[", 
      RowBox[{"0", ",", "0", ",", 
       RowBox[{"EST", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
       RowBox[{"EST", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{"EST", "[", 
        RowBox[{"[", "3", "]"}], "]"}], ",", "TVEC", ",", "MAXF", ",", 
       RowBox[{"EST", "[", 
        RowBox[{"[", "4", "]"}], "]"}], ",", 
       RowBox[{"EST", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8956439810559044`*^9, 3.89564406704889*^9}, {
   3.895644194406043*^9, 3.895644196685587*^9}, {3.8956442592129908`*^9, 
   3.8956443475677705`*^9}, {3.8956445040590763`*^9, 3.895644518294626*^9}, {
   3.895644688948374*^9, 3.8956447157302327`*^9}, {3.895644907302746*^9, 
   3.8956449267185607`*^9}, 3.8956449658127337`*^9},
 CellLabel->
  "In[377]:=",ExpressionUUID->"a6a15382-ba0f-4039-adf0-65fed734099c"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"ftotalwsqr", ",", "ftotalwsqrA", ",", "ftotalwsqrAB"}], "]"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ftotalwsqr", "[", 
      RowBox[{
      "DATA_", ",", "EST_", ",", "TVEC_", ",", "MAXF_", ",", "NMDATA_"}], 
      "]"}], ":=", 
     RowBox[{"totalSqResid", "[", 
      RowBox[{"DATA", ",", 
       RowBox[{"pDownt", "[", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{"EST", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", "TVEC", ",", "MAXF", 
         ",", 
         RowBox[{"EST", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"EST", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ",", "NMDATA"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ftotalwsqrA", "[", 
      RowBox[{
      "DATA_", ",", "EST_", ",", "TVEC_", ",", "MAXF_", ",", "NMDATA_"}], 
      "]"}], ":=", 
     RowBox[{"totalSqResid", "[", 
      RowBox[{"DATA", ",", 
       RowBox[{"pDowntMod2", "[", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{"EST", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
         RowBox[{"EST", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "TVEC", ",", "MAXF", ",", 
         RowBox[{"EST", "[", 
          RowBox[{"[", "3", "]"}], "]"}], ",", 
         RowBox[{"EST", "[", 
          RowBox[{"[", "4", "]"}], "]"}]}], "]"}], ",", "NMDATA"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ftotalwsqrAB", "[", 
      RowBox[{
      "DATA_", ",", "EST_", ",", "TVEC_", ",", "MAXF_", ",", "NMDATA_"}], 
      "]"}], ":=", 
     RowBox[{"totalSqResid", "[", 
      RowBox[{"DATA", ",", 
       RowBox[{"pDowntMod4", "[", 
        RowBox[{"0", ",", "0", ",", 
         RowBox[{"EST", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", "0", ",", 
         RowBox[{"EST", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"EST", "[", 
          RowBox[{"[", "3", "]"}], "]"}], ",", "TVEC", ",", "MAXF", ",", 
         RowBox[{"EST", "[", 
          RowBox[{"[", "4", "]"}], "]"}], ",", 
         RowBox[{"EST", "[", 
          RowBox[{"[", "5", "]"}], "]"}]}], "]"}], ",", "NMDATA"}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8956449913470955`*^9, 3.895645018722616*^9}, {
  3.895645105931291*^9, 3.8956451673310833`*^9}, {3.8956452049751368`*^9, 
  3.8956452055039344`*^9}, {3.8956461401742415`*^9, 3.8956462104295325`*^9}},
 CellLabel->
  "In[380]:=",ExpressionUUID->"539d9836-d71b-49b1-a9e2-305202c8da64"],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{3.8975517500928936`*^9},
 CellLabel->
  "In[158]:=",ExpressionUUID->"2cfc2531-e3e0-4da3-aa54-ac4395465589"]
}, Closed]],

Cell["\<\
Importing Data
\
\>", "Section",
 CellChangeTimes->{{3.897560680059354*^9, 
  3.8975606972774925`*^9}},ExpressionUUID->"fc3ab298-d2af-45db-b2bf-\
2509090929d0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
  "fileFolder", "=", 
   "\"\<C:\\\\Users\\\\italo\\\\OneDrive\\\\Fisica\\\\doutorado\\\\Trabalho_\
Scott-Hannah\\\\Hannah_Experiment_Data_Fit\\\\Datasets\\\\\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fileName", "[", 
    RowBox[{"LZEROS_", ",", "FILENUMBER_", ",", "FILENAME_"}], "]"}], ":=", 
   RowBox[{"StringJoin", "[", 
    RowBox[{"LZEROS", ",", 
     RowBox[{"ToString", "[", "FILENUMBER", "]"}], ",", "\"\<-\>\"", ",", 
     "FILENAME"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fileLocation", "[", 
    RowBox[{"FILEFOLDER_", ",", "FILENAME_"}], "]"}], ":=", 
   RowBox[{"StringJoin", "[", 
    RowBox[{"FILEFOLDER", ",", "FILENAME"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fname1", "=", "\"\<Microwave_SB_squeezed_states_DT.h5\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fname2", "=", "\"\<Microwave_SB_displacement_HA_DT.h5\>\""}], 
   ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"filepath1", "=", 
     RowBox[{"fileLocation", "[", 
      RowBox[{"fileFolder", ",", 
       RowBox[{"fileName", "[", 
        RowBox[{
        "\"\<000\>\"", ",", "\"\<filenumber\>\"", ",", 
         "\"\<Microwave_SB_displacement_HA_DT.h5\>\""}], "]"}]}], "]"}]}], 
    ";"}], "*)"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8720832683122144`*^9, 3.8720832711170855`*^9}, {
   3.872083304647263*^9, 3.872083304989043*^9}, 3.8722837987032895`*^9, {
   3.8858939047005672`*^9, 3.8858939207974515`*^9}, {3.8866009488743963`*^9, 
   3.886600949028557*^9}, {3.887202158972516*^9, 3.887202192090332*^9}, {
   3.887202240879376*^9, 3.8872022443936257`*^9}, {3.893931464805914*^9, 
   3.8939314670089607`*^9}, {3.894352917431075*^9, 3.8943529178601255`*^9}},
 CellLabel->
  "In[157]:=",ExpressionUUID->"8fa53ed2-6524-4c63-8dc3-ed64c5c46c1a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", 
   RowBox[{
   "datastart", ",", "filenumbers", ",", "tablepathsfinal", ",", 
    "tabledatafinal", ",", "tablepopfinal"}], "]"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Getting", " ", "Data"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", "Calibration", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filenumberstart", "=", "000220395"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"datastart", "=", 
    RowBox[{"getH5data", "[", 
     RowBox[{"fileLocation", "[", 
      RowBox[{"fileFolder", ",", 
       RowBox[{"fileName", "[", 
        RowBox[{"\"\<000\>\"", ",", "filenumberstart", ",", "fname1"}], 
        "]"}]}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"p_down", 
    RowBox[{"(", "t", ")"}], " ", "measurements", " ", "vector"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"popstart", "=", 
    RowBox[{"datastart", "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", "6", ",", "2"}], "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"**", "**", "**", "**"}], "*****)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Final", " ", "States"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"**", "**", "**", "**"}], "*****)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Experiment", " ", "1"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filenumbers1", "=", 
   RowBox[{"{", 
    RowBox[{
    "220432", ",", "220433", ",", "220427", ",", "220434", ",", "220428", ",",
      "220435", ",", "220429", ",", "220436", ",", "220431", ",", "220437"}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tablepathsfinal1", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"fileLocation", "[", 
       RowBox[{"fileFolder", ",", 
        RowBox[{"fileName", "[", 
         RowBox[{"\"\<000\>\"", ",", "#", ",", "fname2"}], "]"}]}], "]"}], 
      "&"}], ",", "filenumbers1"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tabledatafinal1", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"getH5data", "[", "#", "]"}], "&"}], ",", "tablepathsfinal1"}],
      "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"p_down", 
    RowBox[{"(", "t", ")"}], " ", "measurements", " ", "vector"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tablepopfinal1", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"tabledatafinal1", "[", 
       RowBox[{"[", 
        RowBox[{"i", ",", "1", ",", "6", ",", "2"}], "]"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{
         RowBox[{"Dimensions", "[", "filenumbers1", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Experiment", " ", "3"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filenumbers2", "=", 
   RowBox[{"{", 
    RowBox[{
    "220425", ",", "220410", ",", "220426", ",", "220406", ",", "220411", ",",
      "220407", ",", "220412", ",", "220408", ",", "220413", ",", "220409"}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tablepathsfinal2", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"fileLocation", "[", 
       RowBox[{"fileFolder", ",", 
        RowBox[{"fileName", "[", 
         RowBox[{"\"\<000\>\"", ",", "#", ",", "fname2"}], "]"}]}], "]"}], 
      "&"}], ",", "filenumbers2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"tabledatafinal2", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"getH5data", "[", "#", "]"}], "&"}], ",", "tablepathsfinal2"}],
      "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"p_down", 
    RowBox[{"(", "t", ")"}], " ", "measurements", " ", "vector"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tablepopfinal2", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"tabledatafinal2", "[", 
      RowBox[{"[", 
       RowBox[{"i", ",", "1", ",", "6", ",", "2"}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{
        RowBox[{"Dimensions", "[", "filenumbers2", "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.872083392907978*^9, 3.8720834080614166`*^9}, {
   3.872083466186755*^9, 3.8720837435592155`*^9}, {3.8720837875956383`*^9, 
   3.872083802360351*^9}, 3.872085026667856*^9, {3.8721810686780562`*^9, 
   3.872181089017209*^9}, {3.8721811366417475`*^9, 3.8721812277406125`*^9}, {
   3.8722829068371167`*^9, 3.8722829598144417`*^9}, {3.8722830309668083`*^9, 
   3.872283073057041*^9}, {3.8820201853190556`*^9, 3.8820202023185706`*^9}, {
   3.882020233070032*^9, 3.882020320430729*^9}, 3.882020482206233*^9, {
   3.893146681275707*^9, 3.8931466817387075`*^9}},
 CellLabel->
  "In[162]:=",ExpressionUUID->"7169a3aa-ca22-42be-b2be-dd3ae72c7b25"],

Cell[BoxData[
 RowBox[{"(*", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Repetitions", " ", "for", " ", "SDTS"}], " ", "=", " ", "300"}],
     ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Repetitions", " ", "for", " ", "Calibration"}], " ", "=", " ", 
     "200"}], ";", "\[IndentingNewLine]", 
    RowBox[{"tvec", " ", "=", " ", 
     RowBox[{"tvec", " ", "used", " ", "in", " ", 
      RowBox[{"Hannah", "'"}], "s", " ", "experiment"}]}]}], ",", " ", 
   RowBox[{
    RowBox[{"file", " ", "220429"}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "Number", " ", "of", " ", "points", " ", "of", " ", "tvec", " ", "in", 
      " ", "Calibration"}], " ", "=", " ", "200"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "Number", " ", "of", " ", "points", " ", "of", " ", "tvec", " ", "in", 
      " ", "Calibration"}], " ", "=", " ", "150"}], ";"}]}], 
  "\[IndentingNewLine]", "*)"}]], "Input",
 CellChangeTimes->{{3.8669219576779604`*^9, 3.866922004776881*^9}, {
  3.8669221319966593`*^9, 3.866922140850714*^9}, {3.8669222252785454`*^9, 
  3.866922284494756*^9}, {3.866923278307596*^9, 3.8669233135536222`*^9}, {
  3.8669240315402727`*^9, 3.866924064405804*^9}, {3.8669244709168034`*^9, 
  3.8669245074219456`*^9}, {3.8720850696638203`*^9, 3.87208507778594*^9}, {
  3.8722839438730245`*^9, 3.8722839441561937`*^9}, {3.8931466853697066`*^9, 
  3.8931466906017065`*^9}},ExpressionUUID->"7f7e7bf7-faa1-44e7-939e-\
9d992946a5c4"]
},
CellGrouping->Manual,
WindowSize->{2560, 997},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
CellContext->Notebook,
Magnification:>1.5 Inherited,
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 167, 2, 73, "Input",ExpressionUUID->"817a7010-d6e3-42b8-9c22-19738806bb4c"],
Cell[728, 24, 506, 9, 127, "Abstract",ExpressionUUID->"ec0402e7-b03c-4d77-a648-ec440f75b585"],
Cell[1237, 35, 154, 3, 43, "Input",ExpressionUUID->"7618d532-54fb-4bdc-9532-0015a6132e16"],
Cell[1394, 40, 583, 9, 95, "Input",ExpressionUUID->"e1cabba1-9226-4912-8649-b18088a1e3f6"],
Cell[CellGroupData[{
Cell[2002, 53, 165, 3, 99, "Section",ExpressionUUID->"5d792f03-cf4f-4398-a941-84667481b685"],
Cell[CellGroupData[{
Cell[2192, 60, 165, 3, 80, "Subsection",ExpressionUUID->"de8dcfcf-8bd2-4657-ab35-28d7c392f0f5"],
Cell[2360, 65, 2487, 58, 919, "Input",ExpressionUUID->"46031581-5382-49eb-b0f0-61f0961ac04a",
 InitializationCell->True],
Cell[4850, 125, 2469, 64, 306, "Input",ExpressionUUID->"c48b1bc3-ddfb-4f0e-9354-2fcfec5260a6",
 InitializationCell->True],
Cell[7322, 191, 861, 23, 144, "Input",ExpressionUUID->"8515b0e2-b605-4a97-826d-16cf048f30e8",
 InitializationCell->True],
Cell[8186, 216, 4364, 113, 131, "Input",ExpressionUUID->"44166aed-01c8-4395-8854-043077827739"],
Cell[12553, 331, 2176, 54, 160, "Input",ExpressionUUID->"992e5cc7-5f56-4331-bd1e-b5b92767fdb7"],
Cell[14732, 387, 886, 25, 66, "Input",ExpressionUUID->"e4a93dac-b460-4e50-b95f-1c59c38e2988"],
Cell[15621, 414, 2859, 76, 429, "Input",ExpressionUUID->"201c3dfa-2dde-4481-8fcb-86343aacb787",
 InitializationCell->True],
Cell[18483, 492, 2844, 75, 433, "Input",ExpressionUUID->"7cf576e3-1071-4900-9352-2ab47714c63f",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[21364, 572, 131, 0, 54, "Subsection",ExpressionUUID->"580dfb0d-0bce-4ec8-a204-1db862768151"],
Cell[21498, 574, 193, 4, 70, "Input",ExpressionUUID->"c2b6171a-450d-4800-83bd-3c835a2f4993"],
Cell[CellGroupData[{
Cell[21716, 582, 112, 0, 70, "Subsubsection",ExpressionUUID->"8c301199-d6ee-4926-9d66-fa00398308b3"],
Cell[21831, 584, 1300, 42, 70, "Input",ExpressionUUID->"8aceed9a-dd0f-44c0-b74f-e30d92ff7816",
 InitializationCell->True],
Cell[23134, 628, 7749, 246, 70, "Input",ExpressionUUID->"01c8233b-1c51-47cb-9d65-7e8f98890206",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[30920, 879, 96, 0, 70, "Subsubsection",ExpressionUUID->"3a3f7185-577e-4735-8e24-1e6b239909e9"],
Cell[31019, 881, 3629, 114, 70, "Input",ExpressionUUID->"fcf15c4f-7911-4ed9-9da0-d4d1016df06f",
 InitializationCell->True],
Cell[34651, 997, 3785, 113, 70, "Input",ExpressionUUID->"8f46c0f2-2db6-4988-a098-b7742f2dcab0",
 InitializationCell->True],
Cell[38439, 1112, 4810, 142, 70, "Input",ExpressionUUID->"f3ba8a96-925d-422a-9915-90b0c86cfd0b",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[43286, 1259, 98, 0, 70, "Subsubsection",ExpressionUUID->"27cbfdc4-1c6b-424e-bf58-f856eeef534f"],
Cell[43387, 1261, 3885, 109, 70, "Input",ExpressionUUID->"2157adcc-0564-4095-8ae7-213aa590b9a2"],
Cell[47275, 1372, 14068, 385, 70, "Input",ExpressionUUID->"1bff46ad-0916-4922-8092-18dcb7391d25"],
Cell[61346, 1759, 109, 2, 70, "Input",ExpressionUUID->"d934405d-6ab4-40df-b605-835e54312278"],
Cell[61458, 1763, 109, 2, 70, "Input",ExpressionUUID->"f102d34b-3a45-43a2-aba3-af5325312b63"],
Cell[61570, 1767, 4424, 120, 70, "Input",ExpressionUUID->"fb58b7d6-c957-4a2d-9dec-2832f80c43ae"],
Cell[65997, 1889, 1210, 34, 70, "Input",ExpressionUUID->"f45e9652-acf0-4db0-b125-6ba12c3787dc"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[67256, 1929, 149, 2, 54, "Subsection",ExpressionUUID->"2053399e-a2b8-471b-b508-1e8c6559d9ec"],
Cell[67408, 1933, 4822, 138, 668, "Input",ExpressionUUID->"a375e839-2cb9-4778-b154-e3729719c025"]
}, Closed]],
Cell[CellGroupData[{
Cell[72267, 2076, 116, 2, 54, "Subsection",ExpressionUUID->"7a892184-4d84-4b63-aca5-1c75659e9eaf",
 InitializationCell->True],
Cell[72386, 2080, 8229, 232, 861, "Input",ExpressionUUID->"e745d3f8-a287-426e-ac60-77cf9f9d35d3",
 InitializationCell->True],
Cell[80618, 2314, 1100, 30, 375, "Input",ExpressionUUID->"f6f9f314-abfd-4f73-8193-6fce2951af55",
 InitializationCell->True],
Cell[81721, 2346, 4034, 103, 820, "Input",ExpressionUUID->"7a17c49d-5367-4a0c-983e-723769ae2177",
 InitializationCell->True],
Cell[85758, 2451, 3937, 100, 815, "Input",ExpressionUUID->"e4b6008f-f0a2-474d-bb8f-d7c41dca26eb",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[89732, 2556, 130, 2, 54, "Subsection",ExpressionUUID->"775bf533-c805-4f5d-8b4e-e4022b33d756",
 InitializationCell->True],
Cell[89865, 2560, 5697, 140, 865, "Input",ExpressionUUID->"9a630d46-2440-4cca-a77d-ebd8522dabff",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[95599, 2705, 123, 2, 54, "Subsection",ExpressionUUID->"f9318b59-16a0-4117-9a97-333ef291027e",
 InitializationCell->True],
Cell[95725, 2709, 9266, 261, 1696, "Input",ExpressionUUID->"39e95099-0859-4d11-b47a-8cff09f8a897",
 InitializationCell->True],
Cell[104994, 2972, 1045, 29, 288, "Input",ExpressionUUID->"ca440ccc-8ac0-4128-ba93-513d5694d7bc",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[106076, 3006, 100, 0, 54, "Subsection",ExpressionUUID->"dd96c0fe-cdfb-41b7-a157-37def4bc5719"],
Cell[106179, 3008, 6151, 150, 70, "Input",ExpressionUUID->"3986d077-1945-4789-9d47-1cbaa5bd08cf",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[112367, 3163, 100, 0, 54, "Subsection",ExpressionUUID->"1e778ead-4b5a-4367-bd38-8a637f734344"],
Cell[112470, 3165, 6152, 150, 919, "Input",ExpressionUUID->"5ab4ef26-8af5-488f-a326-26f72b30b124",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[118659, 3320, 90, 0, 54, "Subsection",ExpressionUUID->"f568b1bd-549c-46c1-a840-0aa4b9938fa1"],
Cell[118752, 3322, 1602, 44, 263, "Input",ExpressionUUID->"8c653b2c-11b4-473b-b04c-474046f79b7e",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[120391, 3371, 91, 0, 54, "Subsection",ExpressionUUID->"45186509-9f7d-4cda-9743-0f5125b2171e"],
Cell[120485, 3373, 1555, 42, 263, "Input",ExpressionUUID->"0c12db39-430f-448d-bb50-e25e6420a016",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[122077, 3420, 91, 0, 54, "Subsection",ExpressionUUID->"949c8966-4aea-4646-a548-9fd5963be365"],
Cell[122171, 3422, 1681, 45, 495, "Input",ExpressionUUID->"f8a10a78-1b57-4f74-82dc-5cd05636ba7d",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[123889, 3472, 98, 0, 54, "Subsection",ExpressionUUID->"40908c44-d092-457a-8e1b-09d6b08d159c"],
Cell[123990, 3474, 20323, 480, 1898, "Input",ExpressionUUID->"557f333a-b6bb-46f0-ab27-0ce37a87a243",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[144350, 3959, 98, 0, 54, "Subsection",ExpressionUUID->"7fbdb4f8-6fda-45c6-b1bd-c56bbbcfa53a"],
Cell[144451, 3961, 16276, 371, 1480, "Input",ExpressionUUID->"4e704253-698c-4746-9461-de70904ec325",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[160764, 4337, 175, 3, 54, "Subsection",ExpressionUUID->"cfdc411f-82ac-4ac5-bd15-d095de812705"],
Cell[160942, 4342, 6854, 168, 919, "Input",ExpressionUUID->"13ec1b4e-373d-4936-b061-924d40ca7626",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[167833, 4515, 173, 3, 54, "Subsection",ExpressionUUID->"47919a91-7ca0-469d-938e-82b0b52c004a"],
Cell[168009, 4520, 19314, 430, 104, "Input",ExpressionUUID->"3e6d556e-54ad-4e0d-8c0a-c537b7ef355a"]
}, Closed]],
Cell[CellGroupData[{
Cell[187360, 4955, 198, 3, 54, "Subsection",ExpressionUUID->"1a5691af-5513-4981-8b60-668c43ba0307"],
Cell[187561, 4960, 20960, 460, 104, "Input",ExpressionUUID->"487d2485-adfd-4b76-bf69-bc384f8d4886"]
}, Closed]],
Cell[CellGroupData[{
Cell[208558, 5425, 248, 4, 54, "Subsection",ExpressionUUID->"4b8dc021-84f8-4ddb-8d76-599eeb5b8c65"],
Cell[208809, 5431, 21982, 470, 2600, "Input",ExpressionUUID->"a42504a1-d89c-44d8-a4fb-dcb247f29a39"]
}, Closed]],
Cell[CellGroupData[{
Cell[230828, 5906, 303, 5, 54, "Subsection",ExpressionUUID->"0bc4ac02-035c-42c6-9b1f-0502c58906cf"],
Cell[231134, 5913, 22362, 475, 2629, "Input",ExpressionUUID->"86366245-136a-4d9b-82aa-895c2776b050"]
}, Closed]],
Cell[253511, 6391, 3705, 97, 266, "Code",ExpressionUUID->"86843635-2adc-432c-9cf3-40ef92fe4c4f",
 InitializationCell->False],
Cell[257219, 6490, 2914, 78, 232, "Input",ExpressionUUID->"69002364-3cf5-4703-a3af-6db76375bbb4"],
Cell[260136, 6570, 3784, 107, 372, "Input",ExpressionUUID->"3d1f1652-b8fd-44b8-abd9-117f50f60a49"],
Cell[263923, 6679, 1486, 41, 203, "Input",ExpressionUUID->"fe4bb6ca-a930-4c37-a101-d35568c50141"],
Cell[265412, 6722, 2316, 58, 102, "Input",ExpressionUUID->"a6a15382-ba0f-4039-adf0-65fed734099c"],
Cell[267731, 6782, 2639, 68, 185, "Input",ExpressionUUID->"539d9836-d71b-49b1-a9e2-305202c8da64"],
Cell[270373, 6852, 172, 3, 73, "Input",ExpressionUUID->"2cfc2531-e3e0-4da3-aa54-ac4395465589"]
}, Closed]],
Cell[270560, 6858, 170, 6, 131, "Section",ExpressionUUID->"fc3ab298-d2af-45db-b2bf-2509090929d0"],
Cell[270733, 6866, 1934, 46, 260, "Input",ExpressionUUID->"8fa53ed2-6524-4c63-8dc3-ed64c5c46c1a"],
Cell[272670, 6914, 5155, 135, 883, "Input",ExpressionUUID->"7169a3aa-ca22-42be-b2be-dd3ae72c7b25"],
Cell[277828, 7051, 1503, 32, 218, "Input",ExpressionUUID->"7f7e7bf7-faa1-44e7-939e-9d992946a5c4"]
}
]
*)

